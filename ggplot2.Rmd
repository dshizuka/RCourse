---
title: "Extra: Intro to ggplot2"
author: "Dai Shizuka"
date: "updated `r format(Sys.time(), '%m/%d/%y')` "
output: 
  html_document:
    toc: true
    toc_depth: 2
    toc_float: true
---

```{r setup, include=FALSE}
library(knitr)
#knitr::opts_chunk$set(out.width="50%")
```

```{r, message=F, warning=F}
library(ggplot2)
library(dplyr)
```

Key reference: https://r4ds.had.co.nz/data-visualisation.html

##1. The basics of the ggplot2 syntax

ggplot2 uses what is called *layered grammar of graphics*  

* First specify the data using the `ggplot()` function.

* Add "aesthetic mapping" (i.e., specify the visual parameters of the graphic) using `aes()` within the `ggplot()` function. This will act as the default aesthetics for all layers, but you can overwrite them within the `geom_` functions as well.

* Then, add specific plot components using additional `geom_` functions (such as `geom_points()`). Note that you literally add these components using `+`

* Layer on any other components with additional `geom_` or `stat_` functions

    + These layers can include summary stats (e.g., means, medians, counts, etc... or any other stats that you can calculate via custom functions).
    

* Make adjustments via scales, axes, legends, etc.

***

## Building a simple scatterplot, step-by-step
```{r, out.width="50%"}
#step 1: blank plotting area
ggplot(data=iris, mapping=aes(x=Sepal.Length, y=Sepal.Width))
```

```{r, out.width="50%"}
#step 2: add scatter plot
ggplot(iris, aes(x=Sepal.Length, y=Sepal.Width)) +
  geom_point()

```

```{r, out.width="50%"}
# step 3: add color by species, change point size
ggplot(iris, aes(x=Sepal.Length, y=Sepal.Width, color=Species)) +
  geom_point(size=2)

```

```{r, out.width="50%", eval=F}
# step 3 - alternative syntax
ggplot(iris, aes(x=Sepal.Length, y=Sepal.Width)) +
  geom_point(aes(color=Species), size=2)

```


## Other simple plots

Boxplot:

```{r}
ggplot(iris, aes(x= Species, y=Sepal.Width)) +
  geom_boxplot()
```


Bar plot (just means)

```{r}
ggplot(iris, aes(x= Species, y=Sepal.Width, fill=Species)) +
  geom_bar(stat="summary", fun.y="mean")
```

Points with error bars

```{r}
se=function(x) sqrt(var(x)/length(x))
ymax=function(x) mean(x) + se(x)
ymin=function(x) mean(x) - se(x)

ggplot(iris, aes(x= Species, y=Sepal.Width)) +
  stat_summary(fun.y= mean, fun.ymin = ymin, fun.ymax=ymax)

```


***

## Adding model outputs onto plots 

```{r}
ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) +
  geom_point(mapping = aes(color = class))
```


```{r}
ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) +
  geom_point(mapping = aes(color = class))
```

```{r}
ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) +
  geom_point(mapping = aes(color = class)) +
  geom_smooth(method="lm", color="black")
```

```{r}
ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) +
  geom_point(mapping = aes(color = class)) +
  geom_smooth(method="lm", aes(x = displ, y = hwy, col=class), se=F)
```

You can filter data within the ggplot function (you have also have loaded `dplyr` or `tidyverse` library to use the `filter()` function though). 

```{r}
ggplot(data = filter(mpg, class!="2seater"), mapping = aes(x = displ, y = hwy)) +
  geom_point(mapping = aes(color = class)) +
  geom_smooth(method="lm", aes(x = displ, y = hwy, col=class), se=F)
```