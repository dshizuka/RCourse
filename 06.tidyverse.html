<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Dai Shizuka" />


<title>Data Wrangling to plots with tidyverse packages</title>

<script src="site_libs/header-attrs-2.13/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/sandstone.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Intro to R</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="syllabus.html">Syllabus</a>
</li>
<li>
  <a href="modules.html">Modules</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Data Wrangling to plots with tidyverse
packages</h1>
<h4 class="author">Dai Shizuka</h4>
<h4 class="date">updated 09/15/22</h4>

</div>


<div id="intro-to-the-tidyverse" class="section level2">
<h2>Intro to the <a
href="https://www.tidyverse.org/">‘tidyverse’</a></h2>
<p><img src="images/icons/tidyr.png" width="10%" /><img src="images/icons/dplyr.png" width="10%" /><img src="images/icons/stringr.png" width="10%" /><img src="images/icons/ggplot2.png" width="10%" /></p>
<p>Now that we have dipped our feet into plots and stats in R, I think
you are getting a better sense of the fact that ‘wrangling’ or
‘manipulating’ data is one of the biggest steps to becoming proficient
in R and all that it has to offer.</p>
<p>For example, for any given analysis, you may have to subset data,
filter out certain data that don’t meet some criteria, focus in on a
select set of variables of interest, calculate means, and variance for
different groups, etc. etc.</p>
<p>These tasks are where the packages <a
href="https://dplyr.tidyverse.org/">dplyr</a>, <a
href="https://tidyr.tidyverse.org/">tidyr</a> and other packages in the
<a href="https://www.tidyverse.org/">tidyverse</a>–a series of packages
designed for all kinds of data tasks. This also includes the popular <a
href="https://ggplot2.tidyverse.org/">ggplot2</a> package for
graphics.</p>
<p>The tidyverse packages are constructed by <a
href="http://hadley.nz/">Hadley Wickam</a>. There are several books that
cover how to use these packages, including <em>R for Data Science</em>
<a href="https://r4ds.had.co.nz/">which is available for free as an
online book</a></p>
<p><img src="images/icons/R_for_Data_Science_cover.png" width="20%" /></p>
<p>In this module, we’ll be learning some functions from the packages
<strong>dplyr</strong> and <strong>tidyr</strong>.</p>
<p>We will do this by playing with data from the World Bank.</p>
<hr />
</div>
<div id="installing-and-loading-packages-we-need-for-this-module"
class="section level2">
<h2>Installing and loading packages we need for this module</h2>
<p>One can install each package separately, but you can also just
install all “tidyverse” packages simply by running this command:</p>
<pre class="r"><code>install.packages(&quot;tidyverse&quot;)
install.packages(&quot;wbstats&quot;)</code></pre>
<p>Note that this simply downloads the packages onto your computer. When
you are ready to use them, you will have to load the package onto the
environment by running the function</p>
<p>You now have the package downloaded on your computer, but to actually
use it, you have to load the package. We can load the entire
<code>tidyverse</code> package (or, if you prefer, you can just load the
<code>tidyr</code> package).</p>
<pre class="r"><code>library(wbstats)
library(tidyverse)</code></pre>
<pre><code>## ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.1 ──</code></pre>
<pre><code>## ✔ ggplot2 3.3.6     ✔ purrr   0.3.4
## ✔ tibble  3.1.7     ✔ dplyr   1.0.8
## ✔ tidyr   1.2.0     ✔ stringr 1.4.0
## ✔ readr   2.1.2     ✔ forcats 0.5.1</code></pre>
<pre><code>## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
## ✖ dplyr::filter() masks stats::filter()
## ✖ dplyr::lag()    masks stats::lag()</code></pre>
<p><strong>Two important thing to notice here.</strong> First, the
message tells you what packages were actually loaded as part of the
tidyverse “metapackage”. You see that this includes 8 packages:
ggplot2,tibble, tidyr, readr, purrr, dplyr, stringr, and forcats.
Second, the message tells you that there are two functions in the
<code>dplyr</code> package that conflict with existing functions:
<code>filter()</code> and <code>lag()</code>. This is sometimes very
important to know! This means that the <code>filter()</code> function
works differently before and after loading this package.</p>
<hr />
<blockquote>
<p><span style="color:purple"><strong><em>Some things to know about
getting started with ‘tidyverse’</em></strong></span></p>
<p><strong>Pipe Operator (<code>%&gt;%</code>):</strong> tidyverse makes
use of the pipe operator <code>%&gt;%</code>, which allows you to carry
over the output of one function to the next function. This can make
series of data manipulation sequences much more efficient.</p>
<p><strong>Tibbles:</strong> “tibble” is a special class of dataframe
that is used in tidyverse. It is largely the same as a dataframe but it
has some features (or rather, lack of features) that make for ‘defensive
coding’. That is, it forces you to avoid dangerous operations, such as
changing variable names or types (you have to explicitly do this) or
allow “partial matching”.</p>
<p>To learn more about tibbles, start <a
href="https://tibble.tidyverse.org/">here</a></p>
</blockquote>
<hr />
</div>
<div id="working-with-tidyr-and-dplyr" class="section level2">
<h2>2. Working with <em>tidyr</em> and <em>dplyr</em></h2>
<div id="tidyr" class="section level3">
<h3>2.1. <em>tidyr</em></h3>
<p>I use <em>tidyr</em> mostly for reshaping data to move between
“long-format” and “wide-format” data.</p>
<p>Here is link to the <em>tidyr</em> cheat sheet: <a
href="https://github.com/rstudio/cheatsheets/blob/master/tidyr.pdf"
class="uri">https://github.com/rstudio/cheatsheets/blob/master/tidyr.pdf</a></p>
<div id="main-tidyr-functions" class="section level4">
<h4>Main <em>tidyr</em> functions</h4>
<ul>
<li><code>pivot_longer()</code>: “lengthen” data by collapsing several
columns into two.</li>
<li><code>pivot_wider()</code>: “widen” data by expanding two columns
into multiple columns</li>
<li><code>drop_na()</code>: remove rows that contain NA</li>
<li><code>separate()</code>: separate values in a column into multiple
columns</li>
<li><code>unite()</code>: paste together values in two columns</li>
</ul>
</div>
</div>
<div id="dplyr" class="section level3">
<h3>2.2. <em>dplyr</em></h3>
<p><em>dplyr</em> is a package that helps you wrangle your data into
shape to aid you in the process of visualization and analysis.</p>
<p>Here is a link to the <code>dplyr</code> cheat sheet: <a
href="https://github.com/rstudio/cheatsheets/blob/main/data-transformation.pdf"
class="uri">https://github.com/rstudio/cheatsheets/blob/main/data-transformation.pdf</a></p>
<div id="main-dplyr-functions" class="section level4">
<h4>Main <em>dplyr</em> functions</h4>
<ul>
<li><code>pull()</code>: select one column and save as a vector.</li>
<li><code>select()</code>: select columns by criteria</li>
<li><code>filter()</code>: filter rows by criteria</li>
<li><code>mutate()</code>: add new variable using functions</li>
<li><code>group_by()</code>: group the data together based on a given
variable (or variables). Often used when calculating summary stats.</li>
<li><code>summarise()</code>: calculate summary statistic for a given
variable</li>
<li><code>arrange()</code>: change order of rows</li>
<li><code>left_join()</code>, <code>right_join()</code>,
<code>inner_join()</code>, <code>full_join()</code>: set of functions to
help merge data tables.</li>
<li><code>nest_join()</code>: create nested datasets (advanced… I don’t
know how to use this yet)</li>
</ul>
<p><br></p>
<hr />
</div>
</div>
</div>
<div id="demonstrating-the-basic-functions" class="section level2">
<h2>3. Demonstrating the basic functions</h2>
<p><br></p>
<div id="using-pipes-to-chain-together-sequence-of-actions"
class="section level3">
<h3>3.1 Using pipes (<code>%&gt;%</code>) to chain together sequence of
actions!</h3>
<p>First, I’m going to introduce the “pipe”–perhaps the most useful part
of the tidyverse grammar (which actually comes from another amazing
package called <code>magrittr</code>, if you care…).</p>
<p>Basically, piping is when the <code>%&gt;%</code> operator is used to
forward a value, or the result of an expression, into the next function
call/expression.</p>
<p>Take for example the <code>billboard</code> dataset, which is part of
the <em>tidyr</em> package. It contains data on rankings of songs on the
Billboard Top 100 in the year 2000.</p>
<pre class="r"><code>billboard</code></pre>
<pre><code>## # A tibble: 317 × 79
##    artist     track date.entered   wk1   wk2   wk3   wk4   wk5   wk6   wk7   wk8
##    &lt;chr&gt;      &lt;chr&gt; &lt;date&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 2 Pac      Baby… 2000-02-26      87    82    72    77    87    94    99    NA
##  2 2Ge+her    The … 2000-09-02      91    87    92    NA    NA    NA    NA    NA
##  3 3 Doors D… Kryp… 2000-04-08      81    70    68    67    66    57    54    53
##  4 3 Doors D… Loser 2000-10-21      76    76    72    69    67    65    55    59
##  5 504 Boyz   Wobb… 2000-04-15      57    34    25    17    17    31    36    49
##  6 98^0       Give… 2000-08-19      51    39    34    26    26    19     2     2
##  7 A*Teens    Danc… 2000-07-08      97    97    96    95   100    NA    NA    NA
##  8 Aaliyah    I Do… 2000-01-29      84    62    51    41    38    35    35    38
##  9 Aaliyah    Try … 2000-03-18      59    53    38    28    21    18    16    14
## 10 Adams, Yo… Open… 2000-08-26      76    76    74    69    68    67    61    58
## # … with 307 more rows, and 68 more variables: wk9 &lt;dbl&gt;, wk10 &lt;dbl&gt;,
## #   wk11 &lt;dbl&gt;, wk12 &lt;dbl&gt;, wk13 &lt;dbl&gt;, wk14 &lt;dbl&gt;, wk15 &lt;dbl&gt;, wk16 &lt;dbl&gt;,
## #   wk17 &lt;dbl&gt;, wk18 &lt;dbl&gt;, wk19 &lt;dbl&gt;, wk20 &lt;dbl&gt;, wk21 &lt;dbl&gt;, wk22 &lt;dbl&gt;,
## #   wk23 &lt;dbl&gt;, wk24 &lt;dbl&gt;, wk25 &lt;dbl&gt;, wk26 &lt;dbl&gt;, wk27 &lt;dbl&gt;, wk28 &lt;dbl&gt;,
## #   wk29 &lt;dbl&gt;, wk30 &lt;dbl&gt;, wk31 &lt;dbl&gt;, wk32 &lt;dbl&gt;, wk33 &lt;dbl&gt;, wk34 &lt;dbl&gt;,
## #   wk35 &lt;dbl&gt;, wk36 &lt;dbl&gt;, wk37 &lt;dbl&gt;, wk38 &lt;dbl&gt;, wk39 &lt;dbl&gt;, wk40 &lt;dbl&gt;,
## #   wk41 &lt;dbl&gt;, wk42 &lt;dbl&gt;, wk43 &lt;dbl&gt;, wk44 &lt;dbl&gt;, wk45 &lt;dbl&gt;, wk46 &lt;dbl&gt;, …</code></pre>
<p>You can use the <code>filter()</code> function (see more below) to
show just the data for songs by The Backstreet Boys.</p>
<pre class="r"><code>filter(billboard, artist==&quot;Backstreet Boys, The&quot;)</code></pre>
<pre><code>## # A tibble: 3 × 79
##   artist      track date.entered   wk1   wk2   wk3   wk4   wk5   wk6   wk7   wk8
##   &lt;chr&gt;       &lt;chr&gt; &lt;date&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Backstreet… Shap… 2000-10-14      39    25    24    15    12    12    10     9
## 2 Backstreet… Show… 2000-01-01      74    62    55    25    16    14    12    10
## 3 Backstreet… The … 2000-05-27      58    50    43    37    31    30    39    47
## # … with 68 more variables: wk9 &lt;dbl&gt;, wk10 &lt;dbl&gt;, wk11 &lt;dbl&gt;, wk12 &lt;dbl&gt;,
## #   wk13 &lt;dbl&gt;, wk14 &lt;dbl&gt;, wk15 &lt;dbl&gt;, wk16 &lt;dbl&gt;, wk17 &lt;dbl&gt;, wk18 &lt;dbl&gt;,
## #   wk19 &lt;dbl&gt;, wk20 &lt;dbl&gt;, wk21 &lt;dbl&gt;, wk22 &lt;dbl&gt;, wk23 &lt;dbl&gt;, wk24 &lt;dbl&gt;,
## #   wk25 &lt;dbl&gt;, wk26 &lt;dbl&gt;, wk27 &lt;dbl&gt;, wk28 &lt;dbl&gt;, wk29 &lt;dbl&gt;, wk30 &lt;dbl&gt;,
## #   wk31 &lt;dbl&gt;, wk32 &lt;dbl&gt;, wk33 &lt;dbl&gt;, wk34 &lt;dbl&gt;, wk35 &lt;dbl&gt;, wk36 &lt;dbl&gt;,
## #   wk37 &lt;dbl&gt;, wk38 &lt;dbl&gt;, wk39 &lt;dbl&gt;, wk40 &lt;dbl&gt;, wk41 &lt;dbl&gt;, wk42 &lt;dbl&gt;,
## #   wk43 &lt;dbl&gt;, wk44 &lt;dbl&gt;, wk45 &lt;dbl&gt;, wk46 &lt;dbl&gt;, wk47 &lt;dbl&gt;, wk48 &lt;dbl&gt;, …</code></pre>
<p>But you can run the same code by using <code>%&gt;%</code>, like
this:</p>
<pre class="r"><code>billboard %&gt;% filter(artist==&quot;Backstreet Boys, The&quot;)</code></pre>
<pre><code>## # A tibble: 3 × 79
##   artist      track date.entered   wk1   wk2   wk3   wk4   wk5   wk6   wk7   wk8
##   &lt;chr&gt;       &lt;chr&gt; &lt;date&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Backstreet… Shap… 2000-10-14      39    25    24    15    12    12    10     9
## 2 Backstreet… Show… 2000-01-01      74    62    55    25    16    14    12    10
## 3 Backstreet… The … 2000-05-27      58    50    43    37    31    30    39    47
## # … with 68 more variables: wk9 &lt;dbl&gt;, wk10 &lt;dbl&gt;, wk11 &lt;dbl&gt;, wk12 &lt;dbl&gt;,
## #   wk13 &lt;dbl&gt;, wk14 &lt;dbl&gt;, wk15 &lt;dbl&gt;, wk16 &lt;dbl&gt;, wk17 &lt;dbl&gt;, wk18 &lt;dbl&gt;,
## #   wk19 &lt;dbl&gt;, wk20 &lt;dbl&gt;, wk21 &lt;dbl&gt;, wk22 &lt;dbl&gt;, wk23 &lt;dbl&gt;, wk24 &lt;dbl&gt;,
## #   wk25 &lt;dbl&gt;, wk26 &lt;dbl&gt;, wk27 &lt;dbl&gt;, wk28 &lt;dbl&gt;, wk29 &lt;dbl&gt;, wk30 &lt;dbl&gt;,
## #   wk31 &lt;dbl&gt;, wk32 &lt;dbl&gt;, wk33 &lt;dbl&gt;, wk34 &lt;dbl&gt;, wk35 &lt;dbl&gt;, wk36 &lt;dbl&gt;,
## #   wk37 &lt;dbl&gt;, wk38 &lt;dbl&gt;, wk39 &lt;dbl&gt;, wk40 &lt;dbl&gt;, wk41 &lt;dbl&gt;, wk42 &lt;dbl&gt;,
## #   wk43 &lt;dbl&gt;, wk44 &lt;dbl&gt;, wk45 &lt;dbl&gt;, wk46 &lt;dbl&gt;, wk47 &lt;dbl&gt;, wk48 &lt;dbl&gt;, …</code></pre>
<p>What this does is tell R: “Take <code>billboard</code>. Then, filter
the data to show just the songs by The Backstreet Boys. And in this
case, the <code>filter(., )</code> says that the forwarded value should
be used in place of”.”.</p>
<p>… but you actually don’t even need to include the “.” here–tidyverse
automatically applies the forwarded value as the first entry in the
function, so you can just do:</p>
<pre class="r"><code>billboard %&gt;% filter(artist==&quot;Backstreet Boys, The&quot;)</code></pre>
<pre><code>## # A tibble: 3 × 79
##   artist      track date.entered   wk1   wk2   wk3   wk4   wk5   wk6   wk7   wk8
##   &lt;chr&gt;       &lt;chr&gt; &lt;date&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Backstreet… Shap… 2000-10-14      39    25    24    15    12    12    10     9
## 2 Backstreet… Show… 2000-01-01      74    62    55    25    16    14    12    10
## 3 Backstreet… The … 2000-05-27      58    50    43    37    31    30    39    47
## # … with 68 more variables: wk9 &lt;dbl&gt;, wk10 &lt;dbl&gt;, wk11 &lt;dbl&gt;, wk12 &lt;dbl&gt;,
## #   wk13 &lt;dbl&gt;, wk14 &lt;dbl&gt;, wk15 &lt;dbl&gt;, wk16 &lt;dbl&gt;, wk17 &lt;dbl&gt;, wk18 &lt;dbl&gt;,
## #   wk19 &lt;dbl&gt;, wk20 &lt;dbl&gt;, wk21 &lt;dbl&gt;, wk22 &lt;dbl&gt;, wk23 &lt;dbl&gt;, wk24 &lt;dbl&gt;,
## #   wk25 &lt;dbl&gt;, wk26 &lt;dbl&gt;, wk27 &lt;dbl&gt;, wk28 &lt;dbl&gt;, wk29 &lt;dbl&gt;, wk30 &lt;dbl&gt;,
## #   wk31 &lt;dbl&gt;, wk32 &lt;dbl&gt;, wk33 &lt;dbl&gt;, wk34 &lt;dbl&gt;, wk35 &lt;dbl&gt;, wk36 &lt;dbl&gt;,
## #   wk37 &lt;dbl&gt;, wk38 &lt;dbl&gt;, wk39 &lt;dbl&gt;, wk40 &lt;dbl&gt;, wk41 &lt;dbl&gt;, wk42 &lt;dbl&gt;,
## #   wk43 &lt;dbl&gt;, wk44 &lt;dbl&gt;, wk45 &lt;dbl&gt;, wk46 &lt;dbl&gt;, wk47 &lt;dbl&gt;, wk48 &lt;dbl&gt;, …</code></pre>
<p>Right now, this seems a bit puzzling and not that useful… but, you
will quickly see how the <code>%&gt;%</code> operator can help you build
nice pipelines (pun intended) for data wrangling!</p>
<p><strong>From here on out, I will build the codes using pipes as a
default.</strong></p>
<p><br></p>
</div>
<div id="filter-by-row-values" class="section level3">
<h3>3.2. Filter by row values</h3>
<p>As I’ve shown already, you can use the <code>filter()</code> function
in <em>dplyr</em> to select rows based on some criteria.</p>
<p>I can actually use multiple criteria to filter data. Let’s say I now
want to see the data for songs by either The Backstreet Boys or
N’Sync:</p>
<pre class="r"><code>billboard %&gt;% filter(artist==&quot;Backstreet Boys, The&quot; | artist==&quot;N&#39;Sync&quot;)</code></pre>
<pre><code>## # A tibble: 6 × 79
##   artist      track date.entered   wk1   wk2   wk3   wk4   wk5   wk6   wk7   wk8
##   &lt;chr&gt;       &lt;chr&gt; &lt;date&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Backstreet… Shap… 2000-10-14      39    25    24    15    12    12    10     9
## 2 Backstreet… Show… 2000-01-01      74    62    55    25    16    14    12    10
## 3 Backstreet… The … 2000-05-27      58    50    43    37    31    30    39    47
## 4 N&#39;Sync      Bye … 2000-01-29      42    20    19    14    13     7     6     5
## 5 N&#39;Sync      It&#39;s… 2000-05-06      82    70    51    39    26    19    15     9
## 6 N&#39;Sync      This… 2000-09-30      68    31    19    15    11     6     7     7
## # … with 68 more variables: wk9 &lt;dbl&gt;, wk10 &lt;dbl&gt;, wk11 &lt;dbl&gt;, wk12 &lt;dbl&gt;,
## #   wk13 &lt;dbl&gt;, wk14 &lt;dbl&gt;, wk15 &lt;dbl&gt;, wk16 &lt;dbl&gt;, wk17 &lt;dbl&gt;, wk18 &lt;dbl&gt;,
## #   wk19 &lt;dbl&gt;, wk20 &lt;dbl&gt;, wk21 &lt;dbl&gt;, wk22 &lt;dbl&gt;, wk23 &lt;dbl&gt;, wk24 &lt;dbl&gt;,
## #   wk25 &lt;dbl&gt;, wk26 &lt;dbl&gt;, wk27 &lt;dbl&gt;, wk28 &lt;dbl&gt;, wk29 &lt;dbl&gt;, wk30 &lt;dbl&gt;,
## #   wk31 &lt;dbl&gt;, wk32 &lt;dbl&gt;, wk33 &lt;dbl&gt;, wk34 &lt;dbl&gt;, wk35 &lt;dbl&gt;, wk36 &lt;dbl&gt;,
## #   wk37 &lt;dbl&gt;, wk38 &lt;dbl&gt;, wk39 &lt;dbl&gt;, wk40 &lt;dbl&gt;, wk41 &lt;dbl&gt;, wk42 &lt;dbl&gt;,
## #   wk43 &lt;dbl&gt;, wk44 &lt;dbl&gt;, wk45 &lt;dbl&gt;, wk46 &lt;dbl&gt;, wk47 &lt;dbl&gt;, wk48 &lt;dbl&gt;, …</code></pre>
<p>Recall that there is a conflict over the function name
<code>filter()</code>–there is another <code>filter()</code> function in
base R that is separate from the tidyverse version. To make sure you are
using the version from the <em>dplyr</em> package, I often use
<code>dplyr::filter()</code> when I run this function.</p>
<pre class="r"><code>billboard %&gt;% dplyr::filter(artist==&quot;Backstreet Boys, The&quot; | artist==&quot;N&#39;Sync&quot;)</code></pre>
<pre><code>## # A tibble: 6 × 79
##   artist      track date.entered   wk1   wk2   wk3   wk4   wk5   wk6   wk7   wk8
##   &lt;chr&gt;       &lt;chr&gt; &lt;date&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Backstreet… Shap… 2000-10-14      39    25    24    15    12    12    10     9
## 2 Backstreet… Show… 2000-01-01      74    62    55    25    16    14    12    10
## 3 Backstreet… The … 2000-05-27      58    50    43    37    31    30    39    47
## 4 N&#39;Sync      Bye … 2000-01-29      42    20    19    14    13     7     6     5
## 5 N&#39;Sync      It&#39;s… 2000-05-06      82    70    51    39    26    19    15     9
## 6 N&#39;Sync      This… 2000-09-30      68    31    19    15    11     6     7     7
## # … with 68 more variables: wk9 &lt;dbl&gt;, wk10 &lt;dbl&gt;, wk11 &lt;dbl&gt;, wk12 &lt;dbl&gt;,
## #   wk13 &lt;dbl&gt;, wk14 &lt;dbl&gt;, wk15 &lt;dbl&gt;, wk16 &lt;dbl&gt;, wk17 &lt;dbl&gt;, wk18 &lt;dbl&gt;,
## #   wk19 &lt;dbl&gt;, wk20 &lt;dbl&gt;, wk21 &lt;dbl&gt;, wk22 &lt;dbl&gt;, wk23 &lt;dbl&gt;, wk24 &lt;dbl&gt;,
## #   wk25 &lt;dbl&gt;, wk26 &lt;dbl&gt;, wk27 &lt;dbl&gt;, wk28 &lt;dbl&gt;, wk29 &lt;dbl&gt;, wk30 &lt;dbl&gt;,
## #   wk31 &lt;dbl&gt;, wk32 &lt;dbl&gt;, wk33 &lt;dbl&gt;, wk34 &lt;dbl&gt;, wk35 &lt;dbl&gt;, wk36 &lt;dbl&gt;,
## #   wk37 &lt;dbl&gt;, wk38 &lt;dbl&gt;, wk39 &lt;dbl&gt;, wk40 &lt;dbl&gt;, wk41 &lt;dbl&gt;, wk42 &lt;dbl&gt;,
## #   wk43 &lt;dbl&gt;, wk44 &lt;dbl&gt;, wk45 &lt;dbl&gt;, wk46 &lt;dbl&gt;, wk47 &lt;dbl&gt;, wk48 &lt;dbl&gt;, …</code></pre>
</div>
<div id="select-columns" class="section level3">
<h3>3.3. Select columns</h3>
<p>Sometimes, you don’t need all of the data. Let’s say we just want to
see what position each song started at–so we just want the artist,
track, date entered and the week 1 rank. You can do this with
<code>select()</code></p>
<pre class="r"><code>billboard %&gt;% select(artist, track, date.entered, wk1)</code></pre>
<pre><code>## # A tibble: 317 × 4
##    artist         track                   date.entered   wk1
##    &lt;chr&gt;          &lt;chr&gt;                   &lt;date&gt;       &lt;dbl&gt;
##  1 2 Pac          Baby Don&#39;t Cry (Keep... 2000-02-26      87
##  2 2Ge+her        The Hardest Part Of ... 2000-09-02      91
##  3 3 Doors Down   Kryptonite              2000-04-08      81
##  4 3 Doors Down   Loser                   2000-10-21      76
##  5 504 Boyz       Wobble Wobble           2000-04-15      57
##  6 98^0           Give Me Just One Nig... 2000-08-19      51
##  7 A*Teens        Dancing Queen           2000-07-08      97
##  8 Aaliyah        I Don&#39;t Wanna           2000-01-29      84
##  9 Aaliyah        Try Again               2000-03-18      59
## 10 Adams, Yolanda Open My Heart           2000-08-26      76
## # … with 307 more rows</code></pre>
<p>The nice thing about the select function is that you don’t need to
put the column names in quotes or anything–just type in the columns you
want.</p>
<p>or, type in the columns you DON’T want:</p>
<pre class="r"><code>billboard %&gt;% select(-track, -date.entered)</code></pre>
<pre><code>## # A tibble: 317 × 77
##    artist        wk1   wk2   wk3   wk4   wk5   wk6   wk7   wk8   wk9  wk10  wk11
##    &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 2 Pac          87    82    72    77    87    94    99    NA    NA    NA    NA
##  2 2Ge+her        91    87    92    NA    NA    NA    NA    NA    NA    NA    NA
##  3 3 Doors Do…    81    70    68    67    66    57    54    53    51    51    51
##  4 3 Doors Do…    76    76    72    69    67    65    55    59    62    61    61
##  5 504 Boyz       57    34    25    17    17    31    36    49    53    57    64
##  6 98^0           51    39    34    26    26    19     2     2     3     6     7
##  7 A*Teens        97    97    96    95   100    NA    NA    NA    NA    NA    NA
##  8 Aaliyah        84    62    51    41    38    35    35    38    38    36    37
##  9 Aaliyah        59    53    38    28    21    18    16    14    12    10     9
## 10 Adams, Yol…    76    76    74    69    68    67    61    58    57    59    66
## # … with 307 more rows, and 65 more variables: wk12 &lt;dbl&gt;, wk13 &lt;dbl&gt;,
## #   wk14 &lt;dbl&gt;, wk15 &lt;dbl&gt;, wk16 &lt;dbl&gt;, wk17 &lt;dbl&gt;, wk18 &lt;dbl&gt;, wk19 &lt;dbl&gt;,
## #   wk20 &lt;dbl&gt;, wk21 &lt;dbl&gt;, wk22 &lt;dbl&gt;, wk23 &lt;dbl&gt;, wk24 &lt;dbl&gt;, wk25 &lt;dbl&gt;,
## #   wk26 &lt;dbl&gt;, wk27 &lt;dbl&gt;, wk28 &lt;dbl&gt;, wk29 &lt;dbl&gt;, wk30 &lt;dbl&gt;, wk31 &lt;dbl&gt;,
## #   wk32 &lt;dbl&gt;, wk33 &lt;dbl&gt;, wk34 &lt;dbl&gt;, wk35 &lt;dbl&gt;, wk36 &lt;dbl&gt;, wk37 &lt;dbl&gt;,
## #   wk38 &lt;dbl&gt;, wk39 &lt;dbl&gt;, wk40 &lt;dbl&gt;, wk41 &lt;dbl&gt;, wk42 &lt;dbl&gt;, wk43 &lt;dbl&gt;,
## #   wk44 &lt;dbl&gt;, wk45 &lt;dbl&gt;, wk46 &lt;dbl&gt;, wk47 &lt;dbl&gt;, wk48 &lt;dbl&gt;, wk49 &lt;dbl&gt;, …</code></pre>
<p>Combining the <code>filter()</code> and <code>select()</code>
functions allow you to manage the data in flexible ways. And piping
makes it easy to do this:</p>
<pre class="r"><code>billboard %&gt;% dplyr::filter(artist==&quot;Backstreet Boys, The&quot;) %&gt;% select(artist, track, date.entered, wk1)</code></pre>
<pre><code>## # A tibble: 3 × 4
##   artist               track                   date.entered   wk1
##   &lt;chr&gt;                &lt;chr&gt;                   &lt;date&gt;       &lt;dbl&gt;
## 1 Backstreet Boys, The Shape Of My Heart       2000-10-14      39
## 2 Backstreet Boys, The Show Me The Meaning ... 2000-01-01      74
## 3 Backstreet Boys, The The One                 2000-05-27      58</code></pre>
<p><br></p>
</div>
<div
id="converting-wide-format-data-to-long-format-data-with-pivot_longer"
class="section level3">
<h3>3.4. Converting wide-format data to long-format data with
<code>pivot_longer()</code></h3>
<p>“Wide-format” data is one in which each row is a subject/entity that
is measured repeatedly, and each measurement appears on different
columns. The <code>billboard</code> data is a prime example of
wide-format data because it lists the rankings of a song for each week
in separate columns.</p>
<p>Let’s now convert this into a long-format, in which we have a column
for “week” and then the rank of that song for that week in a column
called “rank”:</p>
<pre class="r"><code>billboard %&gt;% pivot_longer(cols=starts_with(&quot;wk&quot;), names_to=&quot;week&quot;, values_to=&quot;rank&quot;)</code></pre>
<pre><code>## # A tibble: 24,092 × 5
##    artist track                   date.entered week   rank
##    &lt;chr&gt;  &lt;chr&gt;                   &lt;date&gt;       &lt;chr&gt; &lt;dbl&gt;
##  1 2 Pac  Baby Don&#39;t Cry (Keep... 2000-02-26   wk1      87
##  2 2 Pac  Baby Don&#39;t Cry (Keep... 2000-02-26   wk2      82
##  3 2 Pac  Baby Don&#39;t Cry (Keep... 2000-02-26   wk3      72
##  4 2 Pac  Baby Don&#39;t Cry (Keep... 2000-02-26   wk4      77
##  5 2 Pac  Baby Don&#39;t Cry (Keep... 2000-02-26   wk5      87
##  6 2 Pac  Baby Don&#39;t Cry (Keep... 2000-02-26   wk6      94
##  7 2 Pac  Baby Don&#39;t Cry (Keep... 2000-02-26   wk7      99
##  8 2 Pac  Baby Don&#39;t Cry (Keep... 2000-02-26   wk8      NA
##  9 2 Pac  Baby Don&#39;t Cry (Keep... 2000-02-26   wk9      NA
## 10 2 Pac  Baby Don&#39;t Cry (Keep... 2000-02-26   wk10     NA
## # … with 24,082 more rows</code></pre>
<p>What happened here?</p>
<p>The minimal arguments that are required in here are:</p>
<ul>
<li><code>data</code>: (self explanatory)</li>
<li><code>cols</code>: The columns that we want to collapse into a
single column. Here, we want all the columns that start with “wk”, which
contain the ranking of that song in that week. tidyverse has a friendly
function called <code>starts_with()</code> that we use here. An
alternative way to do this would be to <em>exclude</em> all the other
columns, which we could do with
<code>-c(artist, track, date.entered)</code></li>
<li><code>names_to</code>: The name of a new column that will contain
names of the columns that you collapsed. Here, naming this “week” makes
sense.</li>
<li><code>values_to</code>: The name of a new column that will have the
values for each ID x names_from combination. In this case, this is
“rank”</li>
</ul>
</div>
<div
id="converting-long-format-data-to-wide-format-data-with-pivot_wider"
class="section level3">
<h3>3.5. Converting long-format data to wide-format data with
<code>pivot_wider()</code></h3>
<p>Let’s save the long-format version of the billboard data:</p>
<pre class="r"><code>bb_long=billboard %&gt;% pivot_longer(cols=starts_with(&quot;wk&quot;), names_to=&quot;week&quot;, values_to=&quot;rank&quot;)</code></pre>
<p>We can then revert back to the wide-format version this way:</p>
<pre class="r"><code>bb_long %&gt;% pivot_wider(names_from = &quot;week&quot;, values_from = &quot;rank&quot;)</code></pre>
<pre><code>## # A tibble: 317 × 79
##    artist     track date.entered   wk1   wk2   wk3   wk4   wk5   wk6   wk7   wk8
##    &lt;chr&gt;      &lt;chr&gt; &lt;date&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 2 Pac      Baby… 2000-02-26      87    82    72    77    87    94    99    NA
##  2 2Ge+her    The … 2000-09-02      91    87    92    NA    NA    NA    NA    NA
##  3 3 Doors D… Kryp… 2000-04-08      81    70    68    67    66    57    54    53
##  4 3 Doors D… Loser 2000-10-21      76    76    72    69    67    65    55    59
##  5 504 Boyz   Wobb… 2000-04-15      57    34    25    17    17    31    36    49
##  6 98^0       Give… 2000-08-19      51    39    34    26    26    19     2     2
##  7 A*Teens    Danc… 2000-07-08      97    97    96    95   100    NA    NA    NA
##  8 Aaliyah    I Do… 2000-01-29      84    62    51    41    38    35    35    38
##  9 Aaliyah    Try … 2000-03-18      59    53    38    28    21    18    16    14
## 10 Adams, Yo… Open… 2000-08-26      76    76    74    69    68    67    61    58
## # … with 307 more rows, and 68 more variables: wk9 &lt;dbl&gt;, wk10 &lt;dbl&gt;,
## #   wk11 &lt;dbl&gt;, wk12 &lt;dbl&gt;, wk13 &lt;dbl&gt;, wk14 &lt;dbl&gt;, wk15 &lt;dbl&gt;, wk16 &lt;dbl&gt;,
## #   wk17 &lt;dbl&gt;, wk18 &lt;dbl&gt;, wk19 &lt;dbl&gt;, wk20 &lt;dbl&gt;, wk21 &lt;dbl&gt;, wk22 &lt;dbl&gt;,
## #   wk23 &lt;dbl&gt;, wk24 &lt;dbl&gt;, wk25 &lt;dbl&gt;, wk26 &lt;dbl&gt;, wk27 &lt;dbl&gt;, wk28 &lt;dbl&gt;,
## #   wk29 &lt;dbl&gt;, wk30 &lt;dbl&gt;, wk31 &lt;dbl&gt;, wk32 &lt;dbl&gt;, wk33 &lt;dbl&gt;, wk34 &lt;dbl&gt;,
## #   wk35 &lt;dbl&gt;, wk36 &lt;dbl&gt;, wk37 &lt;dbl&gt;, wk38 &lt;dbl&gt;, wk39 &lt;dbl&gt;, wk40 &lt;dbl&gt;,
## #   wk41 &lt;dbl&gt;, wk42 &lt;dbl&gt;, wk43 &lt;dbl&gt;, wk44 &lt;dbl&gt;, wk45 &lt;dbl&gt;, wk46 &lt;dbl&gt;, …</code></pre>
<p>So, what happened here? The minimal arguments that are required in
here are:</p>
<ul>
<li><code>data</code>: is <code>bb_long</code>, forwarded by the
%&gt;%</li>
<li><code>names_from</code>: The column that you want to expand into
different columns. In this case, it is “age” because you want to see the
heights of each tree at different ages as different columns.</li>
<li><code>values_from</code>: The column that will have the values for
each ID x names_from combination. In this case, this is “height”</li>
</ul>
<hr />
</div>
<div id="group-and-summarize-data" class="section level3">
<h3>3.6. Group and Summarize data</h3>
<p><em>dplyr</em> makes the craft of summarizing data much easier… if
you get comfortable with the grammar. Here, I will show you how to use
<code>group_by()</code> and <code>summarise()</code> functions to get
summary data by artist, like their best ranking and how many weeks they
spent on the Top 100 chart.</p>
<p>Let’s go back to the code that created the long-format version of the
billboard data, but let’s drop the rows that contain NAs using
<code>drop_na()</code></p>
<pre class="r"><code>billboard %&gt;% 
  pivot_longer(cols=starts_with(&quot;wk&quot;), names_to=&quot;week&quot;, values_to=&quot;rank&quot;) %&gt;%
  drop_na() </code></pre>
<pre><code>## # A tibble: 5,307 × 5
##    artist  track                   date.entered week   rank
##    &lt;chr&gt;   &lt;chr&gt;                   &lt;date&gt;       &lt;chr&gt; &lt;dbl&gt;
##  1 2 Pac   Baby Don&#39;t Cry (Keep... 2000-02-26   wk1      87
##  2 2 Pac   Baby Don&#39;t Cry (Keep... 2000-02-26   wk2      82
##  3 2 Pac   Baby Don&#39;t Cry (Keep... 2000-02-26   wk3      72
##  4 2 Pac   Baby Don&#39;t Cry (Keep... 2000-02-26   wk4      77
##  5 2 Pac   Baby Don&#39;t Cry (Keep... 2000-02-26   wk5      87
##  6 2 Pac   Baby Don&#39;t Cry (Keep... 2000-02-26   wk6      94
##  7 2 Pac   Baby Don&#39;t Cry (Keep... 2000-02-26   wk7      99
##  8 2Ge+her The Hardest Part Of ... 2000-09-02   wk1      91
##  9 2Ge+her The Hardest Part Of ... 2000-09-02   wk2      87
## 10 2Ge+her The Hardest Part Of ... 2000-09-02   wk3      92
## # … with 5,297 more rows</code></pre>
<p>Now, we can calculate the “best rank” of each artist by grouping the
data by “artist”, and finding the minimum ranking that the artist
had:</p>
<pre class="r"><code>billboard %&gt;% 
  pivot_longer(cols=starts_with(&quot;wk&quot;), names_to=&quot;week&quot;, values_to=&quot;rank&quot;) %&gt;%
  drop_na() %&gt;%
  group_by(artist) %&gt;%
  summarise(artist.best=min(rank, na.rm=T))</code></pre>
<pre><code>## # A tibble: 228 × 2
##    artist              artist.best
##    &lt;chr&gt;                     &lt;dbl&gt;
##  1 2 Pac                        72
##  2 2Ge+her                      87
##  3 3 Doors Down                  3
##  4 504 Boyz                     17
##  5 98^0                          2
##  6 A*Teens                      95
##  7 Aaliyah                       1
##  8 Adams, Yolanda               57
##  9 Adkins, Trace                65
## 10 Aguilera, Christina           1
## # … with 218 more rows</code></pre>
<p>Let’s try another one: we can calculate the number of weeks that an
artist spent on Top 100 by simply counting the number of rows that the
artist shows up in (after having dropped all of the rows containing NAs,
that should be what is left).</p>
<pre class="r"><code>billboard %&gt;% 
  pivot_longer(cols=starts_with(&quot;wk&quot;), names_to=&quot;week&quot;, values_to=&quot;rank&quot;) %&gt;%
  drop_na() %&gt;%
  group_by(artist) %&gt;%
  summarise(artist.weeks=n())</code></pre>
<pre><code>## # A tibble: 228 × 2
##    artist              artist.weeks
##    &lt;chr&gt;                      &lt;int&gt;
##  1 2 Pac                          7
##  2 2Ge+her                        3
##  3 3 Doors Down                  73
##  4 504 Boyz                      18
##  5 98^0                          20
##  6 A*Teens                        5
##  7 Aaliyah                       52
##  8 Adams, Yolanda                20
##  9 Adkins, Trace                 11
## 10 Aguilera, Christina           67
## # … with 218 more rows</code></pre>
<p>We can also do both summary functions in one go. Let’s do that and
save the table as artist_dat:</p>
<pre class="r"><code>artist_dat=billboard %&gt;% 
  pivot_longer(cols=starts_with(&quot;wk&quot;), names_to=&quot;week&quot;, values_to=&quot;rank&quot;) %&gt;%
  drop_na() %&gt;%
  group_by(artist) %&gt;%
  summarise(artist.weeks=n(), artist.best=min(rank))

artist_dat</code></pre>
<pre><code>## # A tibble: 228 × 3
##    artist              artist.weeks artist.best
##    &lt;chr&gt;                      &lt;int&gt;       &lt;dbl&gt;
##  1 2 Pac                          7          72
##  2 2Ge+her                        3          87
##  3 3 Doors Down                  73           3
##  4 504 Boyz                      18          17
##  5 98^0                          20           2
##  6 A*Teens                        5          95
##  7 Aaliyah                       52           1
##  8 Adams, Yolanda                20          57
##  9 Adkins, Trace                 11          65
## 10 Aguilera, Christina           67           1
## # … with 218 more rows</code></pre>
</div>
<div id="add-new-variables-using-mutate" class="section level3">
<h3>3.7. Add new variables using <code>mutate()</code></h3>
<p>You can make new variables (columns). You’ll often do this if want to
calculate some new variable based on existing variables.</p>
<pre class="r"><code>artist_dat %&gt;%
  mutate(top5= artist.best &lt;=5) %&gt;% #TRUE if artist&#39;s song was ever in Top 5
  mutate(weeks.prop = artist.weeks/max(artist.weeks)) #weeks on list as proportion of maximum value</code></pre>
<pre><code>## # A tibble: 228 × 5
##    artist              artist.weeks artist.best top5  weeks.prop
##    &lt;chr&gt;                      &lt;int&gt;       &lt;dbl&gt; &lt;lgl&gt;      &lt;dbl&gt;
##  1 2 Pac                          7          72 FALSE     0.0673
##  2 2Ge+her                        3          87 FALSE     0.0288
##  3 3 Doors Down                  73           3 TRUE      0.702 
##  4 504 Boyz                      18          17 FALSE     0.173 
##  5 98^0                          20           2 TRUE      0.192 
##  6 A*Teens                        5          95 FALSE     0.0481
##  7 Aaliyah                       52           1 TRUE      0.5   
##  8 Adams, Yolanda                20          57 FALSE     0.192 
##  9 Adkins, Trace                 11          65 FALSE     0.106 
## 10 Aguilera, Christina           67           1 TRUE      0.644 
## # … with 218 more rows</code></pre>
</div>
<div id="join-two-different-data" class="section level3">
<h3>3.8. Join two different data</h3>
<p>The four main join functions all seek to merge data using matching
columns (either matching column names, or manually designated using the
<code>by=</code> argument). But they differ in which rows they will
keep:</p>
<ul>
<li><p><code>left_join(x, y)</code>: match up the values in designated
columns of x and y, and keep all rows in x. NAs show up when a value is
present in x but not y.</p></li>
<li><p><code>right_join(x, y)</code>: match up the values in designated
columns of x and y, and keep all rows in y. NAs show up when a value is
present in y but not x.</p></li>
<li><p><code>inner_join(x, y)</code>: match up the values in designated
columns of x and y, and keep only rows in which x and y values matched.
No NAs show up.</p></li>
<li><p>`full_join(x, y): match up the values in designated columns of x
and y, and keep all rows in x and y, even if they don’t match. NAs
whenever value in one table doesn’t have a match in the other.</p></li>
</ul>
<p>Let’s demonstrate this by comparing the <code>billboard</code> data
with the <code>artist_dat</code> table that we created above. The
<code>billboard</code> data has more rows than <code>artist_dat</code>
because some artists show up in multiple rows (if they have multiple
songs in the charts). We will remove the columns with “wk” so we can see
the results more easily.</p>
<pre class="r"><code>left_join(billboard, artist_dat) %&gt;%
  select(-starts_with(&quot;wk&quot;), -date.entered)</code></pre>
<pre><code>## # A tibble: 317 × 4
##    artist         track                   artist.weeks artist.best
##    &lt;chr&gt;          &lt;chr&gt;                          &lt;int&gt;       &lt;dbl&gt;
##  1 2 Pac          Baby Don&#39;t Cry (Keep...            7          72
##  2 2Ge+her        The Hardest Part Of ...            3          87
##  3 3 Doors Down   Kryptonite                        73           3
##  4 3 Doors Down   Loser                             73           3
##  5 504 Boyz       Wobble Wobble                     18          17
##  6 98^0           Give Me Just One Nig...           20           2
##  7 A*Teens        Dancing Queen                      5          95
##  8 Aaliyah        I Don&#39;t Wanna                     52           1
##  9 Aaliyah        Try Again                         52           1
## 10 Adams, Yolanda Open My Heart                     20          57
## # … with 307 more rows</code></pre>
<p>You can see that whenever the artist has multiple songs on the list,
the “artist.weeks” and “artist.best” variables are repeated (because
these are the stats for the artist).</p>
</div>
</div>
<div id="population-growth-trends-across-the-world"
class="section level2">
<h2>4. Population growth trends across the world</h2>
<p>The World Bank actually makes it very easy to download a huge amount
of data very easily. You could just go to the <a
href="https://data.worldbank.org/">World Bankd Open Data site</a> and
search for data and download them in a few clicks. There are even
packages such as <code>WDI</code> and <code>wbstats</code> that allow
you to query and pull data from this site from within R.</p>
<p>However, for the purposes of this exercise, we will deal with several
datasets that are included in the packages we have loaded above.</p>
<p><br></p>
<div id="world_bank_pop-population-data-from-world-bank-2000-2017"
class="section level3">
<h3>4.1. <code>world_bank_pop</code>: Population data from World Bank
(2000-2017)</h3>
<p>First is the <code>world_bank_pop</code> dataset that is included in
the <code>tidyr</code> package (which is part of the the tidyverse
suite). Start by pulling up the help file for the dataset</p>
<pre class="r"><code>?world_bank_pop</code></pre>
<p>Let’s take a peak at the data, which is in “tibble” format:</p>
<pre class="r"><code>world_bank_pop</code></pre>
<pre><code>## # A tibble: 1,056 × 20
##    country indicator        `2000` `2001` `2002` `2003`  `2004`  `2005`   `2006`
##    &lt;chr&gt;   &lt;chr&gt;             &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
##  1 ABW     SP.URB.TOTL    42444    4.30e4 4.37e4 4.42e4 4.47e+4 4.49e+4  4.49e+4
##  2 ABW     SP.URB.GROW        1.18 1.41e0 1.43e0 1.31e0 9.51e-1 4.91e-1 -1.78e-2
##  3 ABW     SP.POP.TOTL    90853    9.29e4 9.50e4 9.70e4 9.87e+4 1.00e+5  1.01e+5
##  4 ABW     SP.POP.GROW        2.06 2.23e0 2.23e0 2.11e0 1.76e+0 1.30e+0  7.98e-1
##  5 AFG     SP.URB.TOTL  4436299    4.65e6 4.89e6 5.16e6 5.43e+6 5.69e+6  5.93e+6
##  6 AFG     SP.URB.GROW        3.91 4.66e0 5.13e0 5.23e0 5.12e+0 4.77e+0  4.12e+0
##  7 AFG     SP.POP.TOTL 20093756    2.10e7 2.20e7 2.31e7 2.41e+7 2.51e+7  2.59e+7
##  8 AFG     SP.POP.GROW        3.49 4.25e0 4.72e0 4.82e0 4.47e+0 3.87e+0  3.23e+0
##  9 AGO     SP.URB.TOTL  8234766    8.71e6 9.22e6 9.77e6 1.03e+7 1.09e+7  1.15e+7
## 10 AGO     SP.URB.GROW        5.44 5.59e0 5.70e0 5.76e0 5.75e+0 5.69e+0  4.92e+0
## # … with 1,046 more rows, and 11 more variables: `2007` &lt;dbl&gt;, `2008` &lt;dbl&gt;,
## #   `2009` &lt;dbl&gt;, `2010` &lt;dbl&gt;, `2011` &lt;dbl&gt;, `2012` &lt;dbl&gt;, `2013` &lt;dbl&gt;,
## #   `2014` &lt;dbl&gt;, `2015` &lt;dbl&gt;, `2016` &lt;dbl&gt;, `2017` &lt;dbl&gt;</code></pre>
<p>Notice that each country is repeated across 4 rows. This is because
there are actually 4 different “indicators” for each country, and so
each country x indicator combination takes up a row. The rest of the
columns are years, from 2000 to 2017.</p>
<p>Also notice that the numbers in the column names have a backquote, or
“`” around them. In R, this allows numbers to be interpreted as text
(and column names have to be text).</p>
<p>So, if you wanted to pull up the “2001” column, this will NOT
work…</p>
<pre class="r"><code>world_bank_pop$2001</code></pre>
<p>…but this will work</p>
<pre class="r"><code>world_bank_pop$`2001`</code></pre>
<p><br></p>
<hr />
</div>
<div
id="problem-1-countries-that-are-not-countries-merging-datasets-with-join-functions"
class="section level3">
<h3>4.2. Problem 1: “Countries” that are not countries: Merging datasets
with <code>join</code> functions</h3>
<p>We are going to start by diving into the <code>world_bank_pop</code>
dataset.</p>
<p>Let’s take a peek at the dataset again and see what we have…</p>
<pre class="r"><code>world_bank_pop</code></pre>
<pre><code>## # A tibble: 1,056 × 20
##    country indicator        `2000` `2001` `2002` `2003`  `2004`  `2005`   `2006`
##    &lt;chr&gt;   &lt;chr&gt;             &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
##  1 ABW     SP.URB.TOTL    42444    4.30e4 4.37e4 4.42e4 4.47e+4 4.49e+4  4.49e+4
##  2 ABW     SP.URB.GROW        1.18 1.41e0 1.43e0 1.31e0 9.51e-1 4.91e-1 -1.78e-2
##  3 ABW     SP.POP.TOTL    90853    9.29e4 9.50e4 9.70e4 9.87e+4 1.00e+5  1.01e+5
##  4 ABW     SP.POP.GROW        2.06 2.23e0 2.23e0 2.11e0 1.76e+0 1.30e+0  7.98e-1
##  5 AFG     SP.URB.TOTL  4436299    4.65e6 4.89e6 5.16e6 5.43e+6 5.69e+6  5.93e+6
##  6 AFG     SP.URB.GROW        3.91 4.66e0 5.13e0 5.23e0 5.12e+0 4.77e+0  4.12e+0
##  7 AFG     SP.POP.TOTL 20093756    2.10e7 2.20e7 2.31e7 2.41e+7 2.51e+7  2.59e+7
##  8 AFG     SP.POP.GROW        3.49 4.25e0 4.72e0 4.82e0 4.47e+0 3.87e+0  3.23e+0
##  9 AGO     SP.URB.TOTL  8234766    8.71e6 9.22e6 9.77e6 1.03e+7 1.09e+7  1.15e+7
## 10 AGO     SP.URB.GROW        5.44 5.59e0 5.70e0 5.76e0 5.75e+0 5.69e+0  4.92e+0
## # … with 1,046 more rows, and 11 more variables: `2007` &lt;dbl&gt;, `2008` &lt;dbl&gt;,
## #   `2009` &lt;dbl&gt;, `2010` &lt;dbl&gt;, `2011` &lt;dbl&gt;, `2012` &lt;dbl&gt;, `2013` &lt;dbl&gt;,
## #   `2014` &lt;dbl&gt;, `2015` &lt;dbl&gt;, `2016` &lt;dbl&gt;, `2017` &lt;dbl&gt;</code></pre>
<p>I want to start by looking at how many unique countries we actually
have here.</p>
<pre class="r"><code>length(unique(world_bank_pop$country)) #this gives us the number of unique values in the &quot;country&quot; column</code></pre>
<pre><code>## [1] 264</code></pre>
<p>You can see that there are way more “countries” here than there are
in the world. As of 2022, there are 193 countries in the United Nations,
though if we add soverign states that are not recognized by UN (e.g.,
Taiwan, Kosovo, etc.), the list is about 206… and there are more if we
include disputed territories.</p>
<p>The reason the World Bank data has even more than that is because
some of the “countries” include “aggregates” like “Arab World” or
“High-income Countries”.</p>
<p>Unfortunately, the <code>world_bank_pop</code> dataset does not
include any variables that allow us to differentiate the countries from
the aggregates! However, we can solve this problem by pulling the
metadata for countries from the World Bank. We can do this by using the
<code>wb_countries()</code> function from the <em>wbstats</em>
package.</p>
<p>Let’s pull the country metadata and save it as an object called
“metadata”:</p>
<pre class="r"><code>metadata=wb_countries()</code></pre>
<pre class="r"><code>metadata</code></pre>
<pre><code>## # A tibble: 299 × 18
##    iso3c iso2c country capital_city longitude latitude region_iso3c region_iso2c
##    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;            &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;       
##  1 ABW   AW    Aruba   Oranjestad      -70.0     12.5  LCN          ZJ          
##  2 AFE   ZH    Africa… &lt;NA&gt;             NA       NA    &lt;NA&gt;         &lt;NA&gt;        
##  3 AFG   AF    Afghan… Kabul            69.2     34.5  SAS          8S          
##  4 AFR   A9    Africa  &lt;NA&gt;             NA       NA    &lt;NA&gt;         &lt;NA&gt;        
##  5 AFW   ZI    Africa… &lt;NA&gt;             NA       NA    &lt;NA&gt;         &lt;NA&gt;        
##  6 AGO   AO    Angola  Luanda           13.2     -8.81 SSF          ZG          
##  7 ALB   AL    Albania Tirane           19.8     41.3  ECS          Z7          
##  8 AND   AD    Andorra Andorra la …      1.52    42.5  ECS          Z7          
##  9 ARB   1A    Arab W… &lt;NA&gt;             NA       NA    &lt;NA&gt;         &lt;NA&gt;        
## 10 ARE   AE    United… Abu Dhabi        54.4     24.5  MEA          ZQ          
## # … with 289 more rows, and 10 more variables: region &lt;chr&gt;,
## #   admin_region_iso3c &lt;chr&gt;, admin_region_iso2c &lt;chr&gt;, admin_region &lt;chr&gt;,
## #   income_level_iso3c &lt;chr&gt;, income_level_iso2c &lt;chr&gt;, income_level &lt;chr&gt;,
## #   lending_type_iso3c &lt;chr&gt;, lending_type_iso2c &lt;chr&gt;, lending_type &lt;chr&gt;</code></pre>
<pre class="r"><code>head(metadata$region)</code></pre>
<pre><code>## [1] &quot;Latin America &amp; Caribbean&quot; &quot;Aggregates&quot;               
## [3] &quot;South Asia&quot;                &quot;Aggregates&quot;               
## [5] &quot;Aggregates&quot;                &quot;Sub-Saharan Africa&quot;</code></pre>
<p>So this column shows us the “Aggregates”.</p>
<p>So, we can use this to filter the metadata to exclude the Aggregate
codes.</p>
<pre class="r"><code>metadata %&gt;% dplyr::filter(region != &quot;Aggregates&quot;)</code></pre>
<pre><code>## # A tibble: 218 × 18
##    iso3c iso2c country capital_city longitude latitude region_iso3c region_iso2c
##    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;            &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;       
##  1 ABW   AW    Aruba   Oranjestad      -70.0     12.5  LCN          ZJ          
##  2 AFG   AF    Afghan… Kabul            69.2     34.5  SAS          8S          
##  3 AGO   AO    Angola  Luanda           13.2     -8.81 SSF          ZG          
##  4 ALB   AL    Albania Tirane           19.8     41.3  ECS          Z7          
##  5 AND   AD    Andorra Andorra la …      1.52    42.5  ECS          Z7          
##  6 ARE   AE    United… Abu Dhabi        54.4     24.5  MEA          ZQ          
##  7 ARG   AR    Argent… Buenos Aires    -58.4    -34.6  LCN          ZJ          
##  8 ARM   AM    Armenia Yerevan          44.5     40.2  ECS          Z7          
##  9 ASM   AS    Americ… Pago Pago      -171.     -14.3  EAS          Z4          
## 10 ATG   AG    Antigu… Saint John&#39;s    -61.8     17.1  LCN          ZJ          
## # … with 208 more rows, and 10 more variables: region &lt;chr&gt;,
## #   admin_region_iso3c &lt;chr&gt;, admin_region_iso2c &lt;chr&gt;, admin_region &lt;chr&gt;,
## #   income_level_iso3c &lt;chr&gt;, income_level_iso2c &lt;chr&gt;, income_level &lt;chr&gt;,
## #   lending_type_iso3c &lt;chr&gt;, lending_type_iso2c &lt;chr&gt;, lending_type &lt;chr&gt;</code></pre>
<p>Let’s also pare down the data to a few variables we might be
interested in, including region and income level:</p>
<pre class="r"><code>metadata %&gt;% 
  dplyr::filter(region != &quot;Aggregates&quot;) %&gt;%
  select(iso3c, iso2c, country, region, income_level)</code></pre>
<pre><code>## # A tibble: 218 × 5
##    iso3c iso2c country              region                     income_level     
##    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;                &lt;chr&gt;                      &lt;chr&gt;            
##  1 ABW   AW    Aruba                Latin America &amp; Caribbean  High income      
##  2 AFG   AF    Afghanistan          South Asia                 Low income       
##  3 AGO   AO    Angola               Sub-Saharan Africa         Lower middle inc…
##  4 ALB   AL    Albania              Europe &amp; Central Asia      Upper middle inc…
##  5 AND   AD    Andorra              Europe &amp; Central Asia      High income      
##  6 ARE   AE    United Arab Emirates Middle East &amp; North Africa High income      
##  7 ARG   AR    Argentina            Latin America &amp; Caribbean  Upper middle inc…
##  8 ARM   AM    Armenia              Europe &amp; Central Asia      Upper middle inc…
##  9 ASM   AS    American Samoa       East Asia &amp; Pacific        Upper middle inc…
## 10 ATG   AG    Antigua and Barbuda  Latin America &amp; Caribbean  High income      
## # … with 208 more rows</code></pre>
<p>Ok, this looks useful. Let’s save it as a data table called
<code>countries</code></p>
<pre class="r"><code>countries=metadata %&gt;% 
  dplyr::filter(region != &quot;Aggregates&quot;) %&gt;%
  select(iso3c, iso2c, country.name=country, region, income_level) %&gt;%
  mutate(income_level=factor(income_level, levels=c(&quot;Low income&quot;, &quot;Lower middle income&quot;, &quot;Upper middle income&quot;, &quot;High income&quot;)))</code></pre>
<p>Now, we are going to use the <code>inner_join()</code> function to
make a version of the world bank population data that is only for actual
countries (not aggregates):</p>
<pre class="r"><code>popdat_countries=inner_join(world_bank_pop, countries, by=c(&quot;country&quot; = &quot;iso3c&quot;))
popdat_countries</code></pre>
<pre><code>## # A tibble: 868 × 24
##    country indicator        `2000` `2001` `2002` `2003`  `2004`  `2005`   `2006`
##    &lt;chr&gt;   &lt;chr&gt;             &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
##  1 ABW     SP.URB.TOTL    42444    4.30e4 4.37e4 4.42e4 4.47e+4 4.49e+4  4.49e+4
##  2 ABW     SP.URB.GROW        1.18 1.41e0 1.43e0 1.31e0 9.51e-1 4.91e-1 -1.78e-2
##  3 ABW     SP.POP.TOTL    90853    9.29e4 9.50e4 9.70e4 9.87e+4 1.00e+5  1.01e+5
##  4 ABW     SP.POP.GROW        2.06 2.23e0 2.23e0 2.11e0 1.76e+0 1.30e+0  7.98e-1
##  5 AFG     SP.URB.TOTL  4436299    4.65e6 4.89e6 5.16e6 5.43e+6 5.69e+6  5.93e+6
##  6 AFG     SP.URB.GROW        3.91 4.66e0 5.13e0 5.23e0 5.12e+0 4.77e+0  4.12e+0
##  7 AFG     SP.POP.TOTL 20093756    2.10e7 2.20e7 2.31e7 2.41e+7 2.51e+7  2.59e+7
##  8 AFG     SP.POP.GROW        3.49 4.25e0 4.72e0 4.82e0 4.47e+0 3.87e+0  3.23e+0
##  9 AGO     SP.URB.TOTL  8234766    8.71e6 9.22e6 9.77e6 1.03e+7 1.09e+7  1.15e+7
## 10 AGO     SP.URB.GROW        5.44 5.59e0 5.70e0 5.76e0 5.75e+0 5.69e+0  4.92e+0
## # … with 858 more rows, and 15 more variables: `2007` &lt;dbl&gt;, `2008` &lt;dbl&gt;,
## #   `2009` &lt;dbl&gt;, `2010` &lt;dbl&gt;, `2011` &lt;dbl&gt;, `2012` &lt;dbl&gt;, `2013` &lt;dbl&gt;,
## #   `2014` &lt;dbl&gt;, `2015` &lt;dbl&gt;, `2016` &lt;dbl&gt;, `2017` &lt;dbl&gt;, iso2c &lt;chr&gt;,
## #   country.name &lt;chr&gt;, region &lt;chr&gt;, income_level &lt;fct&gt;</code></pre>
</div>
<div id="narrow-down-the-data-to-large-countries"
class="section level3">
<h3>4.3. Narrow down the data to large countries</h3>
<p>As mentioned above (Section 1.1), each row is a country x indicator
combination, with 4 different indicators. The indicators are:</p>
<ul>
<li><p>SP.POP.GROW = population growth</p></li>
<li><p>SP.POP.TOTL = total population</p></li>
<li><p>SP.URB.GROW = urban population growth</p></li>
<li><p>SP.URB.TOTL = total urban population</p></li>
</ul>
<p>So, we will create a data table called <code>pop_totals</code> that
is just the “total population” data.</p>
<pre class="r"><code>pop_totals=popdat_countries %&gt;% 
  dplyr::filter(indicator==&quot;SP.POP.TOTL&quot;) 

pop_totals</code></pre>
<pre><code>## # A tibble: 217 × 24
##    country indicator     `2000` `2001` `2002` `2003` `2004` `2005` `2006` `2007`
##    &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
##  1 ABW     SP.POP.TOTL    90853 9.29e4 9.50e4 9.70e4 9.87e4 1.00e5 1.01e5 1.01e5
##  2 AFG     SP.POP.TOTL 20093756 2.10e7 2.20e7 2.31e7 2.41e7 2.51e7 2.59e7 2.66e7
##  3 AGO     SP.POP.TOTL 16440924 1.70e7 1.76e7 1.82e7 1.89e7 1.96e7 2.03e7 2.10e7
##  4 ALB     SP.POP.TOTL  3089027 3.06e6 3.05e6 3.04e6 3.03e6 3.01e6 2.99e6 2.97e6
##  5 AND     SP.POP.TOTL    65390 6.73e4 7.00e4 7.32e4 7.62e4 7.89e4 8.10e4 8.27e4
##  6 ARE     SP.POP.TOTL  3154925 3.33e6 3.51e6 3.74e6 4.09e6 4.58e6 5.24e6 6.04e6
##  7 ARG     SP.POP.TOTL 37057452 3.75e7 3.79e7 3.83e7 3.87e7 3.91e7 3.96e7 4.00e7
##  8 ARM     SP.POP.TOTL  3069588 3.05e6 3.03e6 3.02e6 3.00e6 2.98e6 2.96e6 2.93e6
##  9 ASM     SP.POP.TOTL    57521 5.82e4 5.87e4 5.91e4 5.93e4 5.91e4 5.86e4 5.79e4
## 10 ATG     SP.POP.TOTL    83584 8.51e4 8.63e4 8.73e4 8.83e4 8.93e4 9.03e4 9.14e4
## # … with 207 more rows, and 14 more variables: `2008` &lt;dbl&gt;, `2009` &lt;dbl&gt;,
## #   `2010` &lt;dbl&gt;, `2011` &lt;dbl&gt;, `2012` &lt;dbl&gt;, `2013` &lt;dbl&gt;, `2014` &lt;dbl&gt;,
## #   `2015` &lt;dbl&gt;, `2016` &lt;dbl&gt;, `2017` &lt;dbl&gt;, iso2c &lt;chr&gt;, country.name &lt;chr&gt;,
## #   region &lt;chr&gt;, income_level &lt;fct&gt;</code></pre>
<p>From this population size data, let’s figure out what is the 90th
percentile in population size in 2017. We are going to get this number
by doing <code>pull()</code> to get the 2017 population sizes as a
vector, and use <code>quantile()</code> to get the 90th percentile. Save
that value as <code>upper_pop</code>.</p>
<pre class="r"><code>upper_pop=pop_totals %&gt;%
  pull(`2017`) %&gt;% 
  quantile(., probs=0.90, na.rm=T) # this function allows us to find the value at #th percentile
upper_pop</code></pre>
<pre><code>##      90% 
## 63286844</code></pre>
<p>Now, we can use this 90th percentile value to filter the population
size data to just the top 10% largest countries. We will create a
one-column tibble called <code>large_countries()</code> to save this
list of country bodes.</p>
<pre class="r"><code>large_countries=pop_totals %&gt;% 
  dplyr::filter(`2017` &gt; upper_pop) %&gt;% 
  select(country)
large_countries</code></pre>
<pre><code>## # A tibble: 22 × 1
##    country
##    &lt;chr&gt;  
##  1 BGD    
##  2 BRA    
##  3 CHN    
##  4 COD    
##  5 DEU    
##  6 EGY    
##  7 ETH    
##  8 FRA    
##  9 GBR    
## 10 IDN    
## # … with 12 more rows</code></pre>
</div>
<div id="now-get-the-population-growth-data-for-the-largest-countries"
class="section level3">
<h3>4.4. Now get the population <strong>growth</strong> data for the
largest countries</h3>
<p>We will now go back to the population data from countries (excluding
aggregates), and then filter the data to just the population growth
values, then use <code>right_join()</code> to keep only the largest 10%
of countries</p>
<pre class="r"><code>popgrowth_large=popdat_countries %&gt;% 
  dplyr::filter(indicator==&quot;SP.POP.GROW&quot;) %&gt;%
  right_join(., large_countries, keep=FALSE) </code></pre>
<pre><code>## Joining, by = &quot;country&quot;</code></pre>
<pre class="r"><code>popgrowth_large</code></pre>
<pre><code>## # A tibble: 22 × 24
##    country indicator   `2000` `2001` `2002` `2003`  `2004`  `2005` `2006` `2007`
##    &lt;chr&gt;   &lt;chr&gt;        &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
##  1 BGD     SP.POP.GROW  1.96   1.90   1.84  1.75    1.63    1.49    1.34   1.21 
##  2 BRA     SP.POP.GROW  1.45   1.40   1.34  1.29    1.23    1.17    1.11   1.06 
##  3 CHN     SP.POP.GROW  0.788  0.726  0.670 0.623   0.594   0.588   0.558  0.522
##  4 COD     SP.POP.GROW  2.53   2.76   2.93  3.07    3.15    3.19    3.22   3.26 
##  5 DEU     SP.POP.GROW  0.135  0.168  0.168 0.0554 -0.0217 -0.0568 -0.113 -0.134
##  6 EGY     SP.POP.GROW  1.85   1.87   1.90  1.90    1.87    1.84    1.78   1.75 
##  7 ETH     SP.POP.GROW  2.89   2.90   2.89  2.86    2.83    2.78    2.73   2.69 
##  8 FRA     SP.POP.GROW  0.685  0.728  0.727 0.709   0.736   0.754   0.697  0.619
##  9 GBR     SP.POP.GROW  0.357  0.385  0.423 0.466   0.569   0.687   0.735  0.779
## 10 IDN     SP.POP.GROW  1.39   1.39   1.39  1.39    1.38    1.38    1.37   1.36 
## # … with 12 more rows, and 14 more variables: `2008` &lt;dbl&gt;, `2009` &lt;dbl&gt;,
## #   `2010` &lt;dbl&gt;, `2011` &lt;dbl&gt;, `2012` &lt;dbl&gt;, `2013` &lt;dbl&gt;, `2014` &lt;dbl&gt;,
## #   `2015` &lt;dbl&gt;, `2016` &lt;dbl&gt;, `2017` &lt;dbl&gt;, iso2c &lt;chr&gt;, country.name &lt;chr&gt;,
## #   region &lt;chr&gt;, income_level &lt;fct&gt;</code></pre>
<p>We can convert this data into long-format. First, remove some of the
variables we don’t need right now, and then convert to long-format.</p>
<pre class="r"><code>popgrowth_large %&gt;% 
  select(-indicator, -country.name, -iso2c, -region, -income_level) %&gt;%
  pivot_longer(!country, names_to=&quot;year&quot;, values_to=&quot;growth_rate&quot;)</code></pre>
<pre><code>## # A tibble: 396 × 3
##    country year  growth_rate
##    &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt;
##  1 BGD     2000         1.96
##  2 BGD     2001         1.90
##  3 BGD     2002         1.84
##  4 BGD     2003         1.75
##  5 BGD     2004         1.63
##  6 BGD     2005         1.49
##  7 BGD     2006         1.34
##  8 BGD     2007         1.21
##  9 BGD     2008         1.13
## 10 BGD     2009         1.10
## # … with 386 more rows</code></pre>
<p>Ok, so now we can use this population growth data from large
countries and plot the change over time for each country:</p>
<pre class="r"><code>popgrowth_plot=popgrowth_large %&gt;% 
  select(-indicator, -country.name, -iso2c, -region, -income_level) %&gt;% 
  pivot_longer(!country, names_to=&quot;year&quot;, values_to=&quot;growth_rate&quot;)

ggplot(popgrowth_plot, aes(x=as.numeric(year), y=growth_rate, color=country)) +
  geom_line() +
  theme_bw()</code></pre>
<p><img src="06.tidyverse_files/figure-html/unnamed-chunk-41-1.png" width="672" /></p>
</div>
<div
id="exploring-the-relationships-between-income-level-region-and-population-growth"
class="section level3">
<h3>4.4. Exploring the relationships between income level, region, and
population growth</h3>
<p>Now, let’s create a tibble that contains the population growth data,
by also the income level designation for each country. We will then get
the average annual population growth rate across each of the four income
levels.</p>
<pre class="r"><code>popgrowth_income=popdat_countries %&gt;% 
  dplyr::filter(indicator==&quot;SP.POP.GROW&quot;) %&gt;%
  dplyr::filter(is.na(income_level)==F) %&gt;% #skip if income level is missing
  select(-indicator, -country.name, -iso2c, -region) %&gt;% #pare down the data a bit &amp; pivot longer
  pivot_longer(cols=-c(country, income_level), names_to=&quot;year&quot;, values_to=&quot;growth_rate&quot;) %&gt;%
  group_by(income_level, year) %&gt;%
  summarise(mean_se(growth_rate)) #calculates mean + standard error of the mean.</code></pre>
<pre><code>## `summarise()` has grouped output by &#39;income_level&#39;. You can override using the
## `.groups` argument.</code></pre>
<pre class="r"><code>popgrowth_income</code></pre>
<pre><code>## # A tibble: 72 × 5
## # Groups:   income_level [4]
##    income_level year      y  ymin  ymax
##    &lt;fct&gt;        &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 Low income   2000   2.96  2.78  3.15
##  2 Low income   2001   2.91  2.77  3.05
##  3 Low income   2002   2.88  2.73  3.03
##  4 Low income   2003   2.85  2.69  3.02
##  5 Low income   2004   2.85  2.70  3.01
##  6 Low income   2005   2.87  2.73  3.00
##  7 Low income   2006   2.88  2.75  3.01
##  8 Low income   2007   2.88  2.74  3.03
##  9 Low income   2008   2.85  2.70  3.00
## 10 Low income   2009   2.78  2.64  2.93
## # … with 62 more rows</code></pre>
<p>Let’s plot this. We can draw the line, and then draw a ribbon around
the line to indicate confidence interval</p>
<pre class="r"><code>ggplot(popgrowth_income, aes(x=as.numeric(year), y=y, group=income_level)) +
  geom_line(aes(color=income_level)) +
  geom_ribbon(aes(ymin=ymin, ymax=ymax), alpha=0.3, fill=&quot;gray&quot;) +
  theme_bw()</code></pre>
<p><img src="06.tidyverse_files/figure-html/unnamed-chunk-43-1.png" width="672" />
We can also create a plot showing how income levels have different
effects on population growth rates depending on the region of the
world.</p>
<pre class="r"><code>popdat_anova=popdat_countries %&gt;% 
  dplyr::filter(indicator==&quot;SP.POP.GROW&quot;) %&gt;%
  select(country, `2017`, region, income_level) %&gt;%
  dplyr::filter(income_level!=&quot;Not classified&quot;)

ggplot(popdat_anova, aes(x=income_level, y=`2017`)) +
  geom_boxplot(aes(color=income_level)) +
  facet_wrap(~region, nrow=3)</code></pre>
<pre><code>## Warning: Removed 1 rows containing non-finite values (stat_boxplot).</code></pre>
<p><img src="06.tidyverse_files/figure-html/unnamed-chunk-44-1.png" width="672" />
Lower income countries have higher population growth rate than those
with high income in some regions (sub-Saharan Africa), while in others
growth rate is bigger for high earners.</p>
</div>
<div id="stats" class="section level3">
<h3>4.6. Stats</h3>
<pre class="r"><code>lm.fit=lm(`2017`~region*income_level, data=popdat_anova)
summary(lm.fit)</code></pre>
<pre><code>## 
## Call:
## lm(formula = `2017` ~ region * income_level, data = popdat_anova)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -2.8376 -0.4021  0.0016  0.3416  3.2863 
## 
## Coefficients: (6 not defined because of singularities)
##                                                                  Estimate
## (Intercept)                                                        0.4811
## regionEurope &amp; Central Asia                                       -0.8591
## regionLatin America &amp; Caribbean                                   -0.4282
## regionMiddle East &amp; North Africa                                   0.2746
## regionNorth America                                               -0.5154
## regionSouth Asia                                                   2.0097
## regionSub-Saharan Africa                                           2.2767
## income_levelLower middle income                                    0.9778
## income_levelUpper middle income                                    0.1715
## income_levelHigh income                                            0.7281
## regionEurope &amp; Central Asia:income_levelLower middle income        0.7481
## regionLatin America &amp; Caribbean:income_levelLower middle income    0.1674
## regionMiddle East &amp; North Africa:income_levelLower middle income  -0.1244
## regionNorth America:income_levelLower middle income                    NA
## regionSouth Asia:income_levelLower middle income                  -2.2031
## regionSub-Saharan Africa:income_levelLower middle income          -1.3331
## regionEurope &amp; Central Asia:income_levelUpper middle income        0.5305
## regionLatin America &amp; Caribbean:income_levelUpper middle income    0.6975
## regionMiddle East &amp; North Africa:income_levelUpper middle income   1.3060
## regionNorth America:income_levelUpper middle income                    NA
## regionSouth Asia:income_levelUpper middle income                  -0.6777
## regionSub-Saharan Africa:income_levelUpper middle income          -1.0472
## regionEurope &amp; Central Asia:income_levelHigh income                    NA
## regionLatin America &amp; Caribbean:income_levelHigh income                NA
## regionMiddle East &amp; North Africa:income_levelHigh income           1.2067
## regionNorth America:income_levelHigh income                            NA
## regionSouth Asia:income_levelHigh income                               NA
## regionSub-Saharan Africa:income_levelHigh income                  -2.2619
##                                                                  Std. Error
## (Intercept)                                                          0.7844
## regionEurope &amp; Central Asia                                          0.2520
## regionLatin America &amp; Caribbean                                      0.2890
## regionMiddle East &amp; North Africa                                     0.9607
## regionNorth America                                                  0.5024
## regionSouth Asia                                                     1.1093
## regionSub-Saharan Africa                                             0.8013
## income_levelLower middle income                                      0.8119
## income_levelUpper middle income                                      0.8268
## income_levelHigh income                                              0.8140
## regionEurope &amp; Central Asia:income_levelLower middle income          0.5112
## regionLatin America &amp; Caribbean:income_levelLower middle income      0.5005
## regionMiddle East &amp; North Africa:income_levelLower middle income     1.0216
## regionNorth America:income_levelLower middle income                      NA
## regionSouth Asia:income_levelLower middle income                     1.1735
## regionSub-Saharan Africa:income_levelLower middle income             0.8498
## regionEurope &amp; Central Asia:income_levelUpper middle income          0.4127
## regionLatin America &amp; Caribbean:income_levelUpper middle income      0.4293
## regionMiddle East &amp; North Africa:income_levelUpper middle income     1.0938
## regionNorth America:income_levelUpper middle income                      NA
## regionSouth Asia:income_levelUpper middle income                     1.3835
## regionSub-Saharan Africa:income_levelUpper middle income             0.9016
## regionEurope &amp; Central Asia:income_levelHigh income                      NA
## regionLatin America &amp; Caribbean:income_levelHigh income                  NA
## regionMiddle East &amp; North Africa:income_levelHigh income             1.0233
## regionNorth America:income_levelHigh income                              NA
## regionSouth Asia:income_levelHigh income                                 NA
## regionSub-Saharan Africa:income_levelHigh income                     1.1422
##                                                                  t value
## (Intercept)                                                        0.613
## regionEurope &amp; Central Asia                                       -3.409
## regionLatin America &amp; Caribbean                                   -1.482
## regionMiddle East &amp; North Africa                                   0.286
## regionNorth America                                               -1.026
## regionSouth Asia                                                   1.812
## regionSub-Saharan Africa                                           2.841
## income_levelLower middle income                                    1.204
## income_levelUpper middle income                                    0.207
## income_levelHigh income                                            0.894
## regionEurope &amp; Central Asia:income_levelLower middle income        1.463
## regionLatin America &amp; Caribbean:income_levelLower middle income    0.334
## regionMiddle East &amp; North Africa:income_levelLower middle income  -0.122
## regionNorth America:income_levelLower middle income                   NA
## regionSouth Asia:income_levelLower middle income                  -1.877
## regionSub-Saharan Africa:income_levelLower middle income          -1.569
## regionEurope &amp; Central Asia:income_levelUpper middle income        1.285
## regionLatin America &amp; Caribbean:income_levelUpper middle income    1.625
## regionMiddle East &amp; North Africa:income_levelUpper middle income   1.194
## regionNorth America:income_levelUpper middle income                   NA
## regionSouth Asia:income_levelUpper middle income                  -0.490
## regionSub-Saharan Africa:income_levelUpper middle income          -1.161
## regionEurope &amp; Central Asia:income_levelHigh income                   NA
## regionLatin America &amp; Caribbean:income_levelHigh income               NA
## regionMiddle East &amp; North Africa:income_levelHigh income           1.179
## regionNorth America:income_levelHigh income                           NA
## regionSouth Asia:income_levelHigh income                              NA
## regionSub-Saharan Africa:income_levelHigh income                  -1.980
##                                                                  Pr(&gt;|t|)    
## (Intercept)                                                      0.540359    
## regionEurope &amp; Central Asia                                      0.000794 ***
## regionLatin America &amp; Caribbean                                  0.140096    
## regionMiddle East &amp; North Africa                                 0.775333    
## regionNorth America                                              0.306226    
## regionSouth Asia                                                 0.071588 .  
## regionSub-Saharan Africa                                         0.004973 ** 
## income_levelLower middle income                                  0.229959    
## income_levelUpper middle income                                  0.835899    
## income_levelHigh income                                          0.372207    
## regionEurope &amp; Central Asia:income_levelLower middle income      0.144967    
## regionLatin America &amp; Caribbean:income_levelLower middle income  0.738416    
## regionMiddle East &amp; North Africa:income_levelLower middle income 0.903186    
## regionNorth America:income_levelLower middle income                    NA    
## regionSouth Asia:income_levelLower middle income                 0.061960 .  
## regionSub-Saharan Africa:income_levelLower middle income         0.118347    
## regionEurope &amp; Central Asia:income_levelUpper middle income      0.200181    
## regionLatin America &amp; Caribbean:income_levelUpper middle income  0.105822    
## regionMiddle East &amp; North Africa:income_levelUpper middle income 0.233935    
## regionNorth America:income_levelUpper middle income                    NA    
## regionSouth Asia:income_levelUpper middle income                 0.624806    
## regionSub-Saharan Africa:income_levelUpper middle income         0.246888    
## regionEurope &amp; Central Asia:income_levelHigh income                    NA    
## regionLatin America &amp; Caribbean:income_levelHigh income                NA    
## regionMiddle East &amp; North Africa:income_levelHigh income         0.239757    
## regionNorth America:income_levelHigh income                            NA    
## regionSouth Asia:income_levelHigh income                               NA    
## regionSub-Saharan Africa:income_levelHigh income                 0.049090 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.7844 on 193 degrees of freedom
##   (1 observation deleted due to missingness)
## Multiple R-squared:  0.5674, Adjusted R-squared:  0.5204 
## F-statistic: 12.06 on 21 and 193 DF,  p-value: &lt; 2.2e-16</code></pre>
<pre class="r"><code>anova(lm.fit)</code></pre>
<pre><code>## Analysis of Variance Table
## 
## Response: 2017
##                      Df  Sum Sq Mean Sq F value    Pr(&gt;F)    
## region                6 131.828 21.9713 35.7109 &lt; 2.2e-16 ***
## income_level          3   2.949  0.9830  1.5977  0.191299    
## region:income_level  12  20.996  1.7497  2.8438  0.001279 ** 
## Residuals           193 118.744  0.6153                      
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3,h4",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
