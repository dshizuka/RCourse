<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Dai Shizuka" />


<title>Worked Example: Plotting the change in butterfly size with climate change</title>

<script src="site_libs/header-attrs-2.16/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/sandstone.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Intro to R</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="syllabus.html">Syllabus</a>
</li>
<li>
  <a href="modules.html">Modules</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Worked Example: Plotting the change in
butterfly size with climate change</h1>
<h4 class="author">Dai Shizuka</h4>
<h4 class="date">updated 11/15/22</h4>

</div>


<hr />
<div id="things-you-will-learn-in-this-module" class="section level4">
<h4>Things you will learn in this module:</h4>
<ul>
<li><strong>More tricks to plotting</strong></li>
<li><strong>Using publicly available datasets</strong></li>
<li><strong>Implementing a simple statistical analysis (simple linear
regression)</strong></li>
<li><strong>Creating a simple custom function</strong></li>
<li><strong>Repeating a routine with a custom function</strong></li>
</ul>
</div>
<div id="using-data-associated-with-published-papers"
class="section level2">
<h2>5.1 Using data associated with published papers</h2>
<p>Today, we will learn a bit more about plots by trying to re-create a
plot from a recent publication. I find playing with open-access data and
re-creating analyses &amp; figures to be a very fruitful exercise
because you get to learn codes, but you also get to really understand
the studies much better.</p>
<p>For this exercise, I have chosen a paper by Bowden et al. (2015) in
<em>Biology Letters</em>.<a href="#fn1" class="footnote-ref"
id="fnref1"><sup>1</sup></a> This study used a 17-year dataset on wing
lengths of two butterfly species in Greenland to show that both species
follow the “temperature-size” rule, which posits that higher
temperatures generally select for smaller adult body size.</p>
<div class="figure">
<img src="images/butterflies.png" alt="" />
<p class="caption"><em>Boloria chariclea</em> and <em>Colias
hecla</em></p>
</div>
<p>Aside from it being an interesting story, I chose this paper as an
example for several reasons. First, the data are pretty
straightforward–wing lengths of individuals, sex of individuals, and a
few climatic data such as snowmelt day, average spring temperature and
average spring/summer temperature of the previous year. More
importantly, the authors made the raw data publicly available through
the Dryad data repoistory (<a href="datadryad.org">datadryad.org</a>).
Here is the link to the raw data for this particular study: <a
href="http://dx.doi.org/10.5061/dryad.43gt3">http://dx.doi.org/10.5061/dryad.43gt3</a>
(you can find this information under “Data accessibility”, right before
References).</p>
<p>You can see that there is a link to an excel file (in .xlsx format)
that contains the wing length data. In this case, there is no associated
readme file (though it is encouraged by Dryad to include one), but the
data are self-explanatory enough. <strong>Go ahead and download the data
file and open it in Microsoft Excel.</strong></p>
<p>What you will see is a single worksheet with both species data. For
each species, there are 9 columns: year, site, sex, WL (wing length),
DOY (day of year of capture), snow (day of snowmelt), snow.1 (day of
snowmelt in the previous year), mayjun (average May-June temperature),
mayaug.1 (Average May-Aug temperature of previous year).</p>
<p>Now, since R will have a hard time reading this data, let’s manually
create two separate data files and save them as .csv files.
<strong>Follow these directions:</strong></p>
<ol style="list-style-type: decimal">
<li>Select and copy the 9 columns of data for <em>Boloria
chariclea</em></li>
<li>Open a New Workbook (command-N) and paste the data</li>
<li>Save the file as “boloria.csv” in your folder for this week.</li>
<li>Do the same for Colias hecla, and save that file as
“colias.csv”</li>
</ol>
<p>Now, let’s import these data to R:</p>
<pre class="r"><code>#import the data
boloria=read.csv(&quot;data/boloria.csv&quot;)
colias=read.csv(&quot;data/colias.csv&quot;)
head(boloria) #look at one of the dataframes</code></pre>
<pre><code>##   year site sex    WL DOY  snow snow.1  mayjun mayaug.1
## 1 1996    2   m 17.56 189 158.8     NA -1.7558       NA
## 2 1996    2   m 17.91 189 158.8     NA -1.7558       NA
## 3 1996    2   m 17.29 189 158.8     NA -1.7558       NA
## 4 1996    2   f 19.26 196 158.8     NA -1.7558       NA
## 5 1996    2   m 18.82 196 158.8     NA -1.7558       NA
## 6 1996    2   m 17.83 196 158.8     NA -1.7558       NA</code></pre>
<p>Let’s also load the R packages we will use:</p>
<pre class="r"><code>library(tidyverse)
library(cowplot)</code></pre>
<p>Now, we can proceed with our exercise.</p>
</div>
<div id="recreating-figure-1-scatterplot-with-fit-line"
class="section level2">
<h2>5.2 Recreating Figure 1: Scatterplot with fit line</h2>
<p>The first thing we will try is to re-create Figure 1, which has three
panels and shows how the snowmelt dat, average May-June temperature, and
average May-August temperature (of the previous year) has changed across
the study period. They present this as a scatterplot and a simple linear
regression fit line.</p>
<div class="figure">
<img src="images/Ex1_Fig1.png" alt="" />
<p class="caption">Figure 1 from Bowden et al. (2015): (a) Timing of
snowmelt (<span class="math inline">\(F_{1,16}\)</span> = 8.92, estimate
= -1.05, <span class="math inline">\(R^2_{Adj}\)</span> = 0.32, <span
class="math inline">\(p\)</span> &lt; 0.008), (b) <span
class="math inline">\(May-June_t\)</span> temperature (<span
class="math inline">\(F_{1,16}\)</span> = 10.87, estimate = 0.11, <span
class="math inline">\(R^2_{Adj}\)</span> = 0.37, <span
class="math inline">\(p\)</span> &lt; 0.005) and (c) <span
class="math inline">\(May-June_{t-1}\)</span> temperature (<span
class="math inline">\(F_{1,16}\)</span> = 22.52, estimate = 0.11, <span
class="math inline">\(R^2_{Adj}\)</span> = 0.56, <span
class="math inline">\(p\)</span> &lt; 0.001) from 1996-2013 at
Zackenberg, Greenland</p>
</div>
<p><strong>Alright, let’s try to re-create this!</strong></p>
<div id="multi-panel-scatterplot-using-ggplot-and-cowplot"
class="section level3">
<h3>5.2.1 Multi-panel scatterplot using ggplot and cowplot</h3>
<p>First thing we’ll do is re-create the scatterplot of Figure 1a: The
date of snowmelt by year. Close reading of the supplemental methods
section tells us that this is the first day of the year that less than
50% of the site was covered in snow.</p>
<p>The dataset we have downloaded is organized by individual butterflies
that were caught during the study. However, the snowmelt and temperature
information are the same for all rows for a given year (and this info is
the same for both species of butterfly).</p>
<p>So we can actually extract all of the information we need for this
figure from this data. All we need to do is to <strong>group the data by
year</strong> and <strong>summarize</strong> the snowmelt and
temperature data for each year by taking the mean. To do this, we will
can use the <code>group_by()</code> and <code>summarize()</code>
functions in the <em>dplyr</em> package (included in the
<em>tidyverse</em> package we loaded).</p>
<p>Let’s use this to create a dataframe that has all of the information
we need: year, average snowmelt day, average May-June temperature of
that year, and average May-August temperature of the previous year:</p>
<pre class="r"><code>year.dat=boloria %&gt;% group_by(year) %&gt;% summarise(mean.snow=mean(snow), mean.mayjun=mean(mayjun), mean.mayaug=mean(mayaug.1))
year.dat</code></pre>
<pre><code>## # A tibble: 17 × 4
##     year mean.snow mean.mayjun mean.mayaug
##    &lt;int&gt;     &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
##  1  1996      159.     -1.76        NA    
##  2  1997      159      -2.22         1.63 
##  3  1998      161      -2.87         1.13 
##  4  1999      167.     -1.32         0.894
##  5  2000      155.     -1.82         1.64 
##  6  2001      158.     -2.22         1.45 
##  7  2002      156.     -0.815        1.61 
##  8  2003      160.     -1.79         2.27 
##  9  2004      152.     -1.08         2.69 
## 10  2005      143.      0.0715       2.62 
## 11  2006      159.     -0.790        2.93 
## 12  2007      160.     -1.04         2.66 
## 13  2008      157.      0.178        2.63 
## 14  2009      139.      0.355        4.02 
## 15  2011      142.     -0.870        2.41 
## 16  2012      162.     -1.71         2.44 
## 17  2013      131      -0.509        2.80</code></pre>
<p>Let’s try plotting on of the panels of Figure 1 here using this data.
Here is the plot for average snowmelt date across years.</p>
<pre class="r"><code>p1=ggplot(year.dat, aes(x=year, y=mean.snow)) +
  geom_point()
p1</code></pre>
<p><img src="Ex1.Plot_Bowden_2022_files/figure-html/unnamed-chunk-4-1.png" width="384" /></p>
<p>In ggplot, it’s also easy to add the simple linear regression line on
this plot by using <code>stat_smooth(method="lm")</code>:</p>
<pre class="r"><code>p1=ggplot(year.dat, aes(x=year, y=mean.snow)) +
  geom_point() +
  stat_smooth(method=&quot;lm&quot;)
p1</code></pre>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="Ex1.Plot_Bowden_2022_files/figure-html/unnamed-chunk-5-1.png" width="384" /></p>
<p>Let’s get rid of the confidence interval and make the line black.</p>
<pre class="r"><code>p1=ggplot(year.dat, aes(x=year, y=mean.snow)) +
  geom_point() +
  stat_smooth(method=&quot;lm&quot;, se=FALSE, color=&quot;black&quot;)
p1</code></pre>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="Ex1.Plot_Bowden_2022_files/figure-html/unnamed-chunk-6-1.png" width="384" /></p>
<p>We can plot the other two panels in the same way:</p>
<pre class="r"><code>p2=ggplot(year.dat, aes(x=year, y=mean.mayjun)) +
  geom_point() +
  stat_smooth(method=&quot;lm&quot;, se=FALSE, color=&quot;black&quot;)
p2</code></pre>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="Ex1.Plot_Bowden_2022_files/figure-html/unnamed-chunk-7-1.png" width="384" /></p>
<pre class="r"><code>p3=ggplot(year.dat, aes(x=year, y=mean.mayaug)) +
  geom_point() +
  stat_smooth(method=&quot;lm&quot;, se=FALSE, color=&quot;black&quot;)
p3</code></pre>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<pre><code>## Warning: Removed 1 rows containing non-finite values (stat_smooth).</code></pre>
<pre><code>## Warning: Removed 1 rows containing missing values (geom_point).</code></pre>
<p><img src="Ex1.Plot_Bowden_2022_files/figure-html/unnamed-chunk-8-1.png" width="384" /></p>
<p>Now, we’ve created 3 different scatterplots. But what we want is to
make one figure with 3 panels arranged vertically. How do we do
that?</p>
<p>The R package called <strong>cowplot</strong> makes the task of
making multi-panel plots very easy (The “cow” in “cowplot” stands for
Claus O. Wilkes, who wrote the package).</p>
<pre class="r"><code>plot_grid(p1, p2, p3, align=&quot;v&quot;, nrow=3) </code></pre>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;
## `geom_smooth()` using formula &#39;y ~ x&#39;
## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<pre><code>## Warning: Removed 1 rows containing non-finite values (stat_smooth).</code></pre>
<pre><code>## Warning: Removed 1 rows containing missing values (geom_point).</code></pre>
<p><img src="Ex1.Plot_Bowden_2022_files/figure-html/unnamed-chunk-9-1.png" width="288" /></p>
<pre class="r"><code>p1=ggplot(year.dat, aes(x=year, y=mean.snow)) +
  geom_point() +
  stat_smooth(method=&quot;lm&quot;, se=FALSE, color=&quot;black&quot;) +
  theme_cowplot() +
  labs(y=&quot;Snowmelt (DOY)&quot;, x=&quot;Year&quot;) +
  theme(axis.title.y = element_text(size=12))

p2=ggplot(year.dat, aes(x=year, y=mean.mayjun)) +
  geom_point() +
  stat_smooth(method=&quot;lm&quot;, se=FALSE, color=&quot;black&quot;) +
  theme_cowplot() +
  labs(expression(paste(&quot;Average Temperature&quot;[&quot;t&quot;], 
    &quot; &quot;, (~degree * C))), x=&quot;Year&quot;) +
  theme(axis.title.y = element_text(size=12))

p3=ggplot(year.dat, aes(x=year, y=mean.mayaug)) +
  geom_point() +
  stat_smooth(method=&quot;lm&quot;, se=FALSE, color=&quot;black&quot;) +
  theme_cowplot() +
  labs(expression(paste(&quot;Average Temperature&quot;[&quot;t-1&quot;], &quot; &quot;, 
        (~degree * C))), x=&quot;Year&quot;) + 
  theme(axis.title.y = element_text(size=12))

plot_grid(p1, p2, p3, nrow=3)</code></pre>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;
## `geom_smooth()` using formula &#39;y ~ x&#39;
## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<pre><code>## Warning: Removed 1 rows containing non-finite values (stat_smooth).</code></pre>
<pre><code>## Warning: Removed 1 rows containing missing values (geom_point).</code></pre>
<p><img src="Ex1.Plot_Bowden_2022_files/figure-html/unnamed-chunk-10-1.png" width="288" /></p>
<p>We won’t worry about the minutiae of the axis labels.</p>
<hr />
</div>
<div id="getting-model-results-for-linear-regression-using-lm"
class="section level3">
<h3>5.2.2 Getting model results for linear regression using
<code>lm()</code></h3>
<p>ggplot has allowed us to put a linear regression fit line on our
plots very easily, but we also want to get the statistical results to
report in the main text. So let’s do this.</p>
<p>Let’s start from the beginning: what is a linear regression? A lot of
people think that linear regression is a form of a <em>linear
model</em>. A linear model is a class of statistic models in which the
value of interest is described by a linear combination of a series of
parameters (regression slopes and intercept). This can actually include
curvilinear relationships between the dependent and independent
variables.</p>
<p>My aim here is not to provide a thorough lesson on statistics. For
that, I suggest you take a proper statistics class or consult a
statistics textbook.</p>
<p>Here, we will just tackle the problem of fitting a <strong><em>simple
linear regression</em></strong> with one continuous dependent variable
(<span class="math inline">\(y\)</span>) and one continuous independent
variable (<span class="math inline">\(x\)</span>). Thus, we want to fit
the linear function <span class="math display">\[y=a+bx\]</span> where
<span class="math inline">\(a\)</span> is the intercept and <span
class="math inline">\(b\)</span> is the slope of the line.</p>
<p>To fit this model, we use a model formula syntax inside the
appropriate statistical function. In this case, the appropriate formula
is<br />
<code>y~x</code></p>
<p>Notice that we replace the equal sign (=) with a tilde (~) and remove
the paramters (<span class="math inline">\(a\)</span> and <span
class="math inline">\(b\)</span>). All R needs to understand our
statistical model is the dependent variable(s) (<span
class="math inline">\(y\)</span> in this case) and the independent
variable(s) (<span class="math inline">\(x\)</span> in this case). We
will address the formula syntax for more complex statistical models
later.</p>
<p>Now, let’s use the simple linear regression to ask the question: what
is the relationship between snowmelt date (dependent variable) and year
(independent variable).<a href="#fn2" class="footnote-ref"
id="fnref2"><sup>2</sup></a> To do this, we will create an object using
the <code>lm()</code> function and then see what the resulting object
looks like:</p>
<pre class="r"><code>fit.snow=lm(mean.snow~year, data=year.dat)
class(fit.snow)</code></pre>
<pre><code>## [1] &quot;lm&quot;</code></pre>
<p>So, you can see that the <code>lm()</code> function creates an ‘lm
object’. The <code>fit.snow</code> object actually contains much more
information. To see all of the components of this model object, see:</p>
<pre class="r"><code>str(fit.snow) #output not shown</code></pre>
<p>This will yield a very long output that details all of the components
of the model fitting results that we might want. Ok, so how do we
extract the information we want from this statistical analysis? One
convenient function is the <code>summary()</code> function:</p>
<pre class="r"><code>summary(fit.snow)</code></pre>
<pre><code>## 
## Call:
## lm(formula = mean.snow ~ year, data = year.dat)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -13.6018  -3.9781  -0.0329   6.7438  16.1590 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)   
## (Intercept) 2296.8841   748.8165   3.067  0.00782 **
## year          -1.0692     0.3736  -2.862  0.01188 * 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 7.948 on 15 degrees of freedom
## Multiple R-squared:  0.3531, Adjusted R-squared:   0.31 
## F-statistic: 8.189 on 1 and 15 DF,  p-value: 0.01188</code></pre>
<p>So this gives us a good overview of the statistical outpu, but it
gives us a lot of information, and you have to know what to look for.
Let’s look at these values closely:</p>
<p><img src="images/Ex1_summary_fit.snow.png" width="50%" style="display: block; margin: auto auto auto 0;" /></p>
<p>The values reported in the caption of Figure 1 of the paper are in
the rectangles:</p>
<ul>
<li>“Estimate” for the independent variable (year) is the <strong>slope
parameter <span class="math inline">\(b\)</span></strong> (red
rectangle). The intercept parameter <span
class="math inline">\(a\)</span> is above that.</li>
<li><strong>F-statistic</strong> (green rectangle): Ratio of Mean of
squares. Compares the amount of variation explained by the regression
model and the “left-over variation” (residual sum of squares). The
associated <strong>degrees of freedom (DF)</strong>–i.e., how many
independent observations we have of a given variable that can be used to
estimate a statistical parameter–are the “regression degrees of
freedom”” (# parameters -1) and the “residual degrees of freedom”
(sample size - # of parmeters - 1)</li>
<li><strong>P-value</strong>: Calculated by comparing the F-ratio with
expected distribution of this value.</li>
</ul>
<p><strong><em>NOTE:</em></strong> There are also t-statistics and
P-values associated with each parameter (in purple circle). These are
P-values associated with the null hypotheses that the intercept and
slope are equal to 0. This is different than the P-value for the test
for the fit of the linear regression model to the data. Thus, those
circled values are NOT relevant for us right now.</p>
<p><strong>Now compare these values in the rectangles to the values
presented in the figure captions to Figure 1 in the paper. Do you notice
that they are slightly different? Can you figure out why they are
slightly different?<a href="#fn3" class="footnote-ref"
id="fnref3"><sup>3</sup></a></strong></p>
<hr />
<blockquote>
<p><span style="color:purple"><strong><em>Extra Exercise:
</em></strong></span> Conduct linear regression analyses for the
following relationships:</p>
<ul>
<li>May-June temperature across years</li>
<li>May-August temperature from the previous year, across years.</li>
</ul>
</blockquote>
<hr />
</div>
</div>
<div id="recreating-figure-2" class="section level2">
<h2>5.3 Recreating Figure 2</h2>
<p>Now, we will work on re-creating Figure 2, which is a 4-panel figure
with the average wing length of males and females (and error bars) for
each species (panels <em>a</em> and <em>b</em>), and the relationship
between average wing length and the average May-August temperature of
the previous year (panels <em>c</em> and <em>d</em>).</p>
<div class="figure">
<img src="images/Ex1_Fig2.png" alt="" />
<p class="caption">Figure 2 from Bowden et al. (2015): <em>Inter-annual
variation in average male (open circles) and female (filled circles)
wing length over the sampling period for (a) Colias hecla and (b)
Boloria chariclea and their responses (c,d, respectively) to average
May–Augustt21 temperature. Error bars represent s.e. Data for 2010 are
not available.</em></p>
</div>
<hr />
<div
id="panels-a-and-b-plotting-the-mean-wing-lengths-by-year-species-and-sex"
class="section level3">
<h3>5.3.1 Panels (a) and (b): Plotting the mean wing lengths by year,
species and sex</h3>
<p>First thing we need to do to construct this figure is to calculate
the mean wing lengths for each year for each species and sex. We can do
this with the <code>aggregate()</code> function that we used in a
previous module:</p>
<p>Let’s start with <em>Colias hecla</em> since that is the first
panel.</p>
<pre class="r"><code>wl.colias=colias %&gt;% group_by(year, sex) %&gt;% summarise(mean.WL=mean(WL)) #calculate the mean of WL by year and sex for the colias dataset.</code></pre>
<pre><code>## `summarise()` has grouped output by &#39;year&#39;. You can override using the
## `.groups` argument.</code></pre>
<pre class="r"><code>head(wl.colias)</code></pre>
<pre><code>## # A tibble: 6 × 3
## # Groups:   year [3]
##    year sex   mean.WL
##   &lt;int&gt; &lt;chr&gt;   &lt;dbl&gt;
## 1  1996 f        23.5
## 2  1996 m        22.9
## 3  1997 f        23.0
## 4  1997 m        21.9
## 5  1998 f        23.1
## 6  1998 m        22.6</code></pre>
<p>Ok, so now we have the data that we need to plot the means for each
year.</p>
<p>Let’s start building panel <em>a</em>. What we want to do is plot the
data for one sex (say female), and then add the points for the second
sex (male) on that same plot. To do this, a useful function is
<code>subset()</code>, which allows us to easily specify a subset of
data. Try this to plot the data for just the females:</p>
<pre class="r"><code>ggplot(wl.colias, aes(x=year, y=mean.WL, group=sex)) +
  geom_point(aes(fill=sex), pch=21, size=2) +
  scale_fill_manual(values=c(&quot;black&quot;, &quot;white&quot;)) +
  geom_path()</code></pre>
<p><img src="Ex1.Plot_Bowden_2022_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<pre class="r"><code>ggplot(wl.colias, aes(x=year, y=mean.WL, group=sex)) +
  geom_path() +
  geom_point(aes(fill=sex), pch=21, size=2) +
  scale_fill_manual(values=c(&quot;black&quot;, &quot;white&quot;))</code></pre>
<p><img src="Ex1.Plot_Bowden_2022_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<p>Notice that there is one problem here, which is that the plot
connects the dots between the years 2009 and 2011, even though the data
for 2010 is missing. The figure in the publication correctly omits this
line. We will address this later.</p>
<hr />
</div>
<div
id="creating-a-custom-function-to-calculate-standard-error-of-the-mean"
class="section level3">
<h3>5.3.2 Creating a custom function to calculate standard error of the
mean</h3>
<p>Figure 2(a) and 2(b) have standard error bars associated with each
mean value. Let’s work on adding those. The base package in R famously
does not have a built-in function for calculating standard error of the
mean, but it is very easy to calculate it.</p>
<p>So, what is standard error? Simply, it is the standard deviation
<span class="math inline">\(\sigma\)</span> divided by the square-root
of the sample size <span class="math inline">\(n\)</span>: <span
class="math display">\[SE = \frac{\sigma}{\sqrt n}\]</span> In turn,
standard deviation <span class="math inline">\(\sigma\)</span> is simply
the square-root of the variance <span
class="math inline">\(\sigma^2\)</span>. Thus, <span
class="math display">\[SE = \sqrt{\frac{\sigma^2}{n}}\]</span> So, to
calculate the standard error of the mean of a vector, say WL, we simply
need to do:</p>
<pre class="r"><code>sqrt(var(colias$WL)/length(colias$WL)) #the standard error of the mean of WL for the entire sample of Colias butterflies. </code></pre>
<pre><code>## [1] 0.0366356</code></pre>
<p>So, what we need to do is figure out an easy way to do this
calculation for each year-species-sex. The best way to do this is to
<strong><em>build a custom function</em></strong> to calculate the
standard error, and then use this function within the
<code>aggregate()</code> function (like we did to calculate the
means)!</p>
<p>To create a custom function, we need to use <code>function()</code>.
Inside the parentheses, we designate some variable(s). Here, we will
call this variable <code>x</code>. Then, we use curly brackets
<code>{}</code> to tell R what this function will do. Here is how to
build a custom function called <code>se()</code> that will calculate the
standard error of the mean:</p>
<pre class="r"><code>se=function(x) {sqrt(var(x, na.rm=T)/length(which(is.na(x)==F)))} #create a new function called se() that will take a vector, x, and divide the variance of the vector by its length, then take its square-root.</code></pre>
<p>Now, let’s implement this function to the global sample of wing
lengths in <em>Colias</em>:</p>
<pre class="r"><code>se(colias$WL)</code></pre>
<pre><code>## [1] 0.0366356</code></pre>
<p>This should give us the same value as our manual calculation
above.</p>
<p>Now, we can calculate the standard error for each year, species and
sex:</p>
<pre class="r"><code>wl.colias=colias %&gt;% group_by(year, sex) %&gt;% summarise(mean.WL=mean(WL), se.WL=se(WL)) #calculate the mean of WL by year and sex for the colias dataset.</code></pre>
<pre><code>## `summarise()` has grouped output by &#39;year&#39;. You can override using the
## `.groups` argument.</code></pre>
<pre class="r"><code>wl.colias</code></pre>
<pre><code>## # A tibble: 34 × 4
## # Groups:   year [17]
##     year sex   mean.WL se.WL
##    &lt;int&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;
##  1  1996 f        23.5 0.188
##  2  1996 m        22.9 0.150
##  3  1997 f        23.0 0.329
##  4  1997 m        21.9 0.281
##  5  1998 f        23.1 0.794
##  6  1998 m        22.6 0.205
##  7  1999 f        23.7 0.208
##  8  1999 m        22.4 0.191
##  9  2000 f        22.9 0.258
## 10  2000 m        22.5 0.150
## # … with 24 more rows</code></pre>
<p>Now we have the standard error values that correspond with each of
the dots on the plot in our dataframe!</p>
<hr />
</div>
<div id="plotting-the-standard-error-bars-on-the-line-plots"
class="section level3">
<h3>5.3.3 Plotting the standard error bars on the line plots</h3>
<pre class="r"><code>ggplot(wl.colias, aes(x=year, y=mean.WL, group=sex)) +
  geom_path() +
  geom_point(aes(fill=sex), pch=21, size=2) +
  scale_fill_manual(values=c(&quot;black&quot;, &quot;white&quot;)) +
  geom_errorbar(aes(ymin=mean.WL-se.WL, ymax=mean.WL+se.WL))</code></pre>
<p><img src="Ex1.Plot_Bowden_2022_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<pre class="r"><code>p.2a=ggplot(wl.colias, aes(x=year, y=mean.WL, group=sex)) +
  geom_path() +
  geom_errorbar(aes(ymin=mean.WL-se.WL, ymax=mean.WL+se.WL), width=0.5) +
  geom_point(aes(fill=sex), pch=21, size=2) +
  scale_fill_manual(values=c(&quot;black&quot;, &quot;white&quot;)) +
  theme_cowplot() +
  labs(y=&quot;Average Wing Length (mm)&quot;)
p.2a</code></pre>
<p><img src="Ex1.Plot_Bowden_2022_files/figure-html/unnamed-chunk-23-1.png" width="672" />
Now, let’s do the same with Boloria (Figure 2b):</p>
<pre class="r"><code>wl.boloria=boloria %&gt;% group_by(year, sex) %&gt;% summarise(mean.WL=mean(WL), se.WL=se(WL)) #calculate the mean of WL by year and sex for the colias dataset.</code></pre>
<pre><code>## `summarise()` has grouped output by &#39;year&#39;. You can override using the
## `.groups` argument.</code></pre>
<pre class="r"><code>wl.boloria</code></pre>
<pre><code>## # A tibble: 34 × 4
## # Groups:   year [17]
##     year sex   mean.WL  se.WL
##    &lt;int&gt; &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;
##  1  1996 f        19.2 0.0424
##  2  1996 m        18.2 0.0376
##  3  1997 f        18.6 0.0740
##  4  1997 m        17.9 0.0555
##  5  1998 f        18.8 0.147 
##  6  1998 m        18.2 0.122 
##  7  1999 f        19.1 0.151 
##  8  1999 m        18.1 0.108 
##  9  2000 f        19.0 0.0539
## 10  2000 m        18.1 0.0601
## # … with 24 more rows</code></pre>
<pre class="r"><code>p.2b=ggplot(wl.boloria, aes(x=year, y=mean.WL, group=sex)) +
  geom_path() +
  geom_errorbar(aes(ymin=mean.WL-se.WL, ymax=mean.WL+se.WL), width=0.5) +
  geom_point(aes(fill=sex), pch=21, size=2) +
  scale_fill_manual(values=c(&quot;black&quot;, &quot;white&quot;)) +
  theme_cowplot() +
  labs(y=&quot;Average Wing Length (mm)&quot;)
p.2b</code></pre>
<pre><code>## Warning: Removed 1 rows containing missing values (geom_point).</code></pre>
<p><img src="Ex1.Plot_Bowden_2022_files/figure-html/unnamed-chunk-25-1.png" width="672" />
You’ll notice that there is the data for 2003 is missing for females.
This is because there is a missing data point, and therefore the
<code>mean()</code> function is returning NA. We can get around this by
telling the <code>mean()</code> function to skip the NA using the
argument <code>na.rm=T</code>.</p>
<pre class="r"><code>wl.boloria=boloria %&gt;% group_by(year, sex) %&gt;% summarise(mean.WL=mean(WL, na.rm=T), se.WL=se(WL)) #calculate the mean of WL by year and sex for the colias dataset.</code></pre>
<pre><code>## `summarise()` has grouped output by &#39;year&#39;. You can override using the
## `.groups` argument.</code></pre>
<pre class="r"><code>p.2b=ggplot(wl.boloria, aes(x=year, y=mean.WL, group=sex)) +
  geom_path() +
  geom_errorbar(aes(ymin=mean.WL-se.WL, ymax=mean.WL+se.WL), width=0.5) +
  geom_point(aes(fill=sex), pch=21, size=2) +
  scale_fill_manual(values=c(&quot;black&quot;, &quot;white&quot;)) +
  theme_cowplot() +
  labs(y=&quot;Average Wing Length (mm)&quot;)
p.2b</code></pre>
<p><img src="Ex1.Plot_Bowden_2022_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<p>To go further, we can fix the details like skipping the year 2010 by
plotting the points for years &lt;2010 and years &gt;2010 separately for
each sex and each species, all in two vertical panels. I’ll also adjust
the tick marks a bit:</p>
<pre class="r"><code>p.2a=ggplot(wl.colias, aes(x=year, y=mean.WL, group=sex)) +
  geom_path(data=wl.colias %&gt;% filter(year&lt;2010)) +
  geom_path(data=wl.colias %&gt;% filter(year&gt;2010)) +
  geom_errorbar(aes(ymin=mean.WL-se.WL, ymax=mean.WL+se.WL), width=0.5) +
  geom_point(aes(fill=sex), pch=21, size=2) +
  scale_fill_manual(values=c(&quot;black&quot;, &quot;white&quot;)) +
  theme_cowplot() +
  labs(y=&quot;Average Wing Length (mm)&quot;)
p.2a</code></pre>
<p><img src="Ex1.Plot_Bowden_2022_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<pre class="r"><code>p.2b=ggplot(wl.boloria, aes(x=year, y=mean.WL, group=sex)) +
  geom_path(data=wl.boloria %&gt;% filter(year&lt;2010)) +
  geom_path(data=wl.boloria %&gt;% filter(year&gt;2010)) +
  geom_errorbar(aes(ymin=mean.WL-se.WL, ymax=mean.WL+se.WL), width=0.5) +
  geom_point(aes(fill=sex), pch=21, size=2) +
  scale_fill_manual(values=c(&quot;black&quot;, &quot;white&quot;)) +
  theme_cowplot() +
  labs(y=&quot;Average Wing Length (mm)&quot;)
p.2b</code></pre>
<p><img src="Ex1.Plot_Bowden_2022_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<p>We’ve pretty much re-created Figure 2(a,b)!</p>
<p>Some things that are worth thinking about here are:</p>
<ul>
<li>When should I make a routine into a function?</li>
<li>What should be the parameters that my function can take?</li>
<li>Should I make the whole routine into a single function, or should I
break the routine into multiple components?</li>
</ul>
<p>There is no single good answer to these questions. I have heard
people say that you should convert a routine into a function if you are
going to run a routine more than 3 times. Another rule of thumb is that
if I am going to apply a complex routine to multiple datasets, it might
be a good idea to make a function. If I just replicate a routine and
just change the dataframe name, that means that any tweaks I make to the
code will have to be tweaked in multiple places. If I just make a
function, then I can tweak it just once and then re-run the function on
multiple datasets.</p>
<hr />
</div>
</div>
<div id="figure-2cd" class="section level2">
<h2>5.4 Figure 2(c,d)</h2>
<p>Ok, the final plots to make are the Figures 2(c,d), which are plots
of the relationships between average wing length of a
population/year/sex and the May-August temperature of the previous
year.<br />
The good news is that <strong>we have covered everything you need to
know to make these figures!</strong> Think about it for a minute and see
if you can visualize the steps you need to complete to get this data</p>
<hr />
<p>Ok, let’s start. To begin, let’s add another column to the
“wl.colias” dataframe that is the temperature of the previosu year. To
do this, we will use a <code>match()</code> function that is useful as a
“lookup” function to merge two datasets together.</p>
<pre class="r"><code>wl.colias %&gt;% left_join(., year.dat)</code></pre>
<pre><code>## Joining, by = &quot;year&quot;</code></pre>
<pre><code>## # A tibble: 34 × 7
## # Groups:   year [17]
##     year sex   mean.WL se.WL mean.snow mean.mayjun mean.mayaug
##    &lt;int&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
##  1  1996 f        23.5 0.188      159.       -1.76      NA    
##  2  1996 m        22.9 0.150      159.       -1.76      NA    
##  3  1997 f        23.0 0.329      159        -2.22       1.63 
##  4  1997 m        21.9 0.281      159        -2.22       1.63 
##  5  1998 f        23.1 0.794      161        -2.87       1.13 
##  6  1998 m        22.6 0.205      161        -2.87       1.13 
##  7  1999 f        23.7 0.208      167.       -1.32       0.894
##  8  1999 m        22.4 0.191      167.       -1.32       0.894
##  9  2000 f        22.9 0.258      155.       -1.82       1.64 
## 10  2000 m        22.5 0.150      155.       -1.82       1.64 
## # … with 24 more rows</code></pre>
<pre class="r"><code>wl.colias=wl.colias %&gt;% left_join(., year.dat)</code></pre>
<pre><code>## Joining, by = &quot;year&quot;</code></pre>
<pre class="r"><code>wl.boloria=wl.boloria %&gt;% left_join(., year.dat)</code></pre>
<pre><code>## Joining, by = &quot;year&quot;</code></pre>
<p>Now, we can make a scatterplot for each species where the average
female wing lengths are filled black and males are filled white</p>
<pre class="r"><code>ggplot(wl.colias, aes(x=mean.mayaug, y=mean.WL, fill=sex)) +
  geom_point(pch=21, size=2) +
  scale_fill_manual(values=c(&quot;black&quot;, &quot;white&quot;)) +
  stat_smooth(method=&quot;lm&quot;, se=F, color=&quot;black&quot;) </code></pre>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<pre><code>## Warning: Removed 2 rows containing non-finite values (stat_smooth).</code></pre>
<pre><code>## Warning: Removed 2 rows containing missing values (geom_point).</code></pre>
<p><img src="Ex1.Plot_Bowden_2022_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
<pre class="r"><code>p.2c=ggplot(wl.colias, aes(x=mean.mayaug, y=mean.WL, fill=sex)) +
  geom_point(pch=21, size=2) +
  scale_fill_manual(values=c(&quot;black&quot;, &quot;white&quot;)) +
  stat_smooth(method=&quot;lm&quot;, se=F, color=&quot;black&quot;) +
  theme_cowplot() +
  labs(x = &quot;May-Aug temp (t-1)&quot;, y = &quot;average wing length (mm)&quot;)
p.2c</code></pre>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<pre><code>## Warning: Removed 2 rows containing non-finite values (stat_smooth).</code></pre>
<pre><code>## Warning: Removed 2 rows containing missing values (geom_point).</code></pre>
<p><img src="Ex1.Plot_Bowden_2022_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p>
<p>We can do the same thing with <em>Boloria</em>:</p>
<pre class="r"><code>p.2d=ggplot(wl.boloria, aes(x=mean.mayaug, y=mean.WL, fill=sex)) +
  geom_point(pch=21, size=2) +
  scale_fill_manual(values=c(&quot;black&quot;, &quot;white&quot;)) +
  stat_smooth(method=&quot;lm&quot;, se=F, color=&quot;black&quot;) +
  theme_cowplot() +
  labs(x = &quot;May-Aug temp (t-1)&quot;, y = &quot;average wing length (mm)&quot;)
p.2d</code></pre>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<pre><code>## Warning: Removed 2 rows containing non-finite values (stat_smooth).</code></pre>
<pre><code>## Warning: Removed 2 rows containing missing values (geom_point).</code></pre>
<p><img src="Ex1.Plot_Bowden_2022_files/figure-html/unnamed-chunk-33-1.png" width="672" />
Now organize these into a multi-panel plot!</p>
<pre class="r"><code>plot_grid(p.2a, p.2c, p.2b, p.2d, nrow=2)</code></pre>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<pre><code>## Warning: Removed 2 rows containing non-finite values (stat_smooth).</code></pre>
<pre><code>## Warning: Removed 2 rows containing missing values (geom_point).</code></pre>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<pre><code>## Warning: Removed 2 rows containing non-finite values (stat_smooth).
## Removed 2 rows containing missing values (geom_point).</code></pre>
<p><img src="Ex1.Plot_Bowden_2022_files/figure-html/unnamed-chunk-34-1.png" width="672" /></p>
<hr />
<p>Ok, I hope you feel like you learned some things by going through
this exercise!</p>
</div>
<div class="footnotes footnotes-end-of-document">
<hr />
<ol>
<li id="fn1"><p>Bowden, JJ, Eskildsen, A., et al. (2016) High-Arctic
butterflies become smaller with rising temperatures. <em>Biology
Letters</em> 11: 20150574.<a href="#fnref1"
class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Here, notice that technically speaking, “year” is not a
continuous variable… one might conceivably argue that there are more
appropriate statistical approach to analyzing this type of time-series
data.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>The discrepancy between the values that come out of our
analysis and what is reported in the publication arises because the
supplementary data is actually missing one data point for the climate
variables that is included in the final publication (year 2010). This
seems to be due to the fact that butterflies were not measured in 2010,
and so that year does not appear in the supplemental data. However, the
climate data for that year is available, so it is included in the
analysis presented in Figure 1.<a href="#fnref3"
class="footnote-back">↩︎</a></p></li>
</ol>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
