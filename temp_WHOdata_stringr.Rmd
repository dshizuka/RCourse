---
title: "Parsing data from text: Example with WHO data"
author: "Dai Shizuka"
date: "updated `r format(Sys.time(), '%m/%d/%y')` "
output: 
  html_document:
    toc: true
    toc_depth: 4
    toc_float: true
---

## Data coded into text

There are many cases with large datasets where important data is stored in column names or file names. There are many cases in which your analysis pipeline needs to include steps to extract that data from the characters, rather than having to code it manually yourself. In other cases, you might also conduct "text mining" analyses where you look for particular words and codes inside large amounts of documents, websites, etc. This is made possible in R with functions geared towards character splitting or pattern matching. 

Here, I will demonstrate some cases in which we can do this with 

```{r, message=F}
library(tidyverse)
```
## 

Get the stringr cheatsheet [here](https://raw.githubusercontent.com/rstudio/cheatsheets/main/strings.pdf)
***
```{r}
who
```
```{r}
who %>% pivot_longer(c(-country, -iso2, -iso3, -year))
```

```{r}
codes=who %>% 
  pivot_longer(c(-country, -iso2, -iso3, -year)) %>%
  pull(name)
unique(codes)
```
The help file provides the codes:

* all codes start with "new"
* the next part codes the method of diagnosis. It is either "rel", "_sn", "_sp", or "_ep"... notice that the under score ensures that they are all 3 characters long.
* next part is "_m" for male and "_f" for female. These are all 2 characters long
* final part has different number of characters: 014 = 0-14 yrs of age, 1524 = 15-24 years of age, 2534 = 25 to 34 years of age, 3544 = 35 to 44 years of age, 4554 = 45 to 54 years of age, 5564 = 55 to 64 years of age, 65 = 65 years of age or older

Get the diagnosis method
```{r}
who %>% 
  pivot_longer(c(-country, -iso2, -iso3, -year)) %>%
  mutate(method=str_sub(name, 4, 6)) 
```

Remove the underscore "_" if it is exists.
```{r}
who %>% 
  pivot_longer(c(-country, -iso2, -iso3, -year)) %>%
  mutate(method=str_sub(name, 4, 6)) %>%
  mutate(method=str_replace(method, "_", ""))
```

