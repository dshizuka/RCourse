---
title: "Mini-Module: Making Maps"
author: "Dai Shizuka"
date: "updated `r format(Sys.time(), '%m/%d/%y')` "
output: 
  html_document:
    toc: true
    toc_depth: 4
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Using sf by downloading shapefile and use it.

```{r}
library(tidyverse)
library(sf)
```


e.g., I downloaded US county data from US census bureau: https://www.census.gov/geographies/mapping-files/time-series/geo/carto-boundary-file.html

```{r}
us_shp=st_read("data/cb_2018_us_county_20m/cb_2018_us_county_20m.shp")
```

```{r}
ggplot() +
  geom_sf(data=us_shp, fill="goldenrod") +
  coord_sf(xlim=c(-180,-50)) +
  theme_bw()
```


Also downloaded county-level data. 
https://www.census.gov/data/datasets/time-series/demo/popest/2020s-counties-detail.html
"Annual County Resident Population Estimates by Age, Sex, Race, and Hispanic Origin: April 1, 2020 to July 1, 2024 (CC-EST2024-ALLDATA)"
--> select "United States"

Read the county-level data.

```{r}
co_data=read.csv("data/co-est2024-alldata.csv")
head(co_data)
```

### Mapping county data on map of Nebraska

downloaded NE counties data from https://www.nebraskamap.gov/datasets/county-boundaries-2/explore

```{r}
ne=st_read("data/NE_County_Boundaries/County_Boundaries.shp")
head(ne)
```

```{r}
ne_full2024=ne %>% mutate(CountyFIPS=as.numeric(CountyFIPS)) %>% left_join(co_data %>% filter(STNAME=="Nebraska"), by=join_by("CountyFIPS"=="COUNTY"))
```

```{r}
ggplot() +
  geom_sf(data=ne_full2024, aes(fill=POPESTIMATE2024)) +
  theme_bw()

ggplot() +
  geom_sf(data=ne_full2024, aes(fill=RBIRTH2024)) +
  theme_bw()
```
```{r}
unl=data.frame(long=693966.4754863544, lat=4521321.303476614 )

ggplot() +
  geom_sf(data=ne_full2024, aes(fill=NPOPCHG2024)) +
  annotate("point", x=unl$long, y=unl$lat) +
  theme_bw() 
```