<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Dai Shizuka" />


<title>Mini-Module: Reshaping data with pivot functions</title>

<script src="site_libs/header-attrs-2.29/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/sandstone.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Intro to R</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="syllabus.html">Syllabus</a>
</li>
<li>
  <a href="modules.html">Modules</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Mini-Module: Reshaping data with pivot
functions</h1>
<h4 class="author">Dai Shizuka</h4>
<h4 class="date">updated 11/04/25</h4>

</div>


<hr />
<p><strong><em>This module deals with “wide” versus “long” format
data.</em></strong></p>
<p>This module is my own attempt to explain the
<code>pivot_longer()</code> and <code>pivot_wider()</code> function in
the tidyr package. Here are a couple of other explainers on the same
topic:</p>
<p><a href="https://tidyr.tidyverse.org/articles/pivot.html"
class="uri">https://tidyr.tidyverse.org/articles/pivot.html</a></p>
<p><a
href="https://tavareshugo.github.io/r-intro-tidyverse-gapminder/09-reshaping/index.html"
class="uri">https://tavareshugo.github.io/r-intro-tidyverse-gapminder/09-reshaping/index.html</a></p>
<div id="explaining-wide-format-and-long-format-data."
class="section level3">
<h3>1. Explaining “wide-format” and “long-format” data.</h3>
<p><br></p>
<div id="what-are-wide-format-and-long-format-data"
class="section level4">
<h4>1.1 What are “wide-format” and “long-format” data?</h4>
<p><em>Wide-format</em> data is one in which <strong>each row is a
subject/entity that is measured repeatedly</strong>, and each
measurement appears on different columns. This may happen if you want to
take repeated measurements at one point in time (e.g., if you want to
take an average as a more reliable point measure), or if you take a
measurement of the same individual at different points in time (e.g., to
measure growth, immune response, or anything else that can change across
time).</p>
<p><em>Long-format</em> data is one in which <strong>each row is an
observation.</strong> So if a subject is measured multiple times, those
will show up as multiple rows–one for each time the subject was
measured.</p>
</div>
<div id="long-format-is-required-for-ggplot-functions"
class="section level4">
<h4>1.2 Long-format is required for ggplot() functions</h4>
<p>The ggplot() function cannot take wide-format data to plot multiple
variables!</p>
</div>
</div>
<div
id="converting-wide-format-data-to-long-format-data-with-pivot_longer"
class="section level3">
<h3>2. Converting wide-format data to long-format data with
<code>pivot_longer()</code></h3>
<p>In this module, we will be using the <code>tidyr</code> package
within the tidyverse suite of packages</p>
<pre class="r"><code>library(tidyverse)</code></pre>
<p>The <code>billboard</code> data is a prime example of wide-format
data because it lists the rankings of a song for each week in separate
columns.</p>
<pre class="r"><code>billboard</code></pre>
<pre><code>## # A tibble: 317 × 79
##    artist     track date.entered   wk1   wk2   wk3   wk4   wk5   wk6   wk7   wk8
##    &lt;chr&gt;      &lt;chr&gt; &lt;date&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 2 Pac      Baby… 2000-02-26      87    82    72    77    87    94    99    NA
##  2 2Ge+her    The … 2000-09-02      91    87    92    NA    NA    NA    NA    NA
##  3 3 Doors D… Kryp… 2000-04-08      81    70    68    67    66    57    54    53
##  4 3 Doors D… Loser 2000-10-21      76    76    72    69    67    65    55    59
##  5 504 Boyz   Wobb… 2000-04-15      57    34    25    17    17    31    36    49
##  6 98^0       Give… 2000-08-19      51    39    34    26    26    19     2     2
##  7 A*Teens    Danc… 2000-07-08      97    97    96    95   100    NA    NA    NA
##  8 Aaliyah    I Do… 2000-01-29      84    62    51    41    38    35    35    38
##  9 Aaliyah    Try … 2000-03-18      59    53    38    28    21    18    16    14
## 10 Adams, Yo… Open… 2000-08-26      76    76    74    69    68    67    61    58
## # ℹ 307 more rows
## # ℹ 68 more variables: wk9 &lt;dbl&gt;, wk10 &lt;dbl&gt;, wk11 &lt;dbl&gt;, wk12 &lt;dbl&gt;,
## #   wk13 &lt;dbl&gt;, wk14 &lt;dbl&gt;, wk15 &lt;dbl&gt;, wk16 &lt;dbl&gt;, wk17 &lt;dbl&gt;, wk18 &lt;dbl&gt;,
## #   wk19 &lt;dbl&gt;, wk20 &lt;dbl&gt;, wk21 &lt;dbl&gt;, wk22 &lt;dbl&gt;, wk23 &lt;dbl&gt;, wk24 &lt;dbl&gt;,
## #   wk25 &lt;dbl&gt;, wk26 &lt;dbl&gt;, wk27 &lt;dbl&gt;, wk28 &lt;dbl&gt;, wk29 &lt;dbl&gt;, wk30 &lt;dbl&gt;,
## #   wk31 &lt;dbl&gt;, wk32 &lt;dbl&gt;, wk33 &lt;dbl&gt;, wk34 &lt;dbl&gt;, wk35 &lt;dbl&gt;, wk36 &lt;dbl&gt;,
## #   wk37 &lt;dbl&gt;, wk38 &lt;dbl&gt;, wk39 &lt;dbl&gt;, wk40 &lt;dbl&gt;, wk41 &lt;dbl&gt;, wk42 &lt;dbl&gt;, …</code></pre>
<p>You can see that each subject (song) is measured repeatedly across
time (i.e., ranking each week).</p>
<p>Let’s now convert this into a long-format, in which we have a column
for “week” and then the rank of that song for that week in a column
called “rank”:</p>
<pre class="r"><code>billboard %&gt;% pivot_longer(cols=starts_with(&quot;wk&quot;), names_to=&quot;week&quot;, values_to=&quot;rank&quot;)</code></pre>
<pre><code>## # A tibble: 24,092 × 5
##    artist track                   date.entered week   rank
##    &lt;chr&gt;  &lt;chr&gt;                   &lt;date&gt;       &lt;chr&gt; &lt;dbl&gt;
##  1 2 Pac  Baby Don&#39;t Cry (Keep... 2000-02-26   wk1      87
##  2 2 Pac  Baby Don&#39;t Cry (Keep... 2000-02-26   wk2      82
##  3 2 Pac  Baby Don&#39;t Cry (Keep... 2000-02-26   wk3      72
##  4 2 Pac  Baby Don&#39;t Cry (Keep... 2000-02-26   wk4      77
##  5 2 Pac  Baby Don&#39;t Cry (Keep... 2000-02-26   wk5      87
##  6 2 Pac  Baby Don&#39;t Cry (Keep... 2000-02-26   wk6      94
##  7 2 Pac  Baby Don&#39;t Cry (Keep... 2000-02-26   wk7      99
##  8 2 Pac  Baby Don&#39;t Cry (Keep... 2000-02-26   wk8      NA
##  9 2 Pac  Baby Don&#39;t Cry (Keep... 2000-02-26   wk9      NA
## 10 2 Pac  Baby Don&#39;t Cry (Keep... 2000-02-26   wk10     NA
## # ℹ 24,082 more rows</code></pre>
<p>What happened here?</p>
<p>The minimal arguments that are required in here are:</p>
<ul>
<li><code>data</code>: (self explanatory)</li>
<li><code>cols</code>: The columns that we want to collapse into a
single column. Here, we want all the columns that start with “wk”, which
contain the ranking of that song in that week. tidyverse has a friendly
function called <code>starts_with()</code> that we use here. An
alternative way to do this would be to <em>exclude</em> all the other
columns, which we could do with
<code>-c(artist, track, date.entered)</code></li>
<li><code>names_to</code>: The name of a new column that will contain
names of the columns that you collapsed. Here, naming this “week” makes
sense.</li>
<li><code>values_to</code>: The name of a new column that will have the
values for each ID x names_from combination. In this case, this is
“rank”</li>
</ul>
<p><br></p>
<p>The next step would be to change the “week” column to be a number
(1,2,3,…), rather than character that says “wk1”, “wk2”, etc. We can do
this by using <code>str_replace()</code> from the stringr package. (More
on that in the <a
href="https://dshizuka.github.io/RCourse/10_text_parsing.html">text
parsing module</a>).</p>
<p>Let’s save the long-format version of the billboard data:</p>
<pre class="r"><code>bb_long=billboard %&gt;% pivot_longer(cols=starts_with(&quot;wk&quot;), names_to=&quot;week&quot;, values_to=&quot;rank&quot;)</code></pre>
<p>Then, let’s modify the “week” column by:</p>
<ul>
<li><p>removing the characters “wk” from all values using
<code>str_replace()</code></p></li>
<li><p>then telling R that the remaining character should be a number
using <code>as.numeric()</code></p></li>
</ul>
<pre class="r"><code>bb_long=bb_long %&gt;% mutate(week=as.numeric(str_replace(week, &quot;wk&quot;, &quot;&quot;)))</code></pre>
<div id="plot-the-trajectory-of-track-rank" class="section level4">
<h4>2.1 Plot the trajectory of track rank</h4>
<pre class="r"><code>ggplot(bb_long, aes(x=week, y=rank, group=track)) +
  geom_line()</code></pre>
<pre><code>## Warning: Removed 18723 rows containing missing values or values outside the scale range
## (`geom_line()`).</code></pre>
<p><img src="09.5_pivot_files/figure-html/unnamed-chunk-6-1.png" width="672" />
Since this is messy, let’s filter the data to songs that first entered
the rankings in the first 3 weeks of 2000.</p>
<pre class="r"><code>ggplot(bb_long %&gt;% filter(date.entered&gt;=ymd(&quot;2000-01-01&quot;) &amp; date.entered&lt;=ymd(&quot;2000-01-21&quot;)), aes(x=week, y=rank, color=track)) +
  geom_line()</code></pre>
<pre><code>## Warning: Removed 659 rows containing missing values or values outside the scale range
## (`geom_line()`).</code></pre>
<p><img src="09.5_pivot_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<hr />
</div>
</div>
<div
id="converting-long-format-data-to-wide-format-data-with-pivot_wider"
class="section level3">
<h3>3. Converting long-format data to wide-format data with
<code>pivot_wider()</code></h3>
<p>We can then revert back to the wide-format version this way:</p>
<pre class="r"><code>bb_long %&gt;% pivot_wider(names_from = &quot;week&quot;, values_from = &quot;rank&quot;)</code></pre>
<pre><code>## # A tibble: 317 × 79
##    artist     track date.entered   `1`   `2`   `3`   `4`   `5`   `6`   `7`   `8`
##    &lt;chr&gt;      &lt;chr&gt; &lt;date&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 2 Pac      Baby… 2000-02-26      87    82    72    77    87    94    99    NA
##  2 2Ge+her    The … 2000-09-02      91    87    92    NA    NA    NA    NA    NA
##  3 3 Doors D… Kryp… 2000-04-08      81    70    68    67    66    57    54    53
##  4 3 Doors D… Loser 2000-10-21      76    76    72    69    67    65    55    59
##  5 504 Boyz   Wobb… 2000-04-15      57    34    25    17    17    31    36    49
##  6 98^0       Give… 2000-08-19      51    39    34    26    26    19     2     2
##  7 A*Teens    Danc… 2000-07-08      97    97    96    95   100    NA    NA    NA
##  8 Aaliyah    I Do… 2000-01-29      84    62    51    41    38    35    35    38
##  9 Aaliyah    Try … 2000-03-18      59    53    38    28    21    18    16    14
## 10 Adams, Yo… Open… 2000-08-26      76    76    74    69    68    67    61    58
## # ℹ 307 more rows
## # ℹ 68 more variables: `9` &lt;dbl&gt;, `10` &lt;dbl&gt;, `11` &lt;dbl&gt;, `12` &lt;dbl&gt;,
## #   `13` &lt;dbl&gt;, `14` &lt;dbl&gt;, `15` &lt;dbl&gt;, `16` &lt;dbl&gt;, `17` &lt;dbl&gt;, `18` &lt;dbl&gt;,
## #   `19` &lt;dbl&gt;, `20` &lt;dbl&gt;, `21` &lt;dbl&gt;, `22` &lt;dbl&gt;, `23` &lt;dbl&gt;, `24` &lt;dbl&gt;,
## #   `25` &lt;dbl&gt;, `26` &lt;dbl&gt;, `27` &lt;dbl&gt;, `28` &lt;dbl&gt;, `29` &lt;dbl&gt;, `30` &lt;dbl&gt;,
## #   `31` &lt;dbl&gt;, `32` &lt;dbl&gt;, `33` &lt;dbl&gt;, `34` &lt;dbl&gt;, `35` &lt;dbl&gt;, `36` &lt;dbl&gt;,
## #   `37` &lt;dbl&gt;, `38` &lt;dbl&gt;, `39` &lt;dbl&gt;, `40` &lt;dbl&gt;, `41` &lt;dbl&gt;, `42` &lt;dbl&gt;, …</code></pre>
<p>So, what happened here? The minimal arguments that are required in
here are:</p>
<ul>
<li><code>data</code>: is <code>bb_long</code>, forwarded by the
%&gt;%</li>
<li><code>names_from</code>: The column that you want to expand into
different columns. In this case, it is “age” because you want to see the
heights of each tree at different ages as different columns.</li>
<li><code>values_from</code>: The column that will have the values for
each ID x names_from combination. In this case, this is “height”</li>
</ul>
<hr />
</div>
<div id="get-more-practice-with-worked-examples" class="section level3">
<h3>Get more practice with Worked Examples</h3>
<p>Go to the Worked Example on <a href="Ex_WorldBank.html">“Wrangling
World Bank Data”</a></p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3,h4",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
