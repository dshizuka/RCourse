<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Dai Shizuka" />


<title>Module 3: Working With Data</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/sandstone.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 61px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 66px;
  margin-top: -66px;
}

.section h2 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h3 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h4 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h5 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h6 {
  padding-top: 66px;
  margin-top: -66px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Intro to R</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="syllabus.html">Syllabus</a>
</li>
<li>
  <a href="modules.html">Modules</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Module 3: Working With Data</h1>
<h4 class="author"><em>Dai Shizuka</em></h4>
<h4 class="date"><em>updated 09/03/19</em></h4>

</div>


<div id="overview" class="section level2">
<h2>Overview</h2>
<p>Most of you are looking to use R for data analysis, which of course requires learning how to import your data into R. This is maybe the big leap for people who are not used to programming.</p>
<p>To import data into R, you will create an object that points to a dataset somewhere on your computer. R will then import that data as a <strong>dataframe</strong> object (<a href="02.ObjectTypes.html">see Module 2</a>).</p>
<hr />
</div>
<div id="importing-data-overview" class="section level2">
<h2>3.1 Importing Data: Overview</h2>
<p><br></p>
<blockquote>
<p><span style="color:purple"><strong>Do this before you start this section!</strong></span></p>
<ul>
<li>Click on the following links to download three files:</li>
</ul>
<ol style="list-style-type: decimal">
<li><a href="data/SampleData.csv">SampleData.csv</a></li>
<li><a href="data/SampleData_w_errors.csv">SampleData_w_errors.csv</a></li>
<li><a href="data/sex_chromo.csv">sex_chromo.csv</a></li>
</ol>
<ul>
<li>Save these files into a subfolder called “data” inside your working directory (i.e., the folder where you are keeping all of your course materials)</li>
</ul>
</blockquote>
<div id="file-formats-use-.csv-or-.txt" class="section level3">
<h3>3.1.1 File Formats: Use .csv (or .txt)</h3>
<p>Many of us manage data by entering them into a spreadsheet using common software like Microsoft Excel. While we have all likely had headaches associated with Excel, it’s undeniable that it is still the predominant way to compile our data.</p>
<p>R can read several file formats, but the popular excel format (.xlsor .xlsx) is NOT one of them (unless you use a specialized package, e.g., <code>xlsx</code>). Instead, you will most often convert your excel sheet into one of two formats: <strong><em>tab-delimited files (saved as .txt)</em></strong> or <strong><em>comma-separated-values files (.csv)</em></strong>. These are simple text files in which each entry is separated by a tab or comma (respectively). The huge advantage of these formats is that they are non-proprietary file formats that can be read by any text editor. One potential drawback is that you cannot keep any type of formatting (like highlighting of cells on a spread sheet) or special characters.</p>
<p>If you use Excel or any other spreadsheet for data storage, you can easily convert those into one of these formats using <code>[Save as...]</code></p>
<p><strong><em>In this class, I will be using .csv files for almost all data importing tasks.</em></strong></p>
<hr />
</div>
</div>
<div id="five-ways-to-import-data-from-.csv-or-.txt-files" class="section level2">
<h2>3.2 Five ways to import data from .csv (or .txt) files</h2>
<p>No matter how you import the data, the final goal is the same: assign the imported data as an object. Here, we will assign the data into an object called <code>dat</code>. (tip: I would not use “data” as an object name because <code>data()</code> is a function name). Try out each of the following methods for importing a sample data set called “SampleData_1.csv”.</p>
<hr />
<div id="rstudio-project-recommended" class="section level3">
<h3>3.2.1. RStudio Project (recommended)</h3>
<p><strong><em>RStudio Project</em></strong> is a convenient way to organize your projects. When you have your folder organized as a <strong>project directory</strong>, this creates a file called “<yourprojectname>.Rproj” in that folder. Then, if you open that file, it automatically sets that folder as the working directory. This makes the job of finding and importing data much easier than it would be otherwise (i.e., step 2).</p>
<p>Here is an image of how I might organize my course folder: <img src="images/folderorganization1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>In this case, my data files are inside a subfolder called “data”, so the pathname is <code>data/SampleData.csv</code> Using this, I can read in the .csv file using a function called <code>read.csv()</code>, with the path name. <strong><em>Note that the path name needs to be inside quotes</em></strong>.</p>
<pre class="r"><code>dat=read.csv(&quot;data/SampleData.csv&quot;)</code></pre>
<p>One of the biggest benefits of this method is that the pathname is relative to the folder that the .Rproj file is in, which means that as long as the folder is organized in the same way, you can just transfer all the codes to someone else’s computer and it will still work. In contrast, if you are using the full path name, you will always have to edit this for the computer that you are running the code on. This means that, if you simply share the entire folder including the .Rproj file, your collaborator can run your code seamlessly without having to alter the pathname or resetting the working directory.</p>
<hr />
</div>
<div id="entering-the-full-path-name" class="section level3">
<h3>3.2.2. Entering the full path name</h3>
<p>You can also use the full path name to import the data. This might be helpful if you are not using Rstudio Projects and/or saving your script in a folder separate from your data.</p>
<p><strong><em>Finding the path to a file</em></strong> Here is how to get the path to the .csv file on your computer.</p>
<ul>
<li><strong><em>For Windows</em></strong>, you can get the path name of the file or folder by right-clicking it and click “Copy as Path”</li>
<li><strong><em>For Mac (or Windows)</em></strong>, you can look for the file/folder in Finder, and then drag and drop the icon into the “Go to file/function” bar at the top of the RStudio window.</li>
</ul>
<p>As an example, say I made folder on my <strong>desktop</strong> called <strong>Rcourse</strong> and inside that folder, I made another folder called <strong>Week_2</strong>. If my data folder is inside that, this would be the path: <code>/Users/dshizuka/Desktop/Rcourse/Week_2/data</code><br />
In turn, the path to a file inside that folder might be: <code>/Users/dshizuka/Desktop/Rcourse/Week_2/data/SampleData.csv</code></p>
<p>So in this case, your line of code to import the data would be:</p>
<pre class="r"><code>dat=read.csv(&quot;/Users/dshizuka/Desktop/Rcourse/Week_2/data/SampleData.csv&quot;)</code></pre>
<p><strong><em>Alternatively</em></strong>, you can use <code>setwd()</code> to set your working directory, and then enter a simpler path name. This essentially breaks up the process into two lines:</p>
<pre class="r"><code>setwd(&quot;/Users/dshizuka/Desktop/Rcourse/Week_2&quot;)
dat=read.csv(&quot;data/SampleData.csv&quot;)</code></pre>
<p><strong><em>Remember: You will have to change the path inside the lines of code here to be where the file resides in your computer.</em></strong></p>
<blockquote>
<p><span style="color:purple"><strong>Difference between options 1 and 2:</strong></span></p>
<p>Options 1 and 2 (using RStudio Project and Entering Full Path Name) are essentially the same thing in that you are telling R how to find the file on your computer that you want to import. It’s just that RStudio Projects makes this much more straightforward and transferable because the pathname becomes relative to your working directory automatically.</p>
</blockquote>
<hr />
</div>
<div id="use-a-url-recommended-for-data-downloadable-from-the-web" class="section level3">
<h3>3.2.3. Use a url (recommended for data downloadable from the web)</h3>
<p>Sometimes, you will be downloading a dataset that is accessible online, from a static website, a github page, a data repository (like Dryad or Figshare), or even a dropbox folder. In fact, if you can get a url of a data file, you can import it directly into R without having to first downloading it to your computer, saving it and then getting a path name.</p>
<p>For example, if you right-click on the link up above to download the “SampleData.csv” file (under 3.1: Importing Data), you can “copy link address” and get this url: <code>https://dshizuka.github.io/RCourse/data/SampleData.csv</code></p>
<p>So, you can simply download that file using this url instead of the path name:</p>
<pre class="r"><code>dat=read.csv(&quot;https://dshizuka.github.io/RCourse/data/SampleData.csv&quot;)</code></pre>
<p>Super useful! But <strong>note:</strong> only use this if you know that the url is going to be stable for a long time! If you need to be able to reproduce your analysis in the long term, it may pay off to download the data and save it on your computer and use Option 1.</p>
<hr />
</div>
<div id="call-choose-file-prompt." class="section level3">
<h3>3.2.4. Call ‘choose file’ prompt.</h3>
<p>You can also call a prompt that will let you choose the file. You can then find and choose the file you want to import. This is a convenient and quick way to import data. However, it is limiting because it takes time to click around to find the file, and more importantly, this step is not <em>reproducible</em>.</p>
<pre class="r"><code>dat=read.csv(file.choose())</code></pre>
<hr />
</div>
<div id="using-rstudio-gui" class="section level3">
<h3>3.2.5. Using RStudio GUI</h3>
<p>In RStudio, select <code>[File]</code>–<code>[Import Dataset]</code>–<code>[From CSV...]</code> The first time you do this, you may be asked to install the <code>readr</code> package.</p>
<p><strong>Note:</strong> I actually do NOT recommend using this method for a variety of reasons (irreproducibility, takes time, saves the object as a special format).</p>
<hr />
<blockquote>
<p><span style="color:purple"><strong>Importing from .txt files:</strong></span></p>
<p>A more generic function is <code>read.table()</code>. This function allows you to read any kind of text file (including .csv files) while specifying the data is delimited. So, for example, you can use this function to import comma-separated files <code>dat=read.table(file.choose(), sep=&quot;,&quot;)</code>, or tab-delimited files <code>dat=read.table(file.choose(), sep=&quot;\t&quot;)</code>. So the <code>read.table()</code> function is more flexible in many ways.</p>
</blockquote>
<hr />
</div>
</div>
<div id="working-with-imported-data" class="section level2">
<h2>3.3 Working with imported data</h2>
<p><br></p>
<div id="looking-at-the-data" class="section level3">
<h3>3.3.1 Looking at the data</h3>
<p>Now that you have the data imported as an object called <code>dat</code>, let’s look at it! You can do this simply by calling the object:</p>
<pre class="r"><code>dat</code></pre>
<pre><code>##    Indiv.ID    sex      age size weight
## 1     20-01   male    adult 29.5   66.5
## 2     20-02   male juvenile 28.0   58.5
## 3     20-03 female    adult 26.0   57.0
## 4     20-04 female    adult 25.0   55.5
## 5     20-05 female juvenile 25.0   62.0
## 6     20-06   male juvenile 28.0   61.0
## 7     20-07 female    adult 26.0   58.0
## 8     20-08   male    adult 28.5   65.0
## 9     20-09   male juvenile 27.5   60.0
## 10    20-10 female juvenile 26.0   59.0
## 11    20-11   male    adult 25.5   62.0
## 12    20-12 female    adult 27.0   59.0
## 13    20-13 female    adult 26.5   60.0</code></pre>
<p>This data only has 13 rows, so it’s manageable. But sometimes you have a much larger dataset, and you don’t really want to see all of it, but you want to check that the correct data was imported. In that case, you can use a function called <code>head()</code> which will show you just the first 6 lines of an object.</p>
<pre class="r"><code>head(dat)</code></pre>
<pre><code>##   Indiv.ID    sex      age size weight
## 1    20-01   male    adult 29.5   66.5
## 2    20-02   male juvenile 28.0   58.5
## 3    20-03 female    adult 26.0   57.0
## 4    20-04 female    adult 25.0   55.5
## 5    20-05 female juvenile 25.0   62.0
## 6    20-06   male juvenile 28.0   61.0</code></pre>
<p>Sometimes, you also want to double check that your data imported as the correct file type. To do this, you can use the function <code>class()</code> to look up the object class:</p>
<pre class="r"><code>class(dat)</code></pre>
<pre><code>## [1] &quot;data.frame&quot;</code></pre>
<p>Good. This is a data frame.</p>
<hr />
</div>
<div id="subsets-and-subtotals" class="section level3">
<h3>3.3.2 Subsets and Subtotals</h3>
<p>Many times, you will want to just look at subsets of the data: i.e., certain columns or rows that satisfy some condition.<br />
We already covered how to look at specific columns using either the <code>[]</code> or <code>$</code> operators. For example, let’s try using the <code>$</code> operator to look at the sex of individuals in the sample data.</p>
<pre class="r"><code>dat$sex</code></pre>
<pre><code>##  [1] male   male   female female female male   female male   male   female
## [11] male   female female
## Levels: female male</code></pre>
<p>So this gives us just the column named “sex” as a character string</p>
<p>You can do the equivalent by using the <code>[]</code> operator.</p>
<pre class="r"><code>dat[,2]
dat[,&quot;sex&quot;]</code></pre>
<p>In contrast, there is no equivalent of the <code>$</code> for selecting rows. But we can specify the rows we want to look at using the first element within <code>[]</code>:</p>
<pre class="r"><code>dat[2,] #get the second row of the dataset</code></pre>
<p>If we want to look at all rows that fulfill some criteria, we can use the <code>==</code> operator. For example, let’s look at all of the data for males:</p>
<pre class="r"><code>dat[dat$sex==&quot;male&quot;, ]</code></pre>
<pre><code>##    Indiv.ID  sex      age size weight
## 1     20-01 male    adult 29.5   66.5
## 2     20-02 male juvenile 28.0   58.5
## 6     20-06 male juvenile 28.0   61.0
## 8     20-08 male    adult 28.5   65.0
## 9     20-09 male juvenile 27.5   60.0
## 11    20-11 male    adult 25.5   62.0</code></pre>
<p>In this case, R interprets this command to pick out rows in the data where the answer to <code>dat$sex==&quot;male&quot;</code> is TRUE.</p>
<p>You can use multiple criteria to subset the data. Use the <code>|</code> to mean “or” and the <code>&amp;</code> operator to mean “and”. For example:</p>
<pre class="r"><code>dat[dat$sex==&quot;male&quot;|dat$weight&lt;60,] #give me the data for rows where sex is male OR weight is less than 60. This gives you all but two records. </code></pre>
<pre><code>##    Indiv.ID    sex      age size weight
## 1     20-01   male    adult 29.5   66.5
## 2     20-02   male juvenile 28.0   58.5
## 3     20-03 female    adult 26.0   57.0
## 4     20-04 female    adult 25.0   55.5
## 6     20-06   male juvenile 28.0   61.0
## 7     20-07 female    adult 26.0   58.0
## 8     20-08   male    adult 28.5   65.0
## 9     20-09   male juvenile 27.5   60.0
## 10    20-10 female juvenile 26.0   59.0
## 11    20-11   male    adult 25.5   62.0
## 12    20-12 female    adult 27.0   59.0</code></pre>
<pre class="r"><code>dat[dat$sex==&quot;male&quot;&amp;dat$weight&lt;60,] #give me the data for rows where sex is male AND weight is less than 60. This gives you just one record of the male that is less than 60g. </code></pre>
<pre><code>##   Indiv.ID  sex      age size weight
## 2    20-02 male juvenile   28   58.5</code></pre>
<p>If you want to EXCLUDE data for certain rows, you can use the <code>!=</code> operator:</p>
<pre class="r"><code>dat[dat$sex!=&quot;male&quot;,] #this will give you the records for individuals that are NOT male (i.e., females)</code></pre>
<pre><code>##    Indiv.ID    sex      age size weight
## 3     20-03 female    adult 26.0   57.0
## 4     20-04 female    adult 25.0   55.5
## 5     20-05 female juvenile 25.0   62.0
## 7     20-07 female    adult 26.0   58.0
## 10    20-10 female juvenile 26.0   59.0
## 12    20-12 female    adult 27.0   59.0
## 13    20-13 female    adult 26.5   60.0</code></pre>
<div id="using-the-which-function" class="section level4">
<h4>Using the <code>which()</code> function:</h4>
<p>Another way to subset the data is to use the <code>which()</code> function, which is extremely useful. We will be using this function a lot as we go forward.<br />
Basically, <code>which()</code> allows you to get the element number of a vector that fits certain criteria. For example, these are the row numbers for males in the dataset:</p>
<pre class="r"><code>which(dat$sex==&quot;male&quot;)</code></pre>
<pre><code>## [1]  1  2  6  8  9 11</code></pre>
<p>So you can use this command to subset the data in a similar way as above:</p>
<pre class="r"><code>dat[which(dat$sex==&quot;male&quot;), ] #don&#39;t forget the comma!</code></pre>
<pre><code>##    Indiv.ID  sex      age size weight
## 1     20-01 male    adult 29.5   66.5
## 2     20-02 male juvenile 28.0   58.5
## 6     20-06 male juvenile 28.0   61.0
## 8     20-08 male    adult 28.5   65.0
## 9     20-09 male juvenile 27.5   60.0
## 11    20-11 male    adult 25.5   62.0</code></pre>
<p>You can also look at a particular variable within a particular subset. Here are two ways to do the same thing–get the body size of males.</p>
<pre class="r"><code>dat[dat$sex==&quot;male&quot;,&quot;size&quot;]</code></pre>
<pre><code>## [1] 29.5 28.0 28.0 28.5 27.5 25.5</code></pre>
<pre class="r"><code>dat$size[dat$sex==&quot;male&quot;]</code></pre>
<pre><code>## [1] 29.5 28.0 28.0 28.5 27.5 25.5</code></pre>
<hr />
</div>
</div>
<div id="summary-data" class="section level3">
<h3>3.3.3 Summary data</h3>
<p>Now that you know how to select variables and subset data you can, use this to calculate summary statistics. For example, let’s look at the mean size of males vs. females using the function <code>mean()</code></p>
<pre class="r"><code>mean(dat$size[dat$sex==&quot;male&quot;])</code></pre>
<pre><code>## [1] 27.83333</code></pre>
<pre class="r"><code>mean(dat$size[dat$sex==&quot;female&quot;])</code></pre>
<pre><code>## [1] 25.92857</code></pre>
<p>A more elegant way to do this is to use either the <code>tapply()</code> or <code>aggregate()</code> functions. For both of these functions, the first argument is the column to apply the calculation to, second argument is the categorical variable (in list format), and the third argument is the function name for the calculation you want to apply. Try these out for calculating the mean body size by sex:</p>
<pre class="r"><code>tapply(dat$size,dat$sex,mean)</code></pre>
<pre><code>##   female     male 
## 25.92857 27.83333</code></pre>
<pre class="r"><code>aggregate(dat$size,by=list(Sex=dat$sex),mean)</code></pre>
<pre><code>##      Sex        x
## 1 female 25.92857
## 2   male 27.83333</code></pre>
<p>Note that the tapply() and aggregate() uses different formats as outputs—-<code>tapply()</code> returns an array, while <code>aggregate()</code> returns a dataframe.<br />
You can see this better when you calculate the means while splitting up the data by two different factors, like sex and age:</p>
<pre class="r"><code>tap=tapply(dat$size,list(dat$sex,dat$age),mean)
agg=aggregate(dat$size,by=list(Sex=dat$sex, Age=dat$age),mean)
class(tap)</code></pre>
<pre><code>## [1] &quot;matrix&quot;</code></pre>
<pre class="r"><code>class(agg)</code></pre>
<pre><code>## [1] &quot;data.frame&quot;</code></pre>
<pre class="r"><code>tap</code></pre>
<pre><code>##           adult juvenile
## female 26.10000 25.50000
## male   27.83333 27.83333</code></pre>
<pre class="r"><code>agg</code></pre>
<pre><code>##      Sex      Age        x
## 1 female    adult 26.10000
## 2   male    adult 27.83333
## 3 female juvenile 25.50000
## 4   male juvenile 27.83333</code></pre>
<p>You can see that the output of <code>tapply</code> is a matrix, and the output of <code>aggregate()</code> is a dataframe. So you can use one or other function depending on what you want to do with the output of the calculation you want to do.</p>
<p>For example, you can use the same set of functions to calculate the sums of sizes for each sex x age combination:</p>
<pre class="r"><code>tapply(dat$size,list(dat$sex,dat$age),sum)</code></pre>
<pre><code>##        adult juvenile
## female 130.5     51.0
## male    83.5     83.5</code></pre>
<pre class="r"><code>aggregate(dat$size,by=list(Sex=dat$sex, Age=dat$age),sum)</code></pre>
<pre><code>##      Sex      Age     x
## 1 female    adult 130.5
## 2   male    adult  83.5
## 3 female juvenile  51.0
## 4   male juvenile  83.5</code></pre>
<hr />
</div>
</div>
<div id="linking-two-data-sets" class="section level2">
<h2>3.4 Linking two data sets</h2>
<p>There are a many instances in which you have two different datasets for the same subjects. For example, I might have one dataset from capturing and measuring a bunch of individual birds. At that point, I take a blood or tissue sample from each individual and I might later use loci linked to sex chromosomes to confirm sex the individual is (many birds are monomorphic and it can be difficult to tell the sexes apart). I now have two different spreadsheets containing different pieces of information about the same subjects, and I might want to combine this information. You may have done something like this in the past using “lookup functions” in excel or database software (e.g., Microsoft Access, FileMaker, etc.). Now we will learn how to do this in R. Let’s start by importing two different sets of data (one of them is the same as what we have been using so far). To get started, we will now import a second dataset called <code>sex_chromo.csv</code>, which should already be saved in your “data” subfolder.</p>
<pre class="r"><code>chromo=read.csv(&quot;data/sex_chromo.csv&quot;)</code></pre>
<p>We now have two dataframes—dat and sex. This second dataframe has information of sex chromosomes that we have identified for each individual using molecular methods. We now use a match() function to look up which rows correspond to the same individual:</p>
<pre class="r"><code>match(dat$Indiv.ID,chromo$Indiv.ID)</code></pre>
<pre><code>##  [1]  8  9  1  2  3 10  4 11 12  5 13  6  7</code></pre>
<p>Here, the first value indicates which row in the dataframe chromo corresponds to the first row in dat? Remember that the order of the elements within the parentheses matter. You can confirm this by looking at both dataframes. You can use this to lookup the sex chromosomes for each individual in the dataframe dat.</p>
<pre class="r"><code>sex.chromo=chromo[match(dat$Indiv.ID,chromo$Indiv.ID),&quot;chromosomes&quot;]
sex.chromo</code></pre>
<pre><code>##  [1] XY XY XX XX XX XY XX XY XY XX XY XX XX
## Levels: XX XY</code></pre>
<p>You can append this new vector, sex.chromo, to the dataframe dat using the function cbind():</p>
<pre class="r"><code>merged.dat=cbind(dat,sex.chromo)
merged.dat</code></pre>
<pre><code>##    Indiv.ID    sex      age size weight sex.chromo
## 1     20-01   male    adult 29.5   66.5         XY
## 2     20-02   male juvenile 28.0   58.5         XY
## 3     20-03 female    adult 26.0   57.0         XX
## 4     20-04 female    adult 25.0   55.5         XX
## 5     20-05 female juvenile 25.0   62.0         XX
## 6     20-06   male juvenile 28.0   61.0         XY
## 7     20-07 female    adult 26.0   58.0         XX
## 8     20-08   male    adult 28.5   65.0         XY
## 9     20-09   male juvenile 27.5   60.0         XY
## 10    20-10 female juvenile 26.0   59.0         XX
## 11    20-11   male    adult 25.5   62.0         XY
## 12    20-12 female    adult 27.0   59.0         XX
## 13    20-13 female    adult 26.5   60.0         XX</code></pre>
<p>Ok, now that I have shown you the hard way to do this, here is the easy way, using the function merge():</p>
<pre class="r"><code>merged.dat2=merge(dat,chromo,by=&quot;Indiv.ID&quot;)
merged.dat2</code></pre>
<pre><code>##    Indiv.ID    sex      age size weight chromosomes
## 1     20-01   male    adult 29.5   66.5          XY
## 2     20-02   male juvenile 28.0   58.5          XY
## 3     20-03 female    adult 26.0   57.0          XX
## 4     20-04 female    adult 25.0   55.5          XX
## 5     20-05 female juvenile 25.0   62.0          XX
## 6     20-06   male juvenile 28.0   61.0          XY
## 7     20-07 female    adult 26.0   58.0          XX
## 8     20-08   male    adult 28.5   65.0          XY
## 9     20-09   male juvenile 27.5   60.0          XY
## 10    20-10 female juvenile 26.0   59.0          XX
## 11    20-11   male    adult 25.5   62.0          XY
## 12    20-12 female    adult 27.0   59.0          XX
## 13    20-13 female    adult 26.5   60.0          XX</code></pre>
<p>Note that you have to make sure that the variable names are identical in both dataframes for this to work!</p>
<p>Lastly, try this code to see that (in this hypothetical dataset), the sex chromosomes match up with the gender scored in the field.</p>
<pre class="r"><code>table(merged.dat2$sex,merged.dat2$chromosomes)</code></pre>
<pre><code>##         
##          XX XY
##   female  7  0
##   male    0  6</code></pre>
</div>
<div id="troubleshootingcleaning-data-in-r" class="section level2">
<h2>3.5 Troubleshooting/Cleaning Data in R</h2>
<p>You will often have some kind of problem reading in files. One of the big roadblocks to using R is dealing with these bugs.</p>
<p>Some common problems:</p>
<ul>
<li><strong>It won’t import</strong>
<ul>
<li>Are you sure you saved the file as a .csv file?</li>
<li>Is the path and file name correct?</li>
<li>Is the path and file name inside quotes?</li>
</ul></li>
<li><strong>I get a weird column that has a bunch of <code>NA</code></strong>
<ul>
<li>You probably have a column in your spreadsheet that has a value in one of the cells that you forgot about.</li>
</ul></li>
<li><strong>I have a weird column at the bottom of my data that is just a bunch of <code>NA</code></strong>
<ul>
<li>You probably have a cell at the bottom of your spreadsheet with “hidden spaces”.</li>
<li>Fix: In excel, do a “Find and Replace” to replace blank space with some character (e.g., a *) and then go and find and erase those characters.</li>
</ul></li>
<li><strong>Column is supposed to be numeric but it is showing up as factors.</strong>
<ul>
<li>You probably have a cell value in the column that is non-numeric, e.g., “#N/A” or ‘hidden space’</li>
<li>Fix: You can specify what kind of characters should be interpreted as <code>NA</code> using the <code>na.string=</code> argument (see above).</li>
</ul></li>
</ul>
<p>We will deal with some of these issues as well as how to prevent them in a separate section on best practices in data management.</p>
<hr />
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
