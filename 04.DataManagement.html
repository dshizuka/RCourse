<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Dai Shizuka" />


<title>Module 4: Managing Data</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/sandstone.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 61px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 66px;
  margin-top: -66px;
}

.section h2 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h3 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h4 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h5 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h6 {
  padding-top: 66px;
  margin-top: -66px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Intro to R</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="syllabus.html">Syllabus</a>
</li>
<li>
  <a href="modules.html">Modules</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Module 4: Managing Data</h1>
<h4 class="author"><em>Dai Shizuka</em></h4>
<h4 class="date"><em>updated 09/03/19</em></h4>

</div>


<p>In Module 3, we covered how to import and look at subsets of data. Here, we will deal with situations where you need to troubleshoot the data import process. Here in Module 4, we will deal with common issues that arise while importing data, as well as some best practices in data formatting. Finally, we will touch on how to change the formatting of your data set within R.</p>
<hr />
<div id="formatting-your-data-in-spreadsheets" class="section level2">
<h2>4.1 Formatting your data in spreadsheets</h2>
<p>This first part is not necessarily about R. It is about managing your Excel sheet in a way that facilitates data analysis outside of Excel.</p>
<p>One of the reasons that many formatting problems arise while keeping data in spreadsheets is that the common software (e.g., Excel) is actually used for many different purposes. For example, people often use excel to generate templates for forms (e.g., purchasing forms). Best practices for those uses of Excel are completely different from what you should do when using spreadsheets for entering data. In this section, we will go over some dos and don’ts of spreadsheets for data management.</p>
<p>***Some of this material is from a free online resource from datacarpentry.org: <a href="https://datacarpentry.org/spreadsheet-ecology-lesson/">“Data Organization in Spreadsheets for Ecologists”</a></p>
<div id="basic-structure-of-a-spreadsheet" class="section level3">
<h3>4.1.1 Basic structure of a spreadsheet</h3>
<ol style="list-style-type: decimal">
<li><p>First line (Header) are names of variables. Each variable is one column. Do not use values as column names.</p></li>
<li><p>Each subject (animal, plant, cell, etc.) should have an ID. This is useful if you have multiple spreadsheet where you have different information about the subject–if you have a common ID, you can link together datasets more easily.</p></li>
<li><p>Each row should be an observation. If you are observing a subject multiple times (e.g., repeated measures design), each observation should be a separate line, with the measurment time/place/trial/etc. as a separate column.</p></li>
</ol>
<div class="figure" style="text-align: center">
<img src="images/eggdata_image.png" alt="Example spreadsheet of data on egg size of American Coots" width="100%" />
<p class="caption">
Example spreadsheet of data on egg size of American Coots
</p>
</div>
<p><br></p>
</div>
<div id="spreadsheet-dos-and-donts" class="section level3">
<h3>4.1.2 Spreadsheet dos and don’ts!</h3>
<p><br></p>
<div id="dont-keep-multiple-tables-in-one-sheet" class="section level4">
<h4>1. <strong>Don’t</strong> keep multiple tables in one sheet</h4>
<p>This is one common way people have used excel sheets when your data comes from multiple sources (e.g., multiple plots). It also makes you feel like you have maximum information in the sheet. But in reality, this makes it impossible to do any global analysis. And R cannot read in this type of spreadsheet.</p>
<div class="figure" style="text-align: center">
<img src="images/multitable.png" alt="example from https://datacarpentry.org/spreadsheet-ecology-lesson/02-common-mistakes" width="482" />
<p class="caption">
example from <a href="https://datacarpentry.org/spreadsheet-ecology-lesson/02-common-mistakes" class="uri">https://datacarpentry.org/spreadsheet-ecology-lesson/02-common-mistakes</a>
</p>
</div>
<p><strong><em>Solution:</em></strong> Just keep one sheet. If you have multiple plots, treatments, etc., make that a column in your data. Example in 4.1.1***</p>
<p><br></p>
</div>
<div id="dont-use-special-characters-or-commas." class="section level4">
<h4>2. <strong>Don’t</strong> use special characters or commas.</h4>
<p>Excel is capable of handling special characters that other software cannot. For example, if you have the ‘degree’ symbol (C<span class="math inline">\(^\circ\)</span>) or ‘em dash’ (where “–” gets converted to one long dash), these will not be read correctly when you import data in R. Do NOT use these special characters in your data.</p>
<p>Also, commas cause problems when you are saving data in .csv files because the commas are designated for separating columns. If you like to write notes in your data, just make sure you don’t use commas! (e.g., if need be, you could use semi-colons)</p>
<p><strong><em>Solution:</em></strong> Always think about whether your inputs will be read correctly by R or other stats program. Default to non-proprietary formats.</p>
<p><br></p>
</div>
<div id="dont-use-formatting-i.e.-highlighting-to-convey-information." class="section level4">
<h4>3. <strong>Don’t</strong> use formatting (i.e., highlighting) to convey information.</h4>
<p>You can always add another column to include that information as another variable.</p>
<div class="figure" style="text-align: center">
<img src="images/highlighting.png" alt="example from https://datacarpentry.org/spreadsheet-ecology-lesson/02-common-mistakes" width="100%" />
<p class="caption">
example from <a href="https://datacarpentry.org/spreadsheet-ecology-lesson/02-common-mistakes" class="uri">https://datacarpentry.org/spreadsheet-ecology-lesson/02-common-mistakes</a>
</p>
</div>
<p><br></p>
</div>
<div id="do-use-good-null-values" class="section level4">
<h4>4. <strong>Do</strong> use good ‘null values’</h4>
<ul>
<li><p><strong>Always put in 0 if the observed vaule is 0</strong> (i.e., don’t skip the cell just because it’s 0). If you don’t it becomes indistinguishable from unknown or unobserved data.</p></li>
<li><p><strong>Don’t use other numbers (e.g., 999 or -999).</strong> This used to be common practice for some stats software. But this can cause problems because it may be inadvertently used in calculations.</p></li>
<li><p><strong>Don’t use other symbols (-, ., ?).</strong> Again, this used to be common practice for some people, but this can cause problems because R won’t know how to interpret it.</p></li>
<li><strong><em>Good options include:</em></strong>
<ul>
<li>Blank cells. But only if you are careful to always put 0 when the correct value is 0.</li>
<li>Consistent, conventional abbreviation (e.g., NA, NULL).** <strong><em>BUT</em></strong>, note that “NA” may be used as abbreviations for other things, like “North America”. But if used in a column that is otherwise numeric, R can automatically interpret this as null value.</li>
</ul></li>
</ul>
<p>If you are using consistent null value designations, you can specify these values as null using the <code>na.string=</code> argument within the <code>read.csv()</code> function. For example,</p>
<pre class="r"><code>dat=read.csv(&quot;data/SampleData.csv&quot;, na.string=c(&quot;NA&quot;, &quot;#N/A&quot;))</code></pre>
<p>The above code will tell R that cells with either “NA” or “#N/A” should be interpreted as missing data.</p>
<p><br></p>
</div>
<div id="do-not-use-merged-cells" class="section level4">
<h4>5. Do not use merged cells!</h4>
<p>Merging cells makes your data unreadable by R (or other stats software)</p>
<p><br></p>
</div>
<div id="avoid-keeping-summary-data-along-with-raw-data-i.e.-dont-make-a-group-means-column-in-your-dataset." class="section level4">
<h4>6. Avoid keeping summary data along with raw data (i.e., don’t make a “group means” column in your dataset).</h4>
<p>This is more of a suggestion than a rule. When you use formulas within Excel to calculate summary values, those formulas do not carry over when you convert the spreadsheet to .csv. This means that if you need to do any recalculations, or if you realize there are any errors in values, those summary values will become outdated. It is much easier (and better) to calculate summary values within R anyway.</p>
</div>
</div>
<div id="wide--vs.long-format-data" class="section level3">
<h3>4.2.3. Wide- vs. Long-format data</h3>
<p>The most important thing to keep in mind is that your data should contain <strong>each observation as a separate row</strong>. For example, each subject should be a separate row. If you have repeated measurements from the same subject, each observation should be a separate row, and you should have a column that specifies which observation/trial number.</p>
<p>For example, this is the WRONG way to structure a dataframe:</p>
<table>
<thead>
<tr class="header">
<th>Subject</th>
<th>Time 1</th>
<th>Time 2</th>
<th>Time 3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>A</td>
<td>1.2</td>
<td>2.5</td>
<td>4.1</td>
</tr>
<tr class="even">
<td>B</td>
<td>1.6</td>
<td>2.6</td>
<td>3.8</td>
</tr>
<tr class="odd">
<td>C</td>
<td>0.9</td>
<td>2.4</td>
<td>3.6</td>
</tr>
</tbody>
</table>
<p>The correct structure for this data set would be:</p>
<table>
<thead>
<tr class="header">
<th>Subject</th>
<th>Time</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>A</td>
<td>1</td>
<td>1.2</td>
</tr>
<tr class="even">
<td>A</td>
<td>2</td>
<td>2.5</td>
</tr>
<tr class="odd">
<td>A</td>
<td>3</td>
<td>4.1</td>
</tr>
<tr class="even">
<td>B</td>
<td>1</td>
<td>1.6</td>
</tr>
<tr class="odd">
<td>B</td>
<td>2</td>
<td>2.6</td>
</tr>
<tr class="even">
<td>B</td>
<td>3</td>
<td>3.8</td>
</tr>
<tr class="odd">
<td>C</td>
<td>1</td>
<td>0.9</td>
</tr>
<tr class="even">
<td>C</td>
<td>2</td>
<td>2.4</td>
</tr>
<tr class="odd">
<td>C</td>
<td>3</td>
<td>3.6</td>
</tr>
</tbody>
</table>
<p>The order of the rows is not relevant. The key is that each observation for a given individual shows up as separate rows.</p>
<p>For more on this distinction, see <a href="http://www.jstatsoft.org/v59/i10">Wickham (2014) paper</a> on “Tidy Data”</p>
<hr />
<blockquote>
<p><span style="color:purple"><strong><em>Key rule in reproducible research: Try not to mess with raw data! </em></strong></span></p>
<p>Once you have collected data, it is best to try to keep that raw data <strong><em>raw</em></strong>. If you find coding errors or you need to subset data for your analyses, it is best to do that with R once the data has been imported. This is because data-cleaning in R is reproducible. But once you start messing with raw data, it is way too easy to lose track of what you “fixed” and what you did not. Also, there are times when you later realize that you “fixed” the data incorrectly. If you have done all of that in excel, it is difficult to go back. But if you have done everything in script, everything is reversible.</p>
</blockquote>
<hr />
</div>
</div>
<div id="troubleshooting-data-import" class="section level2">
<h2>4.2 Troubleshooting Data Import</h2>
<p>You will often have some kind of problem reading in files. One of the big roadblocks to using R is dealing with these bugs.</p>
<p>Some common problems:</p>
<ul>
<li><strong>It won’t import</strong>
<ul>
<li>Are you sure you saved the file as a .csv file?</li>
<li>Is the path and file name correct?</li>
<li>Is the path and file name inside quotes?</li>
</ul></li>
<li><strong>I get a weird column that has a bunch of <code>NA</code></strong>
<ul>
<li>You probably have a column in your spreadsheet that has a value in one of the cells that you forgot about.</li>
</ul></li>
<li><strong>I have a weird column at the bottom of my data that is just a bunch of <code>NA</code></strong>
<ul>
<li>You probably have a cell at the bottom of your spreadsheet with “hidden spaces”.</li>
<li>Fix: In excel, do a “Find and Replace” to replace blank space with some character (e.g., a *) and then go and find and erase those characters.</li>
</ul></li>
<li><strong>Column is supposed to be numeric but it is showing up as factors.</strong>
<ul>
<li>You probably have a cell value in the column that is non-numeric, e.g., “#N/A” or ‘hidden space’</li>
<li>Fix: You can specify what kind of characters should be interpreted as <code>NA</code> using the <code>na.string=</code> argument (see above).</li>
</ul></li>
</ul>
<p>We will deal with some of these issues as well as how to prevent them in a separate section on best practices in data management.</p>
<hr />
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
