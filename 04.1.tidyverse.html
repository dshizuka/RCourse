<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Dai Shizuka" />


<title>Data Wrangling to plots with tidyverse packages</title>

<script src="site_libs/header-attrs-2.16/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/sandstone.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Intro to R</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="syllabus.html">Syllabus</a>
</li>
<li>
  <a href="modules.html">Modules</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Data Wrangling to plots with tidyverse
packages</h1>
<h4 class="author">Dai Shizuka</h4>
<h4 class="date">updated 09/14/22</h4>

</div>


<div id="intro-to-the-tidyverse" class="section level2">
<h2>Intro to the <a
href="https://www.tidyverse.org/">‘tidyverse’</a></h2>
<p><img src="images/icons/tidyr.png" width="10%" /><img src="images/icons/dplyr.png" width="10%" /><img src="images/icons/stringr.png" width="10%" /><img src="images/icons/ggplot2.png" width="10%" /></p>
<p>Now that we have dipped our feet into plots and stats in R, I think
you are getting a better sense of the fact that ‘wrangling’ or
‘manipulating’ data is one of the biggest steps to becoming proficient
in R and all that it has to offer.</p>
<p>For example, for any given analysis, you may have to subset data,
filter out certain data that don’t meet some criteria, focus in on a
select set of variables of interest, calculate means, and variance for
different groups, etc. etc.</p>
<p>These tasks are where the packages <a
href="https://dplyr.tidyverse.org/">dplyr</a>, <a
href="https://tidyr.tidyverse.org/">tidyr</a> and other packages in the
<a href="https://www.tidyverse.org/">tidyverse</a>–a series of packages
designed for all kinds of data tasks. This also includes the popular <a
href="https://ggplot2.tidyverse.org/">ggplot2</a> package for
graphics.</p>
<p>The tidyverse packages are constructed by <a
href="http://hadley.nz/">Hadley Wickam</a>. There are several books that
cover how to use these packages, including <em>R for Data Science</em>
<a href="https://r4ds.had.co.nz/">which is available for free as an
online book</a></p>
<p><img src="images/icons/R_for_Data_Science_cover.png" width="20%" /></p>
<p>In this module, we’ll be learning some functions from the packages
<strong>dplyr</strong> and <strong>tidyr</strong>.</p>
<p>We will do this by playing with data from the World Bank and World
Health Organization (WHO)!</p>
<hr />
</div>
<div id="installing-and-loading-packages-we-need-for-this-module"
class="section level2">
<h2>Installing and loading packages we need for this module</h2>
<p>One can install each package separately, but you can also just
install all “tidyverse” packages simply by running this command:</p>
<pre class="r"><code>install.packages(&quot;tidyverse&quot;)
install.packages(&quot;wbstats&quot;)</code></pre>
<p>Note that this simply downloads the packages onto your computer. When
you are ready to use them, you will have to load the package onto the
environment by running the function</p>
<p>You now have the package downloaded on your computer, but to actually
use it, you have to load the package. We can load the entire
<code>tidyverse</code> package (or, if you prefer, you can just load the
<code>tidyr</code> package).</p>
<pre class="r"><code>library(wbstats)
library(tidyverse)</code></pre>
<pre><code>## ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──
## ✔ ggplot2 3.3.6      ✔ purrr   0.3.4 
## ✔ tibble  3.1.8      ✔ dplyr   1.0.10
## ✔ tidyr   1.2.1      ✔ stringr 1.4.1 
## ✔ readr   2.1.2      ✔ forcats 0.5.2 
## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
## ✖ dplyr::filter() masks stats::filter()
## ✖ dplyr::lag()    masks stats::lag()</code></pre>
<p><strong>Two important thing to notice here.</strong> First, the
message tells you what packages were actually loaded as part of the
tidyverse “metapackage”. You see that this includes 8 packages:
ggplot2,tibble, tidyr, readr, purrr, dplyr, stringr, and forcats.
Second, the message tells you that there are two functions in the
<code>dplyr</code> package that conflict with existing functions:
<code>filter()</code> and <code>lag()</code>. This is sometimes very
important to know! This means that the <code>filter()</code> function
works differently before and after loading this package.</p>
<hr />
<blockquote>
<p><span style="color:purple"><strong><em>Some things to know about
getting started with ‘tidyverse’</em></strong></span></p>
<p><strong>Pipe Operator (<code>%&gt;%</code>):</strong> tidyverse makes
use of the pipe operator <code>%&gt;%</code>, which allows you to carry
over the output of one function to the next function. This can make
series of data manipulation sequences much more efficient.</p>
<p><strong>Tibbles:</strong> “tibble” is a special class of dataframe
that is used in tidyverse. It is largely the same as a dataframe but it
has some features (or rather, lack of features) that make for ‘defensive
coding’. That is, it forces you to avoid dangerous operations, such as
changing variable names or types (you have to explicitly do this) or
allow “partial matching”.</p>
<p>To learn more about tibbles, start <a
href="https://tibble.tidyverse.org/">here</a></p>
</blockquote>
<hr />
</div>
<div id="introduction-to-the-datasets" class="section level2">
<h2>1. Introduction to the datasets</h2>
<p>The World Bank actually makes it very easy to download a huge amount
of data very easily. You could just go to the <a
href="https://data.worldbank.org/">World Bankd Open Data site</a> and
search for data and download them in a few clicks. There are even
packages such as <code>WDI</code> and <code>wbstats</code> that allow
you to query and pull data from this site from within R.</p>
<p>However, for the purposes of this exercise, we will deal with several
datasets that are included in the packages we have loaded above.</p>
<p><br></p>
<div id="world_bank_pop-population-data-from-world-bank-2000-2017"
class="section level3">
<h3>1.1. <code>world_bank_pop</code>: Population data from World Bank
(2000-2017)</h3>
<p>First is the <code>world_bank_pop</code> dataset that is included in
the <code>tidyr</code> package (which is part of the the tidyverse
suite). Start by pulling up the help file for the dataset</p>
<pre class="r"><code>?world_bank_pop</code></pre>
<p>Let’s take a peak at the data, which is in “tibble” format:</p>
<pre class="r"><code>world_bank_pop</code></pre>
<pre><code>## # A tibble: 1,056 × 20
##    country indic…¹ `2000` `2001` `2002` `2003`  `2004`  `2005`   `2006`   `2007`
##    &lt;chr&gt;   &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
##  1 ABW     SP.URB… 4.24e4 4.30e4 4.37e4 4.42e4 4.47e+4 4.49e+4  4.49e+4  4.47e+4
##  2 ABW     SP.URB… 1.18e0 1.41e0 1.43e0 1.31e0 9.51e-1 4.91e-1 -1.78e-2 -4.35e-1
##  3 ABW     SP.POP… 9.09e4 9.29e4 9.50e4 9.70e4 9.87e+4 1.00e+5  1.01e+5  1.01e+5
##  4 ABW     SP.POP… 2.06e0 2.23e0 2.23e0 2.11e0 1.76e+0 1.30e+0  7.98e-1  3.84e-1
##  5 AFG     SP.URB… 4.44e6 4.65e6 4.89e6 5.16e6 5.43e+6 5.69e+6  5.93e+6  6.15e+6
##  6 AFG     SP.URB… 3.91e0 4.66e0 5.13e0 5.23e0 5.12e+0 4.77e+0  4.12e+0  3.65e+0
##  7 AFG     SP.POP… 2.01e7 2.10e7 2.20e7 2.31e7 2.41e+7 2.51e+7  2.59e+7  2.66e+7
##  8 AFG     SP.POP… 3.49e0 4.25e0 4.72e0 4.82e0 4.47e+0 3.87e+0  3.23e+0  2.76e+0
##  9 AGO     SP.URB… 8.23e6 8.71e6 9.22e6 9.77e6 1.03e+7 1.09e+7  1.15e+7  1.21e+7
## 10 AGO     SP.URB… 5.44e0 5.59e0 5.70e0 5.76e0 5.75e+0 5.69e+0  4.92e+0  4.89e+0
## # … with 1,046 more rows, 10 more variables: `2008` &lt;dbl&gt;, `2009` &lt;dbl&gt;,
## #   `2010` &lt;dbl&gt;, `2011` &lt;dbl&gt;, `2012` &lt;dbl&gt;, `2013` &lt;dbl&gt;, `2014` &lt;dbl&gt;,
## #   `2015` &lt;dbl&gt;, `2016` &lt;dbl&gt;, `2017` &lt;dbl&gt;, and abbreviated variable name
## #   ¹​indicator</code></pre>
<p>Notice that each country is repeated across 4 rows. This is because
there are actually 4 different “indicators” for each country, and so
each country x indicator combination takes up a row. The rest of the
columns are years, from 2000 to 2017.</p>
<p>Also notice that the numbers in the column names have a backquote, or
“`” around them. In R, this allows numbers to be interpreted as text
(and column names have to be text).</p>
<p>So, if you wanted to pull up the “2001” column, this will NOT
work…</p>
<pre class="r"><code>world_bank_pop$2001</code></pre>
<p>…but this will work</p>
<pre class="r"><code>world_bank_pop$`2001`</code></pre>
<p><br></p>
</div>
<div id="who-world-health-organization-tb-data-1980---2013"
class="section level3">
<h3>1.3. <code>who</code>: World Health Organization TB data (1980 -
2013)</h3>
<p>The last dataset we will use in this module is the WHO Global
Tuberculosis Report from 1980 to 2013, which is included in the tidyr
package as <code>who</code></p>
<pre class="r"><code>?who</code></pre>
<pre class="r"><code>who</code></pre>
<pre><code>## # A tibble: 7,240 × 60
##    country     iso2  iso3   year new_s…¹ new_s…² new_s…³ new_s…⁴ new_s…⁵ new_s…⁶
##    &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt; &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;
##  1 Afghanistan AF    AFG    1980      NA      NA      NA      NA      NA      NA
##  2 Afghanistan AF    AFG    1981      NA      NA      NA      NA      NA      NA
##  3 Afghanistan AF    AFG    1982      NA      NA      NA      NA      NA      NA
##  4 Afghanistan AF    AFG    1983      NA      NA      NA      NA      NA      NA
##  5 Afghanistan AF    AFG    1984      NA      NA      NA      NA      NA      NA
##  6 Afghanistan AF    AFG    1985      NA      NA      NA      NA      NA      NA
##  7 Afghanistan AF    AFG    1986      NA      NA      NA      NA      NA      NA
##  8 Afghanistan AF    AFG    1987      NA      NA      NA      NA      NA      NA
##  9 Afghanistan AF    AFG    1988      NA      NA      NA      NA      NA      NA
## 10 Afghanistan AF    AFG    1989      NA      NA      NA      NA      NA      NA
## # … with 7,230 more rows, 50 more variables: new_sp_m65 &lt;int&gt;,
## #   new_sp_f014 &lt;int&gt;, new_sp_f1524 &lt;int&gt;, new_sp_f2534 &lt;int&gt;,
## #   new_sp_f3544 &lt;int&gt;, new_sp_f4554 &lt;int&gt;, new_sp_f5564 &lt;int&gt;,
## #   new_sp_f65 &lt;int&gt;, new_sn_m014 &lt;int&gt;, new_sn_m1524 &lt;int&gt;,
## #   new_sn_m2534 &lt;int&gt;, new_sn_m3544 &lt;int&gt;, new_sn_m4554 &lt;int&gt;,
## #   new_sn_m5564 &lt;int&gt;, new_sn_m65 &lt;int&gt;, new_sn_f014 &lt;int&gt;,
## #   new_sn_f1524 &lt;int&gt;, new_sn_f2534 &lt;int&gt;, new_sn_f3544 &lt;int&gt;, …</code></pre>
<p>This is yet another massive dataset, with 7,240 rows, and 60 columns
with very weird names. We will figure out what to do with these later
on.</p>
<p><br></p>
<hr />
</div>
</div>
<div
id="problem-1-countries-that-are-not-countries-merging-datasets-with-join-functions"
class="section level2">
<h2>2. Problem 1: “Countries” that are not countries: Merging datasets
with <code>join</code> functions</h2>
<p>We are going to start by diving into the <code>world_bank_pop</code>
dataset.</p>
<p>Let’s take a peek at the dataset again and see what we have…</p>
<pre class="r"><code>world_bank_pop</code></pre>
<pre><code>## # A tibble: 1,056 × 20
##    country indic…¹ `2000` `2001` `2002` `2003`  `2004`  `2005`   `2006`   `2007`
##    &lt;chr&gt;   &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
##  1 ABW     SP.URB… 4.24e4 4.30e4 4.37e4 4.42e4 4.47e+4 4.49e+4  4.49e+4  4.47e+4
##  2 ABW     SP.URB… 1.18e0 1.41e0 1.43e0 1.31e0 9.51e-1 4.91e-1 -1.78e-2 -4.35e-1
##  3 ABW     SP.POP… 9.09e4 9.29e4 9.50e4 9.70e4 9.87e+4 1.00e+5  1.01e+5  1.01e+5
##  4 ABW     SP.POP… 2.06e0 2.23e0 2.23e0 2.11e0 1.76e+0 1.30e+0  7.98e-1  3.84e-1
##  5 AFG     SP.URB… 4.44e6 4.65e6 4.89e6 5.16e6 5.43e+6 5.69e+6  5.93e+6  6.15e+6
##  6 AFG     SP.URB… 3.91e0 4.66e0 5.13e0 5.23e0 5.12e+0 4.77e+0  4.12e+0  3.65e+0
##  7 AFG     SP.POP… 2.01e7 2.10e7 2.20e7 2.31e7 2.41e+7 2.51e+7  2.59e+7  2.66e+7
##  8 AFG     SP.POP… 3.49e0 4.25e0 4.72e0 4.82e0 4.47e+0 3.87e+0  3.23e+0  2.76e+0
##  9 AGO     SP.URB… 8.23e6 8.71e6 9.22e6 9.77e6 1.03e+7 1.09e+7  1.15e+7  1.21e+7
## 10 AGO     SP.URB… 5.44e0 5.59e0 5.70e0 5.76e0 5.75e+0 5.69e+0  4.92e+0  4.89e+0
## # … with 1,046 more rows, 10 more variables: `2008` &lt;dbl&gt;, `2009` &lt;dbl&gt;,
## #   `2010` &lt;dbl&gt;, `2011` &lt;dbl&gt;, `2012` &lt;dbl&gt;, `2013` &lt;dbl&gt;, `2014` &lt;dbl&gt;,
## #   `2015` &lt;dbl&gt;, `2016` &lt;dbl&gt;, `2017` &lt;dbl&gt;, and abbreviated variable name
## #   ¹​indicator</code></pre>
<p>I want to start by looking at how many unique countries we actually
have here.</p>
<pre class="r"><code>length(unique(world_bank_pop$country)) #this gives us the number of unique values in the &quot;country&quot; column</code></pre>
<pre><code>## [1] 264</code></pre>
<p>You can see that there are way more “countries” here than there are
in the world. As of 2022, there are 193 countries in the United Nations,
though if we add soverign states that are not recognized by UN (e.g.,
Taiwan, Kosovo, etc.), the list is about 206… and there are more if we
include disputed territories.</p>
<p>The reason the World Bank data has even more than that is because
some of the “countries” include “aggregates” like “Arab World” or
“High-income Countries”.</p>
<p>Unfortunately, the <code>world_bank_pop</code> dataset does not
include any variables that allow us to differentiate the countries from
the aggregates!</p>
<p>So, here is where we are going to use the <em>countrycode</em>
package. The data in this package</p>
</div>
<div id="filtering-and-selecting-data-with-filter-and-select"
class="section level2">
<h2>3. Filtering and selecting data with <code>filter()</code> and
<code>select()</code></h2>
<p>As mentioned above (Section 1.1), each row is a country x indicator
combination, with 4 different indicators. The indicators are:</p>
<ul>
<li><p>SP.POP.GROW = population growth</p></li>
<li><p>SP.POP.TOTL = total population</p></li>
<li><p>SP.URB.GROW = urban population growth</p></li>
<li><p>SP.URB.TOTL = total urban population</p></li>
</ul>
</div>
<div
id="moving-between-wide--and-long-format-data-with-pivot_longer-and-pivot_wider"
class="section level2">
<h2>4. Moving between wide- and long-format data with
<code>pivot_longer()</code> and <code>pivot_wider()</code></h2>
</div>
<div id="dealing-with-complex-data" class="section level2">
<h2>Dealing with complex data</h2>
<p>World Bank Population Data up to 2017 (version included in tidyr
package):</p>
<pre class="r"><code>head(world_bank_pop)</code></pre>
<pre><code>## # A tibble: 6 × 20
##   country indica…¹ `2000` `2001` `2002` `2003`  `2004`  `2005`   `2006`   `2007`
##   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
## 1 ABW     SP.URB.… 4.24e4 4.30e4 4.37e4 4.42e4 4.47e+4 4.49e+4  4.49e+4  4.47e+4
## 2 ABW     SP.URB.… 1.18e0 1.41e0 1.43e0 1.31e0 9.51e-1 4.91e-1 -1.78e-2 -4.35e-1
## 3 ABW     SP.POP.… 9.09e4 9.29e4 9.50e4 9.70e4 9.87e+4 1.00e+5  1.01e+5  1.01e+5
## 4 ABW     SP.POP.… 2.06e0 2.23e0 2.23e0 2.11e0 1.76e+0 1.30e+0  7.98e-1  3.84e-1
## 5 AFG     SP.URB.… 4.44e6 4.65e6 4.89e6 5.16e6 5.43e+6 5.69e+6  5.93e+6  6.15e+6
## 6 AFG     SP.URB.… 3.91e0 4.66e0 5.13e0 5.23e0 5.12e+0 4.77e+0  4.12e+0  3.65e+0
## # … with 10 more variables: `2008` &lt;dbl&gt;, `2009` &lt;dbl&gt;, `2010` &lt;dbl&gt;,
## #   `2011` &lt;dbl&gt;, `2012` &lt;dbl&gt;, `2013` &lt;dbl&gt;, `2014` &lt;dbl&gt;, `2015` &lt;dbl&gt;,
## #   `2016` &lt;dbl&gt;, `2017` &lt;dbl&gt;, and abbreviated variable name ¹​indicator</code></pre>
<p>First, restrict the data to countries with large populations–let’s
say those above 75 percentile in population size over 2020-2017</p>
<pre class="r"><code>upper.pop=world_bank_pop %&gt;% dplyr::filter(indicator == &quot;SP.POP.TOTL&quot;) %&gt;% pull(`2017`) </code></pre>
<pre class="r"><code>#calculate average population size for all countries
upper.pop=world_bank_pop %&gt;% dplyr::filter(indicator == &quot;SP.POP.TOTL&quot;) %&gt;% pull(`2017`) %&gt;% quantile(., probs=0.9, na.rm=T)
upper.pop</code></pre>
<pre><code>##       90% 
## 890471085</code></pre>
<pre class="r"><code>upper.countries=world_bank_pop %&gt;% dplyr::filter(indicator == &quot;SP.POP.TOTL&quot;) %&gt;% dplyr::filter(`2017` &gt; upper.pop) %&gt;% select(country)</code></pre>
<p>Just get the population growth rate data using
<code>dplyr::filter()</code></p>
<pre class="r"><code>left_join(upper.countries, world_bank_pop) %&gt;% dplyr::filter(indicator==&quot;SP.POP.GROW&quot;)</code></pre>
<pre><code>## Joining, by = &quot;country&quot;</code></pre>
<pre><code>## # A tibble: 27 × 20
##    country indicator   `2000` `2001` `2002` `2003` `2004` `2005` `2006` `2007`
##    &lt;chr&gt;   &lt;chr&gt;        &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
##  1 CHN     SP.POP.GROW  0.788  0.726  0.670  0.623  0.594  0.588  0.558  0.522
##  2 EAP     SP.POP.GROW  0.994  0.940  0.891  0.849  0.819  0.805  0.775  0.741
##  3 EAR     SP.POP.GROW  1.82   1.77   1.73   1.69   1.66   1.63   1.61   1.59 
##  4 EAS     SP.POP.GROW  0.940  0.897  0.844  0.797  0.763  0.747  0.735  0.702
##  5 ECS     SP.POP.GROW  0.107  0.152  0.183  0.261  0.297  0.302  0.307  0.357
##  6 HIC     SP.POP.GROW  0.632  0.684  0.683  0.677  0.705  0.714  0.758  0.795
##  7 IBD     SP.POP.GROW  1.19   1.15   1.12   1.10   1.08   1.06   1.04   1.02 
##  8 IBT     SP.POP.GROW  1.45   1.43   1.40   1.38   1.37   1.36   1.34   1.32 
##  9 IDA     SP.POP.GROW  2.43   2.43   2.41   2.40   2.39   2.37   2.36   2.35 
## 10 IDX     SP.POP.GROW  2.50   2.50   2.50   2.49   2.46   2.43   2.40   2.37 
## # … with 17 more rows, and 10 more variables: `2008` &lt;dbl&gt;, `2009` &lt;dbl&gt;,
## #   `2010` &lt;dbl&gt;, `2011` &lt;dbl&gt;, `2012` &lt;dbl&gt;, `2013` &lt;dbl&gt;, `2014` &lt;dbl&gt;,
## #   `2015` &lt;dbl&gt;, `2016` &lt;dbl&gt;, `2017` &lt;dbl&gt;</code></pre>
<p>Convert this data to “long-format”</p>
<pre class="r"><code>left_join(upper.countries, world_bank_pop) %&gt;% dplyr::filter(indicator==&quot;SP.POP.GROW&quot;) %&gt;% pivot_longer(-c(country,indicator), names_to=&quot;year&quot;)</code></pre>
<pre><code>## Joining, by = &quot;country&quot;</code></pre>
<pre><code>## # A tibble: 486 × 4
##    country indicator   year  value
##    &lt;chr&gt;   &lt;chr&gt;       &lt;chr&gt; &lt;dbl&gt;
##  1 CHN     SP.POP.GROW 2000  0.788
##  2 CHN     SP.POP.GROW 2001  0.726
##  3 CHN     SP.POP.GROW 2002  0.670
##  4 CHN     SP.POP.GROW 2003  0.623
##  5 CHN     SP.POP.GROW 2004  0.594
##  6 CHN     SP.POP.GROW 2005  0.588
##  7 CHN     SP.POP.GROW 2006  0.558
##  8 CHN     SP.POP.GROW 2007  0.522
##  9 CHN     SP.POP.GROW 2008  0.512
## 10 CHN     SP.POP.GROW 2009  0.497
## # … with 476 more rows</code></pre>
<p>Clean up and save as an object</p>
<pre class="r"><code>df=left_join(upper.countries, world_bank_pop) %&gt;% dplyr::filter(indicator==&quot;SP.POP.GROW&quot;) %&gt;% pivot_longer(-c(country,indicator), names_to=&quot;year&quot;) %&gt;% select(-indicator) %&gt;% mutate(pop.growth=value, .keep=&quot;unused&quot;) %&gt;% mutate(year=as.numeric(year))</code></pre>
<pre><code>## Joining, by = &quot;country&quot;</code></pre>
<pre class="r"><code>df</code></pre>
<pre><code>## # A tibble: 486 × 3
##    country  year pop.growth
##    &lt;chr&gt;   &lt;dbl&gt;      &lt;dbl&gt;
##  1 CHN      2000      0.788
##  2 CHN      2001      0.726
##  3 CHN      2002      0.670
##  4 CHN      2003      0.623
##  5 CHN      2004      0.594
##  6 CHN      2005      0.588
##  7 CHN      2006      0.558
##  8 CHN      2007      0.522
##  9 CHN      2008      0.512
## 10 CHN      2009      0.497
## # … with 476 more rows</code></pre>
<pre class="r"><code>ggplot(df, aes(x=year, y=pop.growth, color=country)) +
  geom_line()</code></pre>
<p><img src="04.1.tidyverse_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<pre class="r"><code>pop=world_bank_pop %&gt;% pivot_longer(-c(country,indicator), names_to=&quot;year&quot;) %&gt;% mutate(year=as.numeric(year)) %&gt;% dplyr::filter(country==&quot;CAN&quot; | country==&quot;USA&quot; | country==&quot;MEX&quot;) %&gt;% dplyr::filter(indicator==&quot;SP.POP.GROW&quot;) %&gt;% mutate(pop.growth=value)


ggplot(pop, aes(x=year, y=pop.growth, color=country)) + 
  geom_line() +
  theme_classic() +
  geom_hline(aes(yintercept=1), linetype=2) +
  ylab(&quot;Population Growth Rate&quot;) +
  xlab(&quot;Year&quot;)</code></pre>
<p><img src="04.1.tidyverse_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<pre class="r"><code>d1=world_bank_pop %&gt;% dplyr::filter(indicator==&quot;SP.URB.TOTL&quot; | indicator==&quot;SP.POP.TOTL&quot;) %&gt;%
  select(country, indicator, `2017`) %&gt;%
  pivot_wider(., id_cols=country, names_from=indicator, values_from=`2017`)

ggplot(d1, aes(x=SP.POP.TOTL, y=SP.URB.TOTL)) +
  geom_point() +
  scale_x_continuous(trans=&quot;log&quot;) +
  scale_y_continuous(trans=&quot;log&quot;) +
  xlab(&quot;Total Population Size&quot;) +
  ylab(&quot;Urban Population Size&quot;) +
  theme_bw()</code></pre>
<pre><code>## Warning: Removed 4 rows containing missing values (geom_point).</code></pre>
<p><img src="04.1.tidyverse_files/figure-html/unnamed-chunk-20-2.png" width="672" /></p>
</div>
<div id="using-tidyr-to-reshape-data" class="section level2">
<h2>3. Using <code>tidyr</code> to reshape data</h2>
</div>
<div id="working-with-dplyr" class="section level2">
<h2>4. Working with <code>dplyr</code></h2>
<p><br></p>
<div id="main-dplyr-functions" class="section level3">
<h3>3.1 Main <code>dplyr</code> functions</h3>
<ul>
<li><code>select()</code> select columns by criteria</li>
<li><code>filter()</code> filter rows by criteria</li>
<li><code>mutate()</code>: add new variable using functions</li>
<li><code>summarise()</code>: calculate summary statistic for a given
variable</li>
<li><code>arrange()</code>: change order of rows</li>
<li><code>group_by()</code>: run any of above function ‘by group’
defined using criteria</li>
</ul>
<p><br></p>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3,h4",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
