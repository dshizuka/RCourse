<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Dai Shizuka" />


<title>Worked Example: Wrangling World Bank Population Data</title>

<script src="site_libs/header-attrs-2.16/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/sandstone.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Intro to R</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="syllabus.html">Syllabus</a>
</li>
<li>
  <a href="modules.html">Modules</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Worked Example: Wrangling World Bank
Population Data</h1>
<h4 class="author">Dai Shizuka</h4>
<h4 class="date">updated 09/15/22</h4>

</div>


<hr />
<div id="things-you-will-learn-in-this-worked-example"
class="section level4">
<h4>Things you will learn in this Worked Example</h4>
<ul>
<li><strong>Practice wrangling data with <em>dplyr</em> and
<em>tidyr</em> </strong></li>
<li><strong>Learn tricks to download data from public data repositories
like the World Bank</strong></li>
<li><strong>More practice with ggplot</strong></li>
<li><strong>A little bit of stats</strong></li>
</ul>
<p>We will accomplish these while exploring the (admittedly superficial)
patterns in population growth rates across countries.</p>
<p><strong>By the end, you’ll be able to produce graphs like
this:</strong></p>
<p><img src="Ex_WorldBank_files/figure-html/average_growth_by_income-1.png" width="50%" /><img src="Ex_WorldBank_files/figure-html/growth_income_by_region-1.png" width="50%" /></p>
<p><br></p>
<hr />
</div>
<div id="set-up-load-packages" class="section level2">
<h2>Set up: load packages</h2>
<pre class="r"><code>library(wbstats)
library(tidyverse)</code></pre>
<hr />
</div>
<div id="the-data-population-growth-trends-across-the-world"
class="section level2">
<h2>1. The Data: Population growth trends across the world</h2>
<p>The World Bank actually makes it very easy to download a huge amount
of data very easily. You could just go to the <a
href="https://data.worldbank.org/">World Bankd Open Data site</a> and
search for data and download them in a few clicks. There are even
packages such as <code>WDI</code> and <code>wbstats</code> that allow
you to query and pull data from this site from within R.</p>
<p>However, for the purposes of this exercise, we will deal with several
datasets that are included in the packages we have loaded above.</p>
<p><br></p>
<div id="world_bank_pop-population-data-from-world-bank-2000-2017"
class="section level3">
<h3><code>world_bank_pop</code>: Population data from World Bank
(2000-2017)</h3>
<p>First is the <code>world_bank_pop</code> dataset that is included in
the <code>tidyr</code> package (which is part of the the tidyverse
suite). Start by pulling up the help file for the dataset</p>
<pre class="r"><code>?world_bank_pop</code></pre>
<p>Let’s take a peak at the data, which is in “tibble” format:</p>
<pre class="r"><code>world_bank_pop</code></pre>
<pre><code>## # A tibble: 1,056 × 20
##    country indic…¹ `2000` `2001` `2002` `2003`  `2004`  `2005`   `2006`   `2007`
##    &lt;chr&gt;   &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
##  1 ABW     SP.URB… 4.24e4 4.30e4 4.37e4 4.42e4 4.47e+4 4.49e+4  4.49e+4  4.47e+4
##  2 ABW     SP.URB… 1.18e0 1.41e0 1.43e0 1.31e0 9.51e-1 4.91e-1 -1.78e-2 -4.35e-1
##  3 ABW     SP.POP… 9.09e4 9.29e4 9.50e4 9.70e4 9.87e+4 1.00e+5  1.01e+5  1.01e+5
##  4 ABW     SP.POP… 2.06e0 2.23e0 2.23e0 2.11e0 1.76e+0 1.30e+0  7.98e-1  3.84e-1
##  5 AFG     SP.URB… 4.44e6 4.65e6 4.89e6 5.16e6 5.43e+6 5.69e+6  5.93e+6  6.15e+6
##  6 AFG     SP.URB… 3.91e0 4.66e0 5.13e0 5.23e0 5.12e+0 4.77e+0  4.12e+0  3.65e+0
##  7 AFG     SP.POP… 2.01e7 2.10e7 2.20e7 2.31e7 2.41e+7 2.51e+7  2.59e+7  2.66e+7
##  8 AFG     SP.POP… 3.49e0 4.25e0 4.72e0 4.82e0 4.47e+0 3.87e+0  3.23e+0  2.76e+0
##  9 AGO     SP.URB… 8.23e6 8.71e6 9.22e6 9.77e6 1.03e+7 1.09e+7  1.15e+7  1.21e+7
## 10 AGO     SP.URB… 5.44e0 5.59e0 5.70e0 5.76e0 5.75e+0 5.69e+0  4.92e+0  4.89e+0
## # … with 1,046 more rows, 10 more variables: `2008` &lt;dbl&gt;, `2009` &lt;dbl&gt;,
## #   `2010` &lt;dbl&gt;, `2011` &lt;dbl&gt;, `2012` &lt;dbl&gt;, `2013` &lt;dbl&gt;, `2014` &lt;dbl&gt;,
## #   `2015` &lt;dbl&gt;, `2016` &lt;dbl&gt;, `2017` &lt;dbl&gt;, and abbreviated variable name
## #   ¹​indicator</code></pre>
<p>Notice that each country is repeated across 4 rows. This is because
there are actually 4 different “indicators” for each country, and so
each country x indicator combination takes up a row. The rest of the
columns are years, from 2000 to 2017.</p>
<p>Also notice that the numbers in the column names have a backquote, or
“`” around them. In R, this allows numbers to be interpreted as text
(and column names have to be text).</p>
<p>So, if you wanted to pull up the “2001” column, this will NOT
work…</p>
<pre class="r"><code>world_bank_pop$2001</code></pre>
<p>…but this will work</p>
<pre class="r"><code>world_bank_pop$`2001`</code></pre>
<p><br></p>
<hr />
</div>
</div>
<div id="exclude-aggregate-data-to-get-data-for-countries-only"
class="section level2">
<h2>2. Exclude aggregate data to get data for countries only</h2>
<p>We are going to start by diving into the <code>world_bank_pop</code>
dataset.</p>
<p>Let’s take a peek at the dataset again and see what we have…</p>
<pre class="r"><code>world_bank_pop</code></pre>
<pre><code>## # A tibble: 1,056 × 20
##    country indic…¹ `2000` `2001` `2002` `2003`  `2004`  `2005`   `2006`   `2007`
##    &lt;chr&gt;   &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
##  1 ABW     SP.URB… 4.24e4 4.30e4 4.37e4 4.42e4 4.47e+4 4.49e+4  4.49e+4  4.47e+4
##  2 ABW     SP.URB… 1.18e0 1.41e0 1.43e0 1.31e0 9.51e-1 4.91e-1 -1.78e-2 -4.35e-1
##  3 ABW     SP.POP… 9.09e4 9.29e4 9.50e4 9.70e4 9.87e+4 1.00e+5  1.01e+5  1.01e+5
##  4 ABW     SP.POP… 2.06e0 2.23e0 2.23e0 2.11e0 1.76e+0 1.30e+0  7.98e-1  3.84e-1
##  5 AFG     SP.URB… 4.44e6 4.65e6 4.89e6 5.16e6 5.43e+6 5.69e+6  5.93e+6  6.15e+6
##  6 AFG     SP.URB… 3.91e0 4.66e0 5.13e0 5.23e0 5.12e+0 4.77e+0  4.12e+0  3.65e+0
##  7 AFG     SP.POP… 2.01e7 2.10e7 2.20e7 2.31e7 2.41e+7 2.51e+7  2.59e+7  2.66e+7
##  8 AFG     SP.POP… 3.49e0 4.25e0 4.72e0 4.82e0 4.47e+0 3.87e+0  3.23e+0  2.76e+0
##  9 AGO     SP.URB… 8.23e6 8.71e6 9.22e6 9.77e6 1.03e+7 1.09e+7  1.15e+7  1.21e+7
## 10 AGO     SP.URB… 5.44e0 5.59e0 5.70e0 5.76e0 5.75e+0 5.69e+0  4.92e+0  4.89e+0
## # … with 1,046 more rows, 10 more variables: `2008` &lt;dbl&gt;, `2009` &lt;dbl&gt;,
## #   `2010` &lt;dbl&gt;, `2011` &lt;dbl&gt;, `2012` &lt;dbl&gt;, `2013` &lt;dbl&gt;, `2014` &lt;dbl&gt;,
## #   `2015` &lt;dbl&gt;, `2016` &lt;dbl&gt;, `2017` &lt;dbl&gt;, and abbreviated variable name
## #   ¹​indicator</code></pre>
<p>I want to start by looking at how many unique countries we actually
have here.</p>
<pre class="r"><code>length(unique(world_bank_pop$country)) #this gives us the number of unique values in the &quot;country&quot; column</code></pre>
<pre><code>## [1] 264</code></pre>
<p>You can see that there are way more “countries” here than there are
in the world. As of 2022, there are 193 countries in the United Nations,
though if we add soverign states that are not recognized by UN (e.g.,
Taiwan, Kosovo, etc.), the list is about 206… and there are more if we
include disputed territories.</p>
<p><strong>The reason the World Bank data has even more than that is
because some of the “countries” include “aggregates” like “Arab World”
or “High-income Countries”. </strong></p>
<p>Unfortunately, the <code>world_bank_pop</code> dataset does not
include any variables that allow us to differentiate the countries from
the aggregates! <strong>However</strong>, we can solve this problem by
pulling the metadata for countries from the World Bank. We can do this
by using the <code>wb_countries()</code> function from the
<em>wbstats</em> package.</p>
<p>Let’s pull the country metadata and save it as an object called
“metadata”:</p>
<pre class="r"><code>metadata=wb_countries()</code></pre>
<pre class="r"><code>metadata</code></pre>
<pre><code>## # A tibble: 299 × 18
##    iso3c iso2c country    capit…¹ longi…² latit…³ regio…⁴ regio…⁵ region admin…⁶
##    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;  
##  1 ABW   AW    Aruba      Oranje…  -70.0    12.5  LCN     ZJ      Latin… &lt;NA&gt;   
##  2 AFE   ZH    Africa Ea… &lt;NA&gt;      NA      NA    &lt;NA&gt;    &lt;NA&gt;    Aggre… &lt;NA&gt;   
##  3 AFG   AF    Afghanist… Kabul     69.2    34.5  SAS     8S      South… SAS    
##  4 AFR   A9    Africa     &lt;NA&gt;      NA      NA    &lt;NA&gt;    &lt;NA&gt;    Aggre… &lt;NA&gt;   
##  5 AFW   ZI    Africa We… &lt;NA&gt;      NA      NA    &lt;NA&gt;    &lt;NA&gt;    Aggre… &lt;NA&gt;   
##  6 AGO   AO    Angola     Luanda    13.2    -8.81 SSF     ZG      Sub-S… SSA    
##  7 ALB   AL    Albania    Tirane    19.8    41.3  ECS     Z7      Europ… ECA    
##  8 AND   AD    Andorra    Andorr…    1.52   42.5  ECS     Z7      Europ… &lt;NA&gt;   
##  9 ARB   1A    Arab World &lt;NA&gt;      NA      NA    &lt;NA&gt;    &lt;NA&gt;    Aggre… &lt;NA&gt;   
## 10 ARE   AE    United Ar… Abu Dh…   54.4    24.5  MEA     ZQ      Middl… &lt;NA&gt;   
## # … with 289 more rows, 8 more variables: admin_region_iso2c &lt;chr&gt;,
## #   admin_region &lt;chr&gt;, income_level_iso3c &lt;chr&gt;, income_level_iso2c &lt;chr&gt;,
## #   income_level &lt;chr&gt;, lending_type_iso3c &lt;chr&gt;, lending_type_iso2c &lt;chr&gt;,
## #   lending_type &lt;chr&gt;, and abbreviated variable names ¹​capital_city,
## #   ²​longitude, ³​latitude, ⁴​region_iso3c, ⁵​region_iso2c, ⁶​admin_region_iso3c</code></pre>
<pre class="r"><code>head(metadata$region)</code></pre>
<pre><code>## [1] &quot;Latin America &amp; Caribbean&quot; &quot;Aggregates&quot;               
## [3] &quot;South Asia&quot;                &quot;Aggregates&quot;               
## [5] &quot;Aggregates&quot;                &quot;Sub-Saharan Africa&quot;</code></pre>
<p>So this column shows us the “Aggregates”.</p>
<p>So, we can use this to filter the metadata to exclude the Aggregate
codes.</p>
<pre class="r"><code>metadata %&gt;% dplyr::filter(region != &quot;Aggregates&quot;)</code></pre>
<pre><code>## # A tibble: 218 × 18
##    iso3c iso2c country    capit…¹ longi…² latit…³ regio…⁴ regio…⁵ region admin…⁶
##    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;  
##  1 ABW   AW    Aruba      Oranje…  -70.0    12.5  LCN     ZJ      Latin… &lt;NA&gt;   
##  2 AFG   AF    Afghanist… Kabul     69.2    34.5  SAS     8S      South… SAS    
##  3 AGO   AO    Angola     Luanda    13.2    -8.81 SSF     ZG      Sub-S… SSA    
##  4 ALB   AL    Albania    Tirane    19.8    41.3  ECS     Z7      Europ… ECA    
##  5 AND   AD    Andorra    Andorr…    1.52   42.5  ECS     Z7      Europ… &lt;NA&gt;   
##  6 ARE   AE    United Ar… Abu Dh…   54.4    24.5  MEA     ZQ      Middl… &lt;NA&gt;   
##  7 ARG   AR    Argentina  Buenos…  -58.4   -34.6  LCN     ZJ      Latin… LAC    
##  8 ARM   AM    Armenia    Yerevan   44.5    40.2  ECS     Z7      Europ… ECA    
##  9 ASM   AS    American … Pago P… -171.    -14.3  EAS     Z4      East … EAP    
## 10 ATG   AG    Antigua a… Saint …  -61.8    17.1  LCN     ZJ      Latin… &lt;NA&gt;   
## # … with 208 more rows, 8 more variables: admin_region_iso2c &lt;chr&gt;,
## #   admin_region &lt;chr&gt;, income_level_iso3c &lt;chr&gt;, income_level_iso2c &lt;chr&gt;,
## #   income_level &lt;chr&gt;, lending_type_iso3c &lt;chr&gt;, lending_type_iso2c &lt;chr&gt;,
## #   lending_type &lt;chr&gt;, and abbreviated variable names ¹​capital_city,
## #   ²​longitude, ³​latitude, ⁴​region_iso3c, ⁵​region_iso2c, ⁶​admin_region_iso3c</code></pre>
<p>Let’s also pare down the data to a few variables we might be
interested in, including region and income level:</p>
<pre class="r"><code>metadata %&gt;% 
  dplyr::filter(region != &quot;Aggregates&quot;) %&gt;%
  select(iso3c, iso2c, country, region, income_level)</code></pre>
<pre><code>## # A tibble: 218 × 5
##    iso3c iso2c country              region                     income_level     
##    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;                &lt;chr&gt;                      &lt;chr&gt;            
##  1 ABW   AW    Aruba                Latin America &amp; Caribbean  High income      
##  2 AFG   AF    Afghanistan          South Asia                 Low income       
##  3 AGO   AO    Angola               Sub-Saharan Africa         Lower middle inc…
##  4 ALB   AL    Albania              Europe &amp; Central Asia      Upper middle inc…
##  5 AND   AD    Andorra              Europe &amp; Central Asia      High income      
##  6 ARE   AE    United Arab Emirates Middle East &amp; North Africa High income      
##  7 ARG   AR    Argentina            Latin America &amp; Caribbean  Upper middle inc…
##  8 ARM   AM    Armenia              Europe &amp; Central Asia      Upper middle inc…
##  9 ASM   AS    American Samoa       East Asia &amp; Pacific        Upper middle inc…
## 10 ATG   AG    Antigua and Barbuda  Latin America &amp; Caribbean  High income      
## # … with 208 more rows</code></pre>
<p>Ok, this looks useful. Let’s save it as a data table called
<code>countries</code></p>
<pre class="r"><code>countries=metadata %&gt;% 
  dplyr::filter(region != &quot;Aggregates&quot;) %&gt;%
  select(iso3c, iso2c, country.name=country, region, income_level) %&gt;%
  mutate(income_level=factor(income_level, levels=c(&quot;Low income&quot;, &quot;Lower middle income&quot;, &quot;Upper middle income&quot;, &quot;High income&quot;)))</code></pre>
<p>Now, we are going to use the <code>inner_join()</code> function to
make a version of the world bank population data that is only for actual
countries (not aggregates):</p>
<pre class="r"><code>inner_join(world_bank_pop, countries, by=c(&quot;country&quot; = &quot;iso3c&quot;))</code></pre>
<pre><code>## # A tibble: 868 × 24
##    country indic…¹ `2000` `2001` `2002` `2003`  `2004`  `2005`   `2006`   `2007`
##    &lt;chr&gt;   &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
##  1 ABW     SP.URB… 4.24e4 4.30e4 4.37e4 4.42e4 4.47e+4 4.49e+4  4.49e+4  4.47e+4
##  2 ABW     SP.URB… 1.18e0 1.41e0 1.43e0 1.31e0 9.51e-1 4.91e-1 -1.78e-2 -4.35e-1
##  3 ABW     SP.POP… 9.09e4 9.29e4 9.50e4 9.70e4 9.87e+4 1.00e+5  1.01e+5  1.01e+5
##  4 ABW     SP.POP… 2.06e0 2.23e0 2.23e0 2.11e0 1.76e+0 1.30e+0  7.98e-1  3.84e-1
##  5 AFG     SP.URB… 4.44e6 4.65e6 4.89e6 5.16e6 5.43e+6 5.69e+6  5.93e+6  6.15e+6
##  6 AFG     SP.URB… 3.91e0 4.66e0 5.13e0 5.23e0 5.12e+0 4.77e+0  4.12e+0  3.65e+0
##  7 AFG     SP.POP… 2.01e7 2.10e7 2.20e7 2.31e7 2.41e+7 2.51e+7  2.59e+7  2.66e+7
##  8 AFG     SP.POP… 3.49e0 4.25e0 4.72e0 4.82e0 4.47e+0 3.87e+0  3.23e+0  2.76e+0
##  9 AGO     SP.URB… 8.23e6 8.71e6 9.22e6 9.77e6 1.03e+7 1.09e+7  1.15e+7  1.21e+7
## 10 AGO     SP.URB… 5.44e0 5.59e0 5.70e0 5.76e0 5.75e+0 5.69e+0  4.92e+0  4.89e+0
## # … with 858 more rows, 14 more variables: `2008` &lt;dbl&gt;, `2009` &lt;dbl&gt;,
## #   `2010` &lt;dbl&gt;, `2011` &lt;dbl&gt;, `2012` &lt;dbl&gt;, `2013` &lt;dbl&gt;, `2014` &lt;dbl&gt;,
## #   `2015` &lt;dbl&gt;, `2016` &lt;dbl&gt;, `2017` &lt;dbl&gt;, iso2c &lt;chr&gt;, country.name &lt;chr&gt;,
## #   region &lt;chr&gt;, income_level &lt;fct&gt;, and abbreviated variable name ¹​indicator</code></pre>
<p>You can see that the <code>inner_join()</code> function worked if you
scroll all the way to the right of the output table.</p>
<p>Let’s rearrange the order of the columns using
<code>relocate()</code> so that we can have all the useful metadata
appear first (left-most):</p>
<pre class="r"><code>inner_join(world_bank_pop, countries, by=c(&quot;country&quot; = &quot;iso3c&quot;)) %&gt;%
  relocate(country, iso2c, country.name, region, income_level)</code></pre>
<pre><code>## # A tibble: 868 × 24
##    country iso2c country.name region incom…¹ indic…² `2000` `2001` `2002` `2003`
##    &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;        &lt;chr&gt;  &lt;fct&gt;   &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
##  1 ABW     AW    Aruba        Latin… High i… SP.URB… 4.24e4 4.30e4 4.37e4 4.42e4
##  2 ABW     AW    Aruba        Latin… High i… SP.URB… 1.18e0 1.41e0 1.43e0 1.31e0
##  3 ABW     AW    Aruba        Latin… High i… SP.POP… 9.09e4 9.29e4 9.50e4 9.70e4
##  4 ABW     AW    Aruba        Latin… High i… SP.POP… 2.06e0 2.23e0 2.23e0 2.11e0
##  5 AFG     AF    Afghanistan  South… Low in… SP.URB… 4.44e6 4.65e6 4.89e6 5.16e6
##  6 AFG     AF    Afghanistan  South… Low in… SP.URB… 3.91e0 4.66e0 5.13e0 5.23e0
##  7 AFG     AF    Afghanistan  South… Low in… SP.POP… 2.01e7 2.10e7 2.20e7 2.31e7
##  8 AFG     AF    Afghanistan  South… Low in… SP.POP… 3.49e0 4.25e0 4.72e0 4.82e0
##  9 AGO     AO    Angola       Sub-S… Lower … SP.URB… 8.23e6 8.71e6 9.22e6 9.77e6
## 10 AGO     AO    Angola       Sub-S… Lower … SP.URB… 5.44e0 5.59e0 5.70e0 5.76e0
## # … with 858 more rows, 14 more variables: `2004` &lt;dbl&gt;, `2005` &lt;dbl&gt;,
## #   `2006` &lt;dbl&gt;, `2007` &lt;dbl&gt;, `2008` &lt;dbl&gt;, `2009` &lt;dbl&gt;, `2010` &lt;dbl&gt;,
## #   `2011` &lt;dbl&gt;, `2012` &lt;dbl&gt;, `2013` &lt;dbl&gt;, `2014` &lt;dbl&gt;, `2015` &lt;dbl&gt;,
## #   `2016` &lt;dbl&gt;, `2017` &lt;dbl&gt;, and abbreviated variable names ¹​income_level,
## #   ²​indicator</code></pre>
<p>This looks good. Let’s save it as an object we’ll call
<code>popdat_countries</code></p>
<pre class="r"><code>popdat_countries=inner_join(world_bank_pop, countries, by=c(&quot;country&quot; = &quot;iso3c&quot;)) %&gt;%
  relocate(country, iso2c, country.name, region, income_level)

popdat_countries</code></pre>
<pre><code>## # A tibble: 868 × 24
##    country iso2c country.name region incom…¹ indic…² `2000` `2001` `2002` `2003`
##    &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;        &lt;chr&gt;  &lt;fct&gt;   &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
##  1 ABW     AW    Aruba        Latin… High i… SP.URB… 4.24e4 4.30e4 4.37e4 4.42e4
##  2 ABW     AW    Aruba        Latin… High i… SP.URB… 1.18e0 1.41e0 1.43e0 1.31e0
##  3 ABW     AW    Aruba        Latin… High i… SP.POP… 9.09e4 9.29e4 9.50e4 9.70e4
##  4 ABW     AW    Aruba        Latin… High i… SP.POP… 2.06e0 2.23e0 2.23e0 2.11e0
##  5 AFG     AF    Afghanistan  South… Low in… SP.URB… 4.44e6 4.65e6 4.89e6 5.16e6
##  6 AFG     AF    Afghanistan  South… Low in… SP.URB… 3.91e0 4.66e0 5.13e0 5.23e0
##  7 AFG     AF    Afghanistan  South… Low in… SP.POP… 2.01e7 2.10e7 2.20e7 2.31e7
##  8 AFG     AF    Afghanistan  South… Low in… SP.POP… 3.49e0 4.25e0 4.72e0 4.82e0
##  9 AGO     AO    Angola       Sub-S… Lower … SP.URB… 8.23e6 8.71e6 9.22e6 9.77e6
## 10 AGO     AO    Angola       Sub-S… Lower … SP.URB… 5.44e0 5.59e0 5.70e0 5.76e0
## # … with 858 more rows, 14 more variables: `2004` &lt;dbl&gt;, `2005` &lt;dbl&gt;,
## #   `2006` &lt;dbl&gt;, `2007` &lt;dbl&gt;, `2008` &lt;dbl&gt;, `2009` &lt;dbl&gt;, `2010` &lt;dbl&gt;,
## #   `2011` &lt;dbl&gt;, `2012` &lt;dbl&gt;, `2013` &lt;dbl&gt;, `2014` &lt;dbl&gt;, `2015` &lt;dbl&gt;,
## #   `2016` &lt;dbl&gt;, `2017` &lt;dbl&gt;, and abbreviated variable names ¹​income_level,
## #   ²​indicator</code></pre>
<p><br></p>
<hr />
</div>
<div id="which-are-the-worlds-largest-countries-in-2017"
class="section level2">
<h2>3. Which are the world’s largest countries (in 2017)?</h2>
<p>As mentioned at the beginning, each row of data here is a country x
indicator combination, with 4 different indicators. The indicators
are:</p>
<ul>
<li><p>SP.POP.GROW = population growth</p></li>
<li><p>SP.POP.TOTL = total population</p></li>
<li><p>SP.URB.GROW = urban population growth</p></li>
<li><p>SP.URB.TOTL = total urban population</p></li>
</ul>
<p>So, we will create a data table called <code>pop_totals</code> that
is just the “total population” data.</p>
<pre class="r"><code>pop_totals=popdat_countries %&gt;% 
  dplyr::filter(indicator==&quot;SP.POP.TOTL&quot;) 

pop_totals</code></pre>
<pre><code>## # A tibble: 217 × 24
##    country iso2c country.name region incom…¹ indic…² `2000` `2001` `2002` `2003`
##    &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;        &lt;chr&gt;  &lt;fct&gt;   &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
##  1 ABW     AW    Aruba        Latin… High i… SP.POP… 9.09e4 9.29e4 9.50e4 9.70e4
##  2 AFG     AF    Afghanistan  South… Low in… SP.POP… 2.01e7 2.10e7 2.20e7 2.31e7
##  3 AGO     AO    Angola       Sub-S… Lower … SP.POP… 1.64e7 1.70e7 1.76e7 1.82e7
##  4 ALB     AL    Albania      Europ… Upper … SP.POP… 3.09e6 3.06e6 3.05e6 3.04e6
##  5 AND     AD    Andorra      Europ… High i… SP.POP… 6.54e4 6.73e4 7.00e4 7.32e4
##  6 ARE     AE    United Arab… Middl… High i… SP.POP… 3.15e6 3.33e6 3.51e6 3.74e6
##  7 ARG     AR    Argentina    Latin… Upper … SP.POP… 3.71e7 3.75e7 3.79e7 3.83e7
##  8 ARM     AM    Armenia      Europ… Upper … SP.POP… 3.07e6 3.05e6 3.03e6 3.02e6
##  9 ASM     AS    American Sa… East … Upper … SP.POP… 5.75e4 5.82e4 5.87e4 5.91e4
## 10 ATG     AG    Antigua and… Latin… High i… SP.POP… 8.36e4 8.51e4 8.63e4 8.73e4
## # … with 207 more rows, 14 more variables: `2004` &lt;dbl&gt;, `2005` &lt;dbl&gt;,
## #   `2006` &lt;dbl&gt;, `2007` &lt;dbl&gt;, `2008` &lt;dbl&gt;, `2009` &lt;dbl&gt;, `2010` &lt;dbl&gt;,
## #   `2011` &lt;dbl&gt;, `2012` &lt;dbl&gt;, `2013` &lt;dbl&gt;, `2014` &lt;dbl&gt;, `2015` &lt;dbl&gt;,
## #   `2016` &lt;dbl&gt;, `2017` &lt;dbl&gt;, and abbreviated variable names ¹​income_level,
## #   ²​indicator</code></pre>
<p>From this population size data, let’s figure out what is the 90th
percentile in population size in 2017. We are going to get this number
by doing <code>pull()</code> to get the 2017 population sizes as a
vector, and use <code>quantile()</code> to get the 90th percentile. Save
that value as <code>upper_pop</code>.</p>
<pre class="r"><code>upper_pop=pop_totals %&gt;%
  pull(`2017`) %&gt;% 
  quantile(., probs=0.90, na.rm=T) # this allows us to find the value at Nth percentile

upper_pop</code></pre>
<pre><code>##      90% 
## 63286844</code></pre>
<p>So, the 90th percentile of population sizes in 2017 is 63,286,844</p>
<p>Now, we can use this 90th percentile value to filter the population
size data to just the largest (&gt;= 90th percentile) countries. We will
create a one-column tibble called <code>large_countries()</code> to save
this list of country codes.</p>
<pre class="r"><code>pop_totals %&gt;% 
  dplyr::filter(`2017` &gt; upper_pop) </code></pre>
<pre><code>## # A tibble: 22 × 24
##    country iso2c country.name region incom…¹ indic…² `2000` `2001` `2002` `2003`
##    &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;        &lt;chr&gt;  &lt;fct&gt;   &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
##  1 BGD     BD    Bangladesh   South… Lower … SP.POP… 1.32e8 1.34e8 1.37e8 1.39e8
##  2 BRA     BR    Brazil       Latin… Upper … SP.POP… 1.75e8 1.78e8 1.80e8 1.82e8
##  3 CHN     CN    China        East … Upper … SP.POP… 1.26e9 1.27e9 1.28e9 1.29e9
##  4 COD     CD    Congo, Dem.… Sub-S… Low in… SP.POP… 4.71e7 4.84e7 4.98e7 5.14e7
##  5 DEU     DE    Germany      Europ… High i… SP.POP… 8.22e7 8.23e7 8.25e7 8.25e7
##  6 EGY     EG    Egypt, Arab… Middl… Lower … SP.POP… 6.99e7 7.12e7 7.26e7 7.40e7
##  7 ETH     ET    Ethiopia     Sub-S… Low in… SP.POP… 6.65e7 6.85e7 7.05e7 7.25e7
##  8 FRA     FR    France       Europ… High i… SP.POP… 6.09e7 6.14e7 6.18e7 6.22e7
##  9 GBR     GB    United King… Europ… High i… SP.POP… 5.89e7 5.91e7 5.94e7 5.96e7
## 10 IDN     ID    Indonesia    East … Lower … SP.POP… 2.12e8 2.15e8 2.18e8 2.21e8
## # … with 12 more rows, 14 more variables: `2004` &lt;dbl&gt;, `2005` &lt;dbl&gt;,
## #   `2006` &lt;dbl&gt;, `2007` &lt;dbl&gt;, `2008` &lt;dbl&gt;, `2009` &lt;dbl&gt;, `2010` &lt;dbl&gt;,
## #   `2011` &lt;dbl&gt;, `2012` &lt;dbl&gt;, `2013` &lt;dbl&gt;, `2014` &lt;dbl&gt;, `2015` &lt;dbl&gt;,
## #   `2016` &lt;dbl&gt;, `2017` &lt;dbl&gt;, and abbreviated variable names ¹​income_level,
## #   ²​indicator</code></pre>
<p>Ok, now let’s select just the country code, country name and
population size of the world’s largest countries (90th percentile) and
arrange it in descending order using <code>arrange()</code></p>
<pre class="r"><code>largest_countries=pop_totals %&gt;% 
  dplyr::filter(`2017` &gt; upper_pop) %&gt;% 
  select(country, country.name, `2017`) %&gt;%
  arrange(desc(`2017`))

print(largest_countries, n=22)</code></pre>
<pre><code>## # A tibble: 22 × 3
##    country country.name           `2017`
##    &lt;chr&gt;   &lt;chr&gt;                   &lt;dbl&gt;
##  1 CHN     China              1386395000
##  2 IND     India              1339180127
##  3 USA     United States       325719178
##  4 IDN     Indonesia           263991379
##  5 BRA     Brazil              209288278
##  6 PAK     Pakistan            197015955
##  7 NGA     Nigeria             190886311
##  8 BGD     Bangladesh          164669751
##  9 RUS     Russian Federation  144495044
## 10 MEX     Mexico              129163276
## 11 JPN     Japan               126785797
## 12 ETH     Ethiopia            104957438
## 13 PHL     Philippines         104918090
## 14 EGY     Egypt, Arab Rep.     97553151
## 15 VNM     Vietnam              95540800
## 16 DEU     Germany              82695000
## 17 COD     Congo, Dem. Rep.     81339988
## 18 IRN     Iran, Islamic Rep.   81162788
## 19 TUR     Turkiye              80745020
## 20 THA     Thailand             69037513
## 21 FRA     France               67118648
## 22 GBR     United Kingdom       66022273</code></pre>
<p><br></p>
<hr />
</div>
<div
id="how-population-growth-rates-have-changed-across-years-by-income-level-of-countries"
class="section level2">
<h2>4. How population growth rates have changed across years, by income
level of countries</h2>
<p>Now, let’s create a tibble that contains the population growth data
as well as the income level designation for each country.</p>
<p>I’m also going to remove countries for which we are missing data
using <code>drop_na()</code>.</p>
<pre class="r"><code>popdat_countries %&gt;% 
  dplyr::filter(indicator==&quot;SP.POP.GROW&quot;)  %&gt;%
  drop_na()</code></pre>
<pre><code>## # A tibble: 214 × 24
##    country iso2c country.name region incom…¹ indic…² `2000` `2001` `2002` `2003`
##    &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;        &lt;chr&gt;  &lt;fct&gt;   &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
##  1 ABW     AW    Aruba        Latin… High i… SP.POP…  2.06   2.23   2.23   2.11 
##  2 AFG     AF    Afghanistan  South… Low in… SP.POP…  3.49   4.25   4.72   4.82 
##  3 AGO     AO    Angola       Sub-S… Lower … SP.POP…  3.03   3.25   3.41   3.53 
##  4 ALB     AL    Albania      Europ… Upper … SP.POP… -0.637 -0.938 -0.300 -0.374
##  5 AND     AD    Andorra      Europ… High i… SP.POP…  1.57   2.94   3.94   4.38 
##  6 ARE     AE    United Arab… Middl… High i… SP.POP…  5.43   5.28   5.30   6.48 
##  7 ARG     AR    Argentina    Latin… Upper … SP.POP…  1.11   1.11   1.11   1.10 
##  8 ARM     AM    Armenia      Europ… Upper … SP.POP… -0.631 -0.619 -0.551 -0.532
##  9 ASM     AS    American Sa… East … Upper … SP.POP…  1.31   1.13   0.951  0.655
## 10 ATG     AG    Antigua and… Latin… High i… SP.POP…  2.12   1.75   1.41   1.18 
## # … with 204 more rows, 14 more variables: `2004` &lt;dbl&gt;, `2005` &lt;dbl&gt;,
## #   `2006` &lt;dbl&gt;, `2007` &lt;dbl&gt;, `2008` &lt;dbl&gt;, `2009` &lt;dbl&gt;, `2010` &lt;dbl&gt;,
## #   `2011` &lt;dbl&gt;, `2012` &lt;dbl&gt;, `2013` &lt;dbl&gt;, `2014` &lt;dbl&gt;, `2015` &lt;dbl&gt;,
## #   `2016` &lt;dbl&gt;, `2017` &lt;dbl&gt;, and abbreviated variable names ¹​income_level,
## #   ²​indicator</code></pre>
<p>Now, we are going to <strong>reshape this data into
long-format</strong>.</p>
<p>To do this, I’m going to first pare down by removing columns we don’t
need. I’m going to keep “country” because I want the value for each
country for each year. I’m also going to keep “income_level” because I’m
going to use that to summarise the population growth data later. Then,
I’m going to use the <code>pivot_longer()</code> function to rearrange
all of the columns with years as the heading into two columns: one
column with the year, and one column with the population growth
rate.</p>
<pre class="r"><code>popdat_countries %&gt;% 
  dplyr::filter(indicator==&quot;SP.POP.GROW&quot;) %&gt;%
  drop_na() %&gt;%
  select(-indicator, -country.name, -iso2c, -region) %&gt;% #pare down the data a bit &amp; pivot longer
  pivot_longer(cols=-c(country, income_level), names_to=&quot;year&quot;, values_to=&quot;growth_rate&quot;)</code></pre>
<pre><code>## # A tibble: 3,852 × 4
##    country income_level year  growth_rate
##    &lt;chr&gt;   &lt;fct&gt;        &lt;chr&gt;       &lt;dbl&gt;
##  1 ABW     High income  2000       2.06  
##  2 ABW     High income  2001       2.23  
##  3 ABW     High income  2002       2.23  
##  4 ABW     High income  2003       2.11  
##  5 ABW     High income  2004       1.76  
##  6 ABW     High income  2005       1.30  
##  7 ABW     High income  2006       0.798 
##  8 ABW     High income  2007       0.384 
##  9 ABW     High income  2008       0.131 
## 10 ABW     High income  2009       0.0986
## # … with 3,842 more rows</code></pre>
<p>Ok, now that we have the data in long format, it is easier to
summarize the annual population growth rates across all years by income
level.</p>
<p>To do this, I’m going to <code>group_by()</code> income level, and
then summarize the data using a nifty <code>mean_se()</code> function,
which gives me the mean AND the mean +/- standard error. This is a nice
function to get the confidence band around the mean.</p>
<pre class="r"><code>popdat_countries %&gt;% 
  dplyr::filter(indicator==&quot;SP.POP.GROW&quot;) %&gt;%
  drop_na() %&gt;%
  select(-indicator, -country.name, -iso2c, -region) %&gt;% #pare down the data a bit &amp; pivot longer
  pivot_longer(cols=-c(country, income_level), names_to=&quot;year&quot;, values_to=&quot;growth_rate&quot;) %&gt;%
  group_by(income_level, year) %&gt;%
  summarise(mean_se(growth_rate)) #calculates mean + standard error of the mean.</code></pre>
<pre><code>## # A tibble: 72 × 5
## # Groups:   income_level [4]
##    income_level year      y  ymin  ymax
##    &lt;fct&gt;        &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 Low income   2000   2.97  2.78  3.17
##  2 Low income   2001   2.91  2.76  3.05
##  3 Low income   2002   2.86  2.71  3.02
##  4 Low income   2003   2.84  2.66  3.01
##  5 Low income   2004   2.84  2.68  3.00
##  6 Low income   2005   2.87  2.73  3.01
##  7 Low income   2006   2.90  2.76  3.04
##  8 Low income   2007   2.91  2.77  3.06
##  9 Low income   2008   2.89  2.74  3.04
## 10 Low income   2009   2.82  2.67  2.97
## # … with 62 more rows</code></pre>
<p>Ok, this looks good, so I’m going to save that data table as
<code>popgrowth_income</code>.</p>
<pre class="r"><code>popgrowth_income=popdat_countries %&gt;% 
  dplyr::filter(indicator==&quot;SP.POP.GROW&quot;) %&gt;%
  drop_na() %&gt;%
  select(-indicator, -country.name, -iso2c, -region) %&gt;% #pare down the data a bit &amp; pivot longer
  pivot_longer(cols=-c(country, income_level), names_to=&quot;year&quot;, values_to=&quot;growth_rate&quot;) %&gt;%
  group_by(income_level, year) %&gt;%
  summarise(mean_se(growth_rate)) #calculates mean + standard error of the mean.</code></pre>
<p>Now, we have the average (+/- standard error) population growth rate
for countries at each income level across each year for 2000 to 2017.
Here, the mean is “y” and lower and upper standard error is “ymin” and
“ymax”, respectively. Let’s plot this. Let’s start with a simple line
graph:</p>
<pre class="r"><code>ggplot(popgrowth_income, aes(x=as.numeric(year), y=y, group=income_level)) +
  geom_line(aes(color=income_level)) +
  theme_bw()</code></pre>
<p><img src="Ex_WorldBank_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<p>We can make this fancy by adding the confidence band using
<code>geom_ribbon()</code>, and cleaning up the axis labels:</p>
<pre class="r"><code>ggplot(popgrowth_income, aes(x=as.numeric(year), y=y, group=income_level)) +
  geom_line(aes(color=income_level)) +
  geom_ribbon(aes(ymin=ymin, ymax=ymax), alpha=0.3, fill=&quot;gray&quot;) +
  theme_bw() +
  ylab(&quot;Average Population Growth Rate&quot;) +
  xlab(&quot;Year&quot;)</code></pre>
<p><img src="Ex_WorldBank_files/figure-html/average_growth_by_income-1.png" width="672" /></p>
</div>
<div
id="how-does-the-relationship-between-population-growth-rate-and-income-level-differ-between-global-regions"
class="section level2">
<h2>5. How does the relationship between population growth rate and
income level differ between global regions?</h2>
<p>Now, let’s look at how income levels have different effects on
population growth rates depending on the region of the world. to do
this, we have to pick a year to analyze. Let’s go with the latest data,
2017.</p>
<p>We can do that simply by going from the original
<code>popdat_countries</code> (the raw data with the “aggregates”
removed), then filtering it to just the data on population growth, then
just looking at the 2017 data for each country. We’ll also keep the
region and income level data. We’ll remove rows that have NAs.</p>
<pre class="r"><code>popdat_countries %&gt;% 
  dplyr::filter(indicator==&quot;SP.POP.GROW&quot;) %&gt;%
  select(country, `2017`, region, income_level) %&gt;%
  drop_na()</code></pre>
<pre><code>## # A tibble: 215 × 4
##    country  `2017` region                     income_level       
##    &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;                      &lt;fct&gt;              
##  1 ABW      0.421  Latin America &amp; Caribbean  High income        
##  2 AFG      2.49   South Asia                 Low income         
##  3 AGO      3.31   Sub-Saharan Africa         Lower middle income
##  4 ALB     -0.0920 Europe &amp; Central Asia      Upper middle income
##  5 AND     -0.410  Europe &amp; Central Asia      High income        
##  6 ARE      1.40   Middle East &amp; North Africa High income        
##  7 ARG      0.961  Latin America &amp; Caribbean  Upper middle income
##  8 ARM      0.192  Europe &amp; Central Asia      Upper middle income
##  9 ASM      0.0755 East Asia &amp; Pacific        Upper middle income
## 10 ATG      1.03   Latin America &amp; Caribbean  High income        
## # … with 205 more rows</code></pre>
<p>Ok, that looks like what we want, so I’ll save it as
<code>popdat_2017</code>:</p>
<pre class="r"><code>popdat_2017=popdat_countries %&gt;% 
  dplyr::filter(indicator==&quot;SP.POP.GROW&quot;) %&gt;%
  select(country, `2017`, region, income_level) %&gt;%
  drop_na()</code></pre>
<p>Now we can plot population growth by income level, and use region to
create facets. Here, I’m going to use income_level as both the x axis
and color because the x-axis label is going to be hard to read.</p>
<pre class="r"><code>ggplot(popdat_2017, aes(x=income_level, y=`2017`)) +
  geom_boxplot(aes(color=income_level)) +
  facet_wrap(~region, nrow=3)</code></pre>
<p><img src="Ex_WorldBank_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<p>I can see that some regions don’t have enough variation in income
level to be useful (e.g., North America and South Asia). I can actually
filter the data within the ggplot function to remove those:</p>
<p>Lower income countries have higher population growth rate than those
with high income in some regions (sub-Saharan Africa), while in others
growth rate is bigger for high earners.</p>
<pre class="r"><code>ggplot(popdat_2017 %&gt;% dplyr::filter(region!=&quot;North America&quot; &amp; region!=&quot;South Asia&quot;), aes(x=income_level, y=`2017`)) +
  geom_boxplot(aes(color=income_level)) +
  facet_wrap(~region, nrow=2) +
  theme_bw() +
  theme(legend.position = &quot;bottom&quot;) +
  ylab(&quot;Population Growth Rate in 2017&quot;)</code></pre>
<p><img src="Ex_WorldBank_files/figure-html/growth_income_by_region-1.png" width="672" /></p>
<p>It looks like the relationship between income level and population
growth rate indeed changes between regions. For example, in
Europe/Central Asia, Latin America/Caribbean, and Sub-Saharan Africa,
countries with lower income have higher population growth rate. But the
relationship is opposite in the Middle East &amp; North Africa. There,
the countries with higher incomes have higher population growth
rate.</p>
<p>How would we test the idea that the relationship between income level
and population growth rate depends on the region? One way is to run a
linear model including the interaction effect of the two variables:</p>
<pre class="r"><code>lm.fit=lm(`2017`~region*income_level, data=popdat_2017)

anova(lm.fit)</code></pre>
<pre><code>## Analysis of Variance Table
## 
## Response: 2017
##                      Df  Sum Sq Mean Sq F value    Pr(&gt;F)    
## region                6 131.828 21.9713 35.7109 &lt; 2.2e-16 ***
## income_level          3   2.949  0.9830  1.5977  0.191299    
## region:income_level  12  20.996  1.7497  2.8438  0.001279 ** 
## Residuals           193 118.744  0.6153                      
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
