---
title: "Part 1.2: File Organization, Version Control, and Workflow"
subtitle: "BIOS 967: Intro to R for Biologists"
author: "Dai Shizuka"
date: "updated `r format(Sys.time(), '%m/%d/%y')` "
output: 
  html_document:
    toc: true
    toc_depth: 3
    toc_float: true
font size: 11pt
geometry: margin=1in
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

*Note: You can get a lot of this information from Hadley Wickham's "R for Data Science" book, Chapter 8: [here](https://r4ds.had.co.nz/workflow-projects.html), and the [https://happygitwithr.com/](https://happygitwithr.com/) tutorials.*

## 1. Navigating folders and files using absolute paths (but don't do this!)

As explained in the previous module, the Working Directory defines where R will look for files, or where it will save files that you generate. R uses pathnames to arrange these files (as do all programming languages). These are sometimes called "absolute paths". Once you understand how path names work, it can be really handy to be able to pull data in and out from wherever on your computer. However, this can quickly get cumbersome. Moreover, it makes it hard to port your scripts from one computer to another, since pathnames on different computers will end up being different. 

For example, if I were to create a new data file and save it as a .csv file on the desktop on my own computer (Mac), the path name might look like this:
`/Users/daishizuka/Desktop/data.csv`

But if I copy and paste the exact same file and save it on the desktop of one of my lab computers (Windows), the path name might look like this:
`C:\Users\ShizukaLab\Desktop\data.csv`

This means that if your code script references this dataset, you can't just run the same code to import data on different computers. Now, this might not feel like a big problem for you if you plan to do all of your analyses on your own computer, and you know where all the files on your computer are. HOWEVER, this is a major hindrance to collaboration. Also, it is a major hindrance to me teaching this class, as I can't easily try out your code to help you troubleshoot. 

That's where RStudio Projects come in...

## 2. Using Rstudio Projects and organizing your files. ![](images/Rstudiologo.png){width=10%}

Rstudio projects facilitate a important "best practice" for developing code to facilitate your research, which is to make sure that ***for each project, create one folder that contains all of your data, scripts, outputs (e.g., plots) and other assets.*** 

Additionally, I highly recommend that this "project directory" folder includes a subfolder called "data" that contain all of the data files, and "figures" (or some other name) folder that will contain all of the output plots, etc. 

Setting up a project directory in this way allows you to keep everything organized and up to date, and it also helps with collaborations or sharing code, because it is easy to follow where things are. It is also nice for your "future self"--if you come back to a project after some time, it is easy to pick up where you left off without wondering where you left all of the relevant files. 

Finally, the more important reason to set up an Rstudio project folder is that it will allow anyone to run the code you are developing in this folder because you all of your pathnames will be "relative" to the parent directory. By using "relative path" names in your code, it becomes much more reproducible and enables collaboration. 

### 2.1. Setting up a new Rstudio project folder

Here is what I recommend for every project you start: 

1. Create a folder that will be your main "project folder".
  
*Try this out be creating a "trial" Folder somewhere in your computer.*

2. Next, in R Studio, click on "File" > "New Project" 

3. Click on "Existing Directory", click "Browse" and select the "trial" Folder you created, then click "Create Project"

4. Now, you will see that there is a new "trial.rproj" file in your folder.

5. Open that .rproj file. This will open up a new RStudio window. 

6. Now, whenever you create any file within this R Project, the files will automatically go into this folder. Also, if you want to import any files, you can just put in the file name instead of the whole path. 

Try this out by saving a pre-loaded data frame as a spreadsheet file:
Here, we'll save the "iris" data set as a .csv file.

```{r}
write.csv(iris, file="iris.csv")
```

You see this new .csv file in your project folder. 

## 3. Version control and collaboration using Git and GitHub ![](images/github-mark.png){width=10%}

***Version control*** is a system by which you can keep track of changes to collaborative projects. One common example is Google Doc, which is an online document that multiple people can collaborate on. Importantly, Google Doc automatically saves versions of the document when changes are made, and users can revert back to earlier versions if they want. 

***Git*** is an open-source software that facilitates version control of files in *repositories* (which is another way of saying *project directory*).

***GitHub*** is a service that facilitates Git-based projects. There are other popular similar services, such as Bitbucket and GitLab 

### 3.1. Why are we using version control and GitHub

* For practical purposes, **this system will help me teach this class**. If we do this right, it will help tremendously with the process of troubleshooting your code when we get to independent projects! It will allow me to access your projects on my computer, help make edits, and keep track of those edits. 

* The larger reason is that **this will help you with your research**. You will no doubt be using R (and perhaps other coding languages) for your research, and this enables a workflow that is portable from one computer/collaborator to another. 

* It will expand the scope of your work. Once you make a project repository, you can make it private or public. If you make a public repository, then you can share it with colleagues. Likewise, you can *fork* any other public repository--this is increasingly the way people disseminate new software or packages for cutting-edge analysis techniques. 

* **You'll impress people!** 

### 3.2. Set up a GitHub repository for this course, and set it up to talk to Rstudio

*Here, we are following the directions on [Chapter 6-13 of the Happy git with R website, here](https://happygitwithr.com/install-git)*

### 3.2.1. Create a GitHub account

Go to [github.com](https://github.com/) and sign up for an account.

### 3.2.2 Check if you have Git installed

The simplest way to do this is use the **Shell** on your computer. You have this already, whether or not you know it. 

* On a Mac, search for "Terminal" on your computer. You can either look in the Applications folder or search for "Terminal.app" in Spotlight 

![](images/Spotlight_terminal.png){width=50%}

* On a Windows computer, search for "Shell"


Either way, the Shell/Terminal window often looks something like this, with a black background and courier or monaco font.k

![](images/Shell_window.png){width=50%}


Then type in this window:

```{eval=F}
which git
```

If it responds with something like:
```{}
## /usr/bin/git
```
then it means you have Git installed already.

Now check the version:
```{eval=F}
git --version
```
It should give you the version number. 

### 3.2.3. Install a Git Client

There are many Git clients out there. Personally, I just use [GitHub Desktop](https://desktop.github.com/) ![](images/Github-desktop-logo.png){width=10%}

Git Clients provide a graphical user interface (GUI) that facilitates the processes of committing, pushing, pulling and other tasks. It also allows you to see the history of changes to your repository.

### 3.2.4. Create a Personal Access Token on GitHub

When linking a GitHub repository with Rstudio, you will need to be able to authenticate your connection. To increase security, GitHub no longer supports access using a simple password. Instead, it requires you to authenticate using a personal access token. You need to generate a token, and then you will use this later to connect Rstudio with your repository. 

* Go to [https://github.com/settings/tokens](https://github.com/settings/tokens) and click “Generate token”. Your settings should include "repo", "user", "workflow", and I would set the expiration date to be at least the end of the semester (e.g., December 15th, 2023). **SAVE THIS TOKEN**. 

*(The longer way to go is to sign in to github, Click on your avatar on the top-right corner, then go to Settings > Developer settings (at the very bottom) > Personal access tokens > Tokens (classic))*

### 3.2.5. Make a repository ("repo") on GitHub.

Log into [github](https://github.com), click on “Repositories”, then click the big green “New” button

* Repository template: No template
* Repository name: `BIOS967_YourLastName_YourFirstName` ***please follow this template for naming your repository--this allows me to easily find your repo on my end***
* Initialize this repository with: Add a README file.

Click on "Create Repository"

Now, click on the green button that says "<>Code"

Copy the clone URL to your clipboard. Use the HTTPS URL. 

![](images/github-https-or-ssh-url-annotated.png){width=50%}

### 3.2.6. Clone the GitHub repository to your computer via RStudio

In RStudio, start a new project:
File > New Project > Version Control > Git. In “Repository URL”, paste the URL of your new GitHub repository. 

Determine where your project will be saved locally. Be intentional. I have all of my GitHub repositories saved in my Documents folder in a subfolder called "GitHub". 

Check "Open in new session"

Click "Create Project".

**At some point in this process, you will be asked to authenticate. At that point, you will enter your GitHub account name, and then enter the Personal Access Token that you created in step 3.2.4.**

## 4. Working with GitHub: Pull, Stage, Commit, Push 

Once you have finished the set up process, you are ready to start your workflow!

The Git workflow may feel a bit painful for you in the beginning because it seems a lot more manual and tedious than automated syncing that you may have gotten used to with Dropbox, Google Drive, etc. But really, it's no different than those systems--it's just that Git makes you much more intentional about when you update "local" vs. "remote" versions of your project files. 

Here are the 4 main actions that you will take whenever you work with your GitHub repository:

* **Pull:** When you open your project on your computer, I highly recommend that you always first click "Pull". This takes the version of your repository that is stored on GitHub remotely and pulls it to your local folder. Thus, you have synced your computer with whatever changes that other people (e.g., your instructor) has made on your repository. 

* **Stage:** Whenever you make any changes on any files in your project directory, Git will "stage" those changes. This just means that the system recognizes that you've made those changes (e.g., add file, delete file, edit file) and it is ready for you to commit to those changes. 

* **Commit:** When you are done making a set of changes and you are ready to upload those changes to GitHub, you first need to **commit** those changes. When you do this, you will write a "commit message"--i.e., a brief description of the changes that you have made. Git will make you do this--it won't let you push those changes to GitHub unless you've written something. This will go in your change history, and it can be a nice way for you (and your collaborators) to understand what changes you have made. 

* **Push:** Once you have committed your changes, you are ready to **push** those changes onto your remote repository--i.e., the copy that is stored in GitHub. 




