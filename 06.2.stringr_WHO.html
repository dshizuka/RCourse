<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Dai Shizuka" />


<title>Parsing text: Example with WHO data</title>

<script src="site_libs/header-attrs-2.16/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/sandstone.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Intro to R</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="syllabus.html">Syllabus</a>
</li>
<li>
  <a href="modules.html">Modules</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Parsing text: Example with WHO data</h1>
<h4 class="author">Dai Shizuka</h4>
<h4 class="date">updated 09/29/22</h4>

</div>


<hr />
<div id="data-coded-into-text" class="section level2">
<h2>1. Data coded into text</h2>
<p>There are many cases with large datasets where important data is
stored in column names or file names. There are many cases in which your
analysis pipeline needs to include steps to extract that data from the
characters, rather than having to code it manually yourself. In other
cases, you might also conduct “text mining” analyses where you look for
particular words and codes inside large amounts of documents, websites,
etc. This is made possible in R using several methods: e.g., substrings,
character splitting, character replacement and pattern matching.</p>
<p>Each of these functions exist in both base R and in the tidyverse
package <em>stringr</em>.</p>
<p>Let’s go ahead and load the tidyverse library, as well as a package
called <em>lubridate</em> (we’ll use it later):</p>
<pre class="r"><code>library(tidyverse)
library(lubridate)</code></pre>
</div>
<div id="section" class="section level2">
<h2></h2>
<p>Get the stringr cheatsheet <a
href="https://raw.githubusercontent.com/rstudio/cheatsheets/main/strings.pdf">here</a></p>
<p>Get the lubridate cheatsheet <a
href="https://github.com/rstudio/cheatsheets/blob/main/lubridate.pdf">here</a></p>
<hr />
<div id="extracting-substrings-using-fixed-positions"
class="section level3">
<h3>1.1. Extracting substrings using fixed positions</h3>
<p>Let’s start with a hypothetical example. What if I had named my data
files with the date:</p>
<pre class="r"><code>filename=&quot;data_20220927.csv&quot;</code></pre>
<p>Now, let’s say I wanted to extract the dates from file names as part
of my analyses. The basic way I might do this is through “text
parsing”–i.e., extracting parts of text to get useful data. Here, I know
that my file name has useful information (i.e., the year, month and
date).</p>
<p>In this case, I can just extract the part of this character string
that contains the information I want.</p>
<p>If I just **count the start and stop position* of the information
within this character string, I can just extract that part of the string
(i.e., substring). In this case, the date (“20200927”) goes from
position 6 to position 13 in this character.</p>
<p>I can use the <code>substr()</code> function in base R to do
this:</p>
<pre class="r"><code>substr(filename, start=6, stop=13)</code></pre>
<pre><code>## [1] &quot;20220927&quot;</code></pre>
<p>Alternatively, I can use the <code>str_sub()</code> function in
<em>stringr</em> in the same way.</p>
<pre class="r"><code>str_sub(filename, start=6, end=13)</code></pre>
<pre><code>## [1] &quot;20220927&quot;</code></pre>
<p>… and once I have this substring, I can convert this into a date
object.</p>
<p>I can do this in base R, using the <code>as.Date()</code> function.
To use this function, you need to specify the format in which the
character string encodes the date information. Here, since it is a
4-number code for year, followed by month and date, you would put
“%Y%m%d”.</p>
<pre class="r"><code>as.Date(substr(filename, start=6, stop=13), format=&quot;%Y%m%d&quot;)</code></pre>
<pre><code>## [1] &quot;2022-09-27&quot;</code></pre>
<p>Alternatively, you can use the <code>ymd()</code> function in
<em>lubridate</em>. This function is a bit smarter in that it is more
flexible–it can parse the text correctly as long as it’s in some form of
year-month-date order. (If it was in month-date-year, you would use the
<code>mdy()</code> function).</p>
<pre class="r"><code>filename %&gt;% str_sub(start=6, end=13) %&gt;% ymd()</code></pre>
<pre><code>## [1] &quot;2022-09-27&quot;</code></pre>
<p><strong>Extracting substrings is probably the most straightforward
way to parse text. HOWEVER, you can only do this if the text is
formatted in a way that makes the position of your information of
interest predictable</strong></p>
<hr />
</div>
<div id="replacing-characters" class="section level3">
<h3>1.2. Replacing characters</h3>
<p>You could also extract the date from the file name by substituting
<em>blanks</em> for the parts that you don’t want (i.e., “data_” and
“.csv”).</p>
<p>In base R, you can do this with <code>gsub()</code>. For example:</p>
<pre class="r"><code>gsub(&quot;data_&quot;, &quot;&quot;, filename) #this removes &quot;data_&quot; from the character string</code></pre>
<pre><code>## [1] &quot;20220927.csv&quot;</code></pre>
<p>So you can string this together, then convert to date:</p>
<pre class="r"><code>a=gsub(&quot;data_&quot;, &quot;&quot;, filename) #remove the prefix
b=gsub(&quot;.csv&quot;, &quot;&quot;, a) #remove the suffix
as.Date(b, format=&quot;%Y%m%d&quot;) #convert to date object</code></pre>
<pre><code>## [1] &quot;2022-09-27&quot;</code></pre>
<p>Using the <em>stringr</em> function <code>str_replace()</code> in the
same way:</p>
<pre class="r"><code>filename %&gt;% 
  str_replace(&quot;data_&quot;, &quot;&quot;) %&gt;% 
  str_replace(&quot;.csv&quot;, &quot;&quot;) %&gt;% 
  ymd()</code></pre>
<pre><code>## [1] &quot;2022-09-27&quot;</code></pre>
<hr />
</div>
<div id="splitting-characters" class="section level3">
<h3>1.3. Splitting characters</h3>
<p>Another option is to split the character string into multiple
elements. You can specify the character you use as the marker for where
you want to split the character string. This is a very powerful and
flexible tool, though it requires you to have a good understanding of
how to deal with lists… So it is probably best reserved for complex
tasks that you can’t do with substrings or text replacement.</p>
<p>For example, if we split the file name at the underscore (“_“):</p>
<pre class="r"><code>strsplit(filename, split=c(&quot;_&quot;))</code></pre>
<pre><code>## [[1]]
## [1] &quot;data&quot;         &quot;20220927.csv&quot;</code></pre>
<pre class="r"><code>a=unlist(strsplit(filename, split=c(&quot;_&quot;)))
a</code></pre>
<pre><code>## [1] &quot;data&quot;         &quot;20220927.csv&quot;</code></pre>
<pre class="r"><code>strsplit(a, split=c(&quot;\\.&quot;))</code></pre>
<pre><code>## [[1]]
## [1] &quot;data&quot;
## 
## [[2]]
## [1] &quot;20220927&quot; &quot;csv&quot;</code></pre>
<pre class="r"><code>unlist(strsplit(a, split=c(&quot;\\.&quot;)))</code></pre>
<pre><code>## [1] &quot;data&quot;     &quot;20220927&quot; &quot;csv&quot;</code></pre>
<pre class="r"><code>b=unlist(strsplit(a, split=c(&quot;\\.&quot;)))
b[2]</code></pre>
<pre><code>## [1] &quot;20220927&quot;</code></pre>
<pre class="r"><code>as.Date(b[2], format=&quot;%Y%m%d&quot;) #convert to date object</code></pre>
<pre><code>## [1] &quot;2022-09-27&quot;</code></pre>
<hr />
</div>
<div id="pattern-matching" class="section level3">
<h3>1.4. Pattern Matching</h3>
<p>Finally, there may be cases where you don’t need to extract the whole
information, but you simply need to know if the character string
contains some pattern.</p>
<pre class="r"><code>filenames_vector=c(&quot;data_20220927.csv&quot;, &quot;data_20221121.csv&quot;, &quot;data_20230103.csv&quot;, &quot;data_20230308.csv&quot;)</code></pre>
<p>For example, let’s say you are scouring the file names for all files
pertaining to the year 2022. Then, perhaps all you need to know is
whether the file name contains “2022”.</p>
<p>You can find this out one of two ways.</p>
<p>The <code>grepl()</code> function will tell you TRUE or FALSE if the
character string does or does not contain the string you are looking
for:</p>
<pre class="r"><code>grepl(&quot;2022&quot;, filenames_vector)</code></pre>
<pre><code>## [1]  TRUE  TRUE FALSE FALSE</code></pre>
<p>In contrast, <code>grep()</code> will return the position of the
elements that matched your pattern:</p>
<pre class="r"><code>grep(&quot;2022&quot;, filenames_vector)</code></pre>
<pre><code>## [1] 1 2</code></pre>
<p>Then, you can extract the file names that contain “2022”.</p>
<pre class="r"><code>filenames_vector[grep(&quot;2022&quot;, filenames_vector)]</code></pre>
<pre><code>## [1] &quot;data_20220927.csv&quot; &quot;data_20221121.csv&quot;</code></pre>
<hr />
</div>
</div>
<div id="example-using-who-tuberculosis-data-under-construction"
class="section level2">
<h2>2. Example using WHO tuberculosis data (UNDER CONSTRUCTION)</h2>
<pre class="r"><code>who</code></pre>
<pre><code>## # A tibble: 7,240 × 60
##    country     iso2  iso3   year new_s…¹ new_s…² new_s…³ new_s…⁴ new_s…⁵ new_s…⁶
##    &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt; &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;
##  1 Afghanistan AF    AFG    1980      NA      NA      NA      NA      NA      NA
##  2 Afghanistan AF    AFG    1981      NA      NA      NA      NA      NA      NA
##  3 Afghanistan AF    AFG    1982      NA      NA      NA      NA      NA      NA
##  4 Afghanistan AF    AFG    1983      NA      NA      NA      NA      NA      NA
##  5 Afghanistan AF    AFG    1984      NA      NA      NA      NA      NA      NA
##  6 Afghanistan AF    AFG    1985      NA      NA      NA      NA      NA      NA
##  7 Afghanistan AF    AFG    1986      NA      NA      NA      NA      NA      NA
##  8 Afghanistan AF    AFG    1987      NA      NA      NA      NA      NA      NA
##  9 Afghanistan AF    AFG    1988      NA      NA      NA      NA      NA      NA
## 10 Afghanistan AF    AFG    1989      NA      NA      NA      NA      NA      NA
## # … with 7,230 more rows, 50 more variables: new_sp_m65 &lt;int&gt;,
## #   new_sp_f014 &lt;int&gt;, new_sp_f1524 &lt;int&gt;, new_sp_f2534 &lt;int&gt;,
## #   new_sp_f3544 &lt;int&gt;, new_sp_f4554 &lt;int&gt;, new_sp_f5564 &lt;int&gt;,
## #   new_sp_f65 &lt;int&gt;, new_sn_m014 &lt;int&gt;, new_sn_m1524 &lt;int&gt;,
## #   new_sn_m2534 &lt;int&gt;, new_sn_m3544 &lt;int&gt;, new_sn_m4554 &lt;int&gt;,
## #   new_sn_m5564 &lt;int&gt;, new_sn_m65 &lt;int&gt;, new_sn_f014 &lt;int&gt;,
## #   new_sn_f1524 &lt;int&gt;, new_sn_f2534 &lt;int&gt;, new_sn_f3544 &lt;int&gt;, …</code></pre>
<pre class="r"><code>who %&gt;% pivot_longer(c(-country, -iso2, -iso3, -year))</code></pre>
<pre><code>## # A tibble: 405,440 × 6
##    country     iso2  iso3   year name         value
##    &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;chr&gt;        &lt;int&gt;
##  1 Afghanistan AF    AFG    1980 new_sp_m014     NA
##  2 Afghanistan AF    AFG    1980 new_sp_m1524    NA
##  3 Afghanistan AF    AFG    1980 new_sp_m2534    NA
##  4 Afghanistan AF    AFG    1980 new_sp_m3544    NA
##  5 Afghanistan AF    AFG    1980 new_sp_m4554    NA
##  6 Afghanistan AF    AFG    1980 new_sp_m5564    NA
##  7 Afghanistan AF    AFG    1980 new_sp_m65      NA
##  8 Afghanistan AF    AFG    1980 new_sp_f014     NA
##  9 Afghanistan AF    AFG    1980 new_sp_f1524    NA
## 10 Afghanistan AF    AFG    1980 new_sp_f2534    NA
## # … with 405,430 more rows</code></pre>
<pre class="r"><code>codes=who %&gt;% 
  pivot_longer(c(-country, -iso2, -iso3, -year)) %&gt;%
  pull(name)
unique(codes)</code></pre>
<pre><code>##  [1] &quot;new_sp_m014&quot;  &quot;new_sp_m1524&quot; &quot;new_sp_m2534&quot; &quot;new_sp_m3544&quot; &quot;new_sp_m4554&quot;
##  [6] &quot;new_sp_m5564&quot; &quot;new_sp_m65&quot;   &quot;new_sp_f014&quot;  &quot;new_sp_f1524&quot; &quot;new_sp_f2534&quot;
## [11] &quot;new_sp_f3544&quot; &quot;new_sp_f4554&quot; &quot;new_sp_f5564&quot; &quot;new_sp_f65&quot;   &quot;new_sn_m014&quot; 
## [16] &quot;new_sn_m1524&quot; &quot;new_sn_m2534&quot; &quot;new_sn_m3544&quot; &quot;new_sn_m4554&quot; &quot;new_sn_m5564&quot;
## [21] &quot;new_sn_m65&quot;   &quot;new_sn_f014&quot;  &quot;new_sn_f1524&quot; &quot;new_sn_f2534&quot; &quot;new_sn_f3544&quot;
## [26] &quot;new_sn_f4554&quot; &quot;new_sn_f5564&quot; &quot;new_sn_f65&quot;   &quot;new_ep_m014&quot;  &quot;new_ep_m1524&quot;
## [31] &quot;new_ep_m2534&quot; &quot;new_ep_m3544&quot; &quot;new_ep_m4554&quot; &quot;new_ep_m5564&quot; &quot;new_ep_m65&quot;  
## [36] &quot;new_ep_f014&quot;  &quot;new_ep_f1524&quot; &quot;new_ep_f2534&quot; &quot;new_ep_f3544&quot; &quot;new_ep_f4554&quot;
## [41] &quot;new_ep_f5564&quot; &quot;new_ep_f65&quot;   &quot;newrel_m014&quot;  &quot;newrel_m1524&quot; &quot;newrel_m2534&quot;
## [46] &quot;newrel_m3544&quot; &quot;newrel_m4554&quot; &quot;newrel_m5564&quot; &quot;newrel_m65&quot;   &quot;newrel_f014&quot; 
## [51] &quot;newrel_f1524&quot; &quot;newrel_f2534&quot; &quot;newrel_f3544&quot; &quot;newrel_f4554&quot; &quot;newrel_f5564&quot;
## [56] &quot;newrel_f65&quot;</code></pre>
<p>The help file provides the codes:</p>
<ul>
<li>all codes start with “new”</li>
<li>the next part codes the method of diagnosis. It is either “rel”,
“_sn”, “_sp”, or “_ep”… notice that the under score ensures that they
are all 3 characters long.</li>
<li>next part is “_m” for male and “_f” for female. These are all 2
characters long</li>
<li>final part has different number of characters: 014 = 0-14 yrs of
age, 1524 = 15-24 years of age, 2534 = 25 to 34 years of age, 3544 = 35
to 44 years of age, 4554 = 45 to 54 years of age, 5564 = 55 to 64 years
of age, 65 = 65 years of age or older</li>
</ul>
<p>Get the diagnosis method</p>
<pre class="r"><code>who %&gt;% 
  pivot_longer(c(-country, -iso2, -iso3, -year)) %&gt;%
  mutate(method=str_sub(name, 4, 6)) </code></pre>
<pre><code>## # A tibble: 405,440 × 7
##    country     iso2  iso3   year name         value method
##    &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;chr&gt;        &lt;int&gt; &lt;chr&gt; 
##  1 Afghanistan AF    AFG    1980 new_sp_m014     NA _sp   
##  2 Afghanistan AF    AFG    1980 new_sp_m1524    NA _sp   
##  3 Afghanistan AF    AFG    1980 new_sp_m2534    NA _sp   
##  4 Afghanistan AF    AFG    1980 new_sp_m3544    NA _sp   
##  5 Afghanistan AF    AFG    1980 new_sp_m4554    NA _sp   
##  6 Afghanistan AF    AFG    1980 new_sp_m5564    NA _sp   
##  7 Afghanistan AF    AFG    1980 new_sp_m65      NA _sp   
##  8 Afghanistan AF    AFG    1980 new_sp_f014     NA _sp   
##  9 Afghanistan AF    AFG    1980 new_sp_f1524    NA _sp   
## 10 Afghanistan AF    AFG    1980 new_sp_f2534    NA _sp   
## # … with 405,430 more rows</code></pre>
<p>Remove the underscore “_” if it is exists.</p>
<pre class="r"><code>who %&gt;% 
  pivot_longer(c(-country, -iso2, -iso3, -year)) %&gt;%
  mutate(method=str_sub(name, 4, 6)) %&gt;%
  mutate(method=str_replace(method, &quot;_&quot;, &quot;&quot;))</code></pre>
<pre><code>## # A tibble: 405,440 × 7
##    country     iso2  iso3   year name         value method
##    &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;chr&gt;        &lt;int&gt; &lt;chr&gt; 
##  1 Afghanistan AF    AFG    1980 new_sp_m014     NA sp    
##  2 Afghanistan AF    AFG    1980 new_sp_m1524    NA sp    
##  3 Afghanistan AF    AFG    1980 new_sp_m2534    NA sp    
##  4 Afghanistan AF    AFG    1980 new_sp_m3544    NA sp    
##  5 Afghanistan AF    AFG    1980 new_sp_m4554    NA sp    
##  6 Afghanistan AF    AFG    1980 new_sp_m5564    NA sp    
##  7 Afghanistan AF    AFG    1980 new_sp_m65      NA sp    
##  8 Afghanistan AF    AFG    1980 new_sp_f014     NA sp    
##  9 Afghanistan AF    AFG    1980 new_sp_f1524    NA sp    
## 10 Afghanistan AF    AFG    1980 new_sp_f2534    NA sp    
## # … with 405,430 more rows</code></pre>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3,h4",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
