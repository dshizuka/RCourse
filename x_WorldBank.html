<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Dai Shizuka" />


<title>Worked Example: Wrangling World Bank Population Data</title>

<script src="site_libs/header-attrs-2.29/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/sandstone.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Intro to R</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="syllabus.html">Syllabus</a>
</li>
<li>
  <a href="modules.html">Modules</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Worked Example: Wrangling World Bank
Population Data</h1>
<h4 class="author">Dai Shizuka</h4>
<h4 class="date">updated 08/24/25</h4>

</div>


<hr />
<div id="things-you-will-learn-in-this-worked-example"
class="section level4">
<h4>Things you will learn in this Worked Example</h4>
<ul>
<li><strong>Practice wrangling data with <em>dplyr</em> and
<em>tidyr</em> </strong></li>
<li><strong>Learn tricks to download data from public data repositories
like the World Bank</strong></li>
<li><strong>More practice with ggplot</strong></li>
<li><strong>A little bit of stats</strong></li>
</ul>
<p>We will accomplish these while exploring the (admittedly superficial)
patterns in population growth rates across countries.</p>
<p><strong>By the end, you’ll be able to produce graphs like
this:</strong></p>
<p><img src="images/average_growth_by_income-1.png" width="50%" /><img src="images/growth_income_by_region-1.png" width="50%" /></p>
<p><br></p>
<hr />
</div>
<div id="set-up-load-packages" class="section level2">
<h2>Set up: load packages</h2>
<pre class="r"><code>library(wbstats)
library(tidyverse)</code></pre>
<hr />
</div>
<div id="the-data-population-growth-trends-across-the-world"
class="section level2">
<h2>1. The Data: Population growth trends across the world</h2>
<p>The World Bank actually makes it very easy to download a huge amount
of data very easily. You could just go to the <a
href="https://data.worldbank.org/">World Bankd Open Data site</a> and
search for data and download them in a few clicks. There are even
packages such as <code>WDI</code> and <code>wbstats</code> that allow
you to query and pull data from this site from within R.</p>
<p>However, for the purposes of this exercise, we will deal with several
datasets that are included in the packages we have loaded above.</p>
<p><br></p>
<div id="world_bank_pop-population-data-from-world-bank-2000-2017"
class="section level3">
<h3><code>world_bank_pop</code>: Population data from World Bank
(2000-2017)</h3>
<p>First is the <code>world_bank_pop</code> dataset that is included in
the <code>tidyr</code> package (which is part of the the tidyverse
suite). Start by pulling up the help file for the dataset</p>
<pre class="r"><code>?world_bank_pop</code></pre>
<p>Let’s take a peak at the data, which is in “tibble” format:</p>
<pre class="r"><code>world_bank_pop</code></pre>
<pre><code>## # A tibble: 1,064 × 20
##    country indicator      `2000`  `2001`  `2002`  `2003`  `2004`  `2005`  `2006`
##    &lt;chr&gt;   &lt;chr&gt;           &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
##  1 ABW     SP.URB.TOTL    4.16e4 4.20e+4 4.22e+4 4.23e+4 4.23e+4 4.24e+4 4.26e+4
##  2 ABW     SP.URB.GROW    1.66e0 9.56e-1 4.01e-1 1.97e-1 9.46e-2 1.94e-1 3.67e-1
##  3 ABW     SP.POP.TOTL    8.91e4 9.07e+4 9.18e+4 9.27e+4 9.35e+4 9.45e+4 9.56e+4
##  4 ABW     SP.POP.GROW    2.54e0 1.77e+0 1.19e+0 9.97e-1 9.01e-1 1.00e+0 1.18e+0
##  5 AFE     SP.URB.TOTL    1.16e8 1.20e+8 1.24e+8 1.29e+8 1.34e+8 1.39e+8 1.44e+8
##  6 AFE     SP.URB.GROW    3.60e0 3.66e+0 3.72e+0 3.71e+0 3.74e+0 3.81e+0 3.81e+0
##  7 AFE     SP.POP.TOTL    4.02e8 4.12e+8 4.23e+8 4.34e+8 4.45e+8 4.57e+8 4.70e+8
##  8 AFE     SP.POP.GROW    2.58e0 2.59e+0 2.61e+0 2.62e+0 2.64e+0 2.67e+0 2.70e+0
##  9 AFG     SP.URB.TOTL    4.31e6 4.36e+6 4.67e+6 5.06e+6 5.30e+6 5.54e+6 5.83e+6
## 10 AFG     SP.URB.GROW    1.86e0 1.15e+0 6.86e+0 7.95e+0 4.59e+0 4.47e+0 5.03e+0
## # ℹ 1,054 more rows
## # ℹ 11 more variables: `2007` &lt;dbl&gt;, `2008` &lt;dbl&gt;, `2009` &lt;dbl&gt;, `2010` &lt;dbl&gt;,
## #   `2011` &lt;dbl&gt;, `2012` &lt;dbl&gt;, `2013` &lt;dbl&gt;, `2014` &lt;dbl&gt;, `2015` &lt;dbl&gt;,
## #   `2016` &lt;dbl&gt;, `2017` &lt;dbl&gt;</code></pre>
<p>Notice that each country is repeated across 4 rows. This is because
there are actually 4 different “indicators” for each country, and so
each country x indicator combination takes up a row. The rest of the
columns are years, from 2000 to 2017.</p>
<p>Also notice that the numbers in the column names have a backquote, or
“`” around them. In R, this allows numbers to be interpreted as text
(and column names have to be text).</p>
<p>So, if you wanted to pull up the “2001” column, this will NOT
work…</p>
<pre class="r"><code>world_bank_pop$2001</code></pre>
<p>…but this will work</p>
<pre class="r"><code>world_bank_pop$`2001`</code></pre>
<p><br></p>
<hr />
</div>
</div>
<div id="exclude-aggregate-data-to-get-data-for-countries-only"
class="section level2">
<h2>2. Exclude aggregate data to get data for countries only</h2>
<p>We are going to start by diving into the <code>world_bank_pop</code>
dataset.</p>
<p>Let’s take a peek at the dataset again and see what we have…</p>
<pre class="r"><code>world_bank_pop</code></pre>
<pre><code>## # A tibble: 1,064 × 20
##    country indicator      `2000`  `2001`  `2002`  `2003`  `2004`  `2005`  `2006`
##    &lt;chr&gt;   &lt;chr&gt;           &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
##  1 ABW     SP.URB.TOTL    4.16e4 4.20e+4 4.22e+4 4.23e+4 4.23e+4 4.24e+4 4.26e+4
##  2 ABW     SP.URB.GROW    1.66e0 9.56e-1 4.01e-1 1.97e-1 9.46e-2 1.94e-1 3.67e-1
##  3 ABW     SP.POP.TOTL    8.91e4 9.07e+4 9.18e+4 9.27e+4 9.35e+4 9.45e+4 9.56e+4
##  4 ABW     SP.POP.GROW    2.54e0 1.77e+0 1.19e+0 9.97e-1 9.01e-1 1.00e+0 1.18e+0
##  5 AFE     SP.URB.TOTL    1.16e8 1.20e+8 1.24e+8 1.29e+8 1.34e+8 1.39e+8 1.44e+8
##  6 AFE     SP.URB.GROW    3.60e0 3.66e+0 3.72e+0 3.71e+0 3.74e+0 3.81e+0 3.81e+0
##  7 AFE     SP.POP.TOTL    4.02e8 4.12e+8 4.23e+8 4.34e+8 4.45e+8 4.57e+8 4.70e+8
##  8 AFE     SP.POP.GROW    2.58e0 2.59e+0 2.61e+0 2.62e+0 2.64e+0 2.67e+0 2.70e+0
##  9 AFG     SP.URB.TOTL    4.31e6 4.36e+6 4.67e+6 5.06e+6 5.30e+6 5.54e+6 5.83e+6
## 10 AFG     SP.URB.GROW    1.86e0 1.15e+0 6.86e+0 7.95e+0 4.59e+0 4.47e+0 5.03e+0
## # ℹ 1,054 more rows
## # ℹ 11 more variables: `2007` &lt;dbl&gt;, `2008` &lt;dbl&gt;, `2009` &lt;dbl&gt;, `2010` &lt;dbl&gt;,
## #   `2011` &lt;dbl&gt;, `2012` &lt;dbl&gt;, `2013` &lt;dbl&gt;, `2014` &lt;dbl&gt;, `2015` &lt;dbl&gt;,
## #   `2016` &lt;dbl&gt;, `2017` &lt;dbl&gt;</code></pre>
<p>I want to start by looking at how many unique countries we actually
have here.</p>
<pre class="r"><code>length(unique(world_bank_pop$country)) #this gives us the number of unique values in the &quot;country&quot; column</code></pre>
<pre><code>## [1] 266</code></pre>
<p>You can see that there are way more “countries” here than there are
in the world. As of 2022, there are 193 countries in the United Nations,
though if we add soverign states that are not recognized by UN (e.g.,
Taiwan, Kosovo, etc.), the list is about 206… and there are more if we
include disputed territories.</p>
<p><strong>The reason the World Bank data has even more than that is
because some of the “countries” include “aggregates” like “Arab World”
or “High-income Countries”. </strong></p>
<p>Unfortunately, the <code>world_bank_pop</code> dataset does not
include any variables that allow us to differentiate the countries from
the aggregates! <strong>However</strong>, we can solve this problem by
pulling the metadata for countries from the World Bank. We can do this
by using the <code>wb_countries()</code> function from the
<em>wbstats</em> package.</p>
<p>Let’s pull the country metadata and save it as an object called
“metadata”:</p>
<pre class="r"><code>metadata=wb_countries()</code></pre>
<pre class="r"><code>metadata</code></pre>
<pre><code>## # A tibble: 296 × 18
##    iso3c iso2c country capital_city longitude latitude region_iso3c region_iso2c
##    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;            &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;       
##  1 ABW   AW    Aruba   Oranjestad      -70.0     12.5  LCN          ZJ          
##  2 AFE   ZH    Africa… &lt;NA&gt;             NA       NA    &lt;NA&gt;         &lt;NA&gt;        
##  3 AFG   AF    Afghan… Kabul            69.2     34.5  MEA          ZQ          
##  4 AFR   A9    Africa  &lt;NA&gt;             NA       NA    &lt;NA&gt;         &lt;NA&gt;        
##  5 AFW   ZI    Africa… &lt;NA&gt;             NA       NA    &lt;NA&gt;         &lt;NA&gt;        
##  6 AGO   AO    Angola  Luanda           13.2     -8.81 SSF          ZG          
##  7 ALB   AL    Albania Tirane           19.8     41.3  ECS          Z7          
##  8 AND   AD    Andorra Andorra la …      1.52    42.5  ECS          Z7          
##  9 ARB   1A    Arab W… &lt;NA&gt;             NA       NA    &lt;NA&gt;         &lt;NA&gt;        
## 10 ARE   AE    United… Abu Dhabi        54.4     24.5  MEA          ZQ          
## # ℹ 286 more rows
## # ℹ 10 more variables: region &lt;chr&gt;, admin_region_iso3c &lt;chr&gt;,
## #   admin_region_iso2c &lt;chr&gt;, admin_region &lt;chr&gt;, income_level_iso3c &lt;chr&gt;,
## #   income_level_iso2c &lt;chr&gt;, income_level &lt;chr&gt;, lending_type_iso3c &lt;chr&gt;,
## #   lending_type_iso2c &lt;chr&gt;, lending_type &lt;chr&gt;</code></pre>
<pre class="r"><code>head(metadata$region)</code></pre>
<pre><code>## [1] &quot;Latin America &amp; Caribbean&quot;                        
## [2] &quot;Aggregates&quot;                                       
## [3] &quot;Middle East, North Africa, Afghanistan &amp; Pakistan&quot;
## [4] &quot;Aggregates&quot;                                       
## [5] &quot;Aggregates&quot;                                       
## [6] &quot;Sub-Saharan Africa&quot;</code></pre>
<p>So this column shows us the “Aggregates”.</p>
<p>So, we can use this to filter the metadata to exclude the Aggregate
codes.</p>
<pre class="r"><code>metadata %&gt;% dplyr::filter(region != &quot;Aggregates&quot;)</code></pre>
<pre><code>## # A tibble: 217 × 18
##    iso3c iso2c country capital_city longitude latitude region_iso3c region_iso2c
##    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;            &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;       
##  1 ABW   AW    Aruba   Oranjestad      -70.0     12.5  LCN          ZJ          
##  2 AFG   AF    Afghan… Kabul            69.2     34.5  MEA          ZQ          
##  3 AGO   AO    Angola  Luanda           13.2     -8.81 SSF          ZG          
##  4 ALB   AL    Albania Tirane           19.8     41.3  ECS          Z7          
##  5 AND   AD    Andorra Andorra la …      1.52    42.5  ECS          Z7          
##  6 ARE   AE    United… Abu Dhabi        54.4     24.5  MEA          ZQ          
##  7 ARG   AR    Argent… Buenos Aires    -58.4    -34.6  LCN          ZJ          
##  8 ARM   AM    Armenia Yerevan          44.5     40.2  ECS          Z7          
##  9 ASM   AS    Americ… Pago Pago      -171.     -14.3  EAS          Z4          
## 10 ATG   AG    Antigu… Saint John&#39;s    -61.8     17.1  LCN          ZJ          
## # ℹ 207 more rows
## # ℹ 10 more variables: region &lt;chr&gt;, admin_region_iso3c &lt;chr&gt;,
## #   admin_region_iso2c &lt;chr&gt;, admin_region &lt;chr&gt;, income_level_iso3c &lt;chr&gt;,
## #   income_level_iso2c &lt;chr&gt;, income_level &lt;chr&gt;, lending_type_iso3c &lt;chr&gt;,
## #   lending_type_iso2c &lt;chr&gt;, lending_type &lt;chr&gt;</code></pre>
<p>Let’s also pare down the data to a few variables we might be
interested in, including region and income level:</p>
<pre class="r"><code>metadata %&gt;% 
  dplyr::filter(region != &quot;Aggregates&quot;) %&gt;%
  select(iso3c, iso2c, country, region, income_level)</code></pre>
<pre><code>## # A tibble: 217 × 5
##    iso3c iso2c country              region                          income_level
##    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;                &lt;chr&gt;                           &lt;chr&gt;       
##  1 ABW   AW    Aruba                Latin America &amp; Caribbean       High income 
##  2 AFG   AF    Afghanistan          Middle East, North Africa, Afg… Low income  
##  3 AGO   AO    Angola               Sub-Saharan Africa              Lower middl…
##  4 ALB   AL    Albania              Europe &amp; Central Asia           Upper middl…
##  5 AND   AD    Andorra              Europe &amp; Central Asia           High income 
##  6 ARE   AE    United Arab Emirates Middle East, North Africa, Afg… High income 
##  7 ARG   AR    Argentina            Latin America &amp; Caribbean       Upper middl…
##  8 ARM   AM    Armenia              Europe &amp; Central Asia           Upper middl…
##  9 ASM   AS    American Samoa       East Asia &amp; Pacific             High income 
## 10 ATG   AG    Antigua and Barbuda  Latin America &amp; Caribbean       High income 
## # ℹ 207 more rows</code></pre>
<p>Ok, this looks useful. Let’s save it as a data table called
<code>countries</code></p>
<pre class="r"><code>countries=metadata %&gt;% 
  dplyr::filter(region != &quot;Aggregates&quot;) %&gt;%
  select(iso3c, iso2c, country.name=country, region, income_level) %&gt;%
  mutate(income_level=factor(income_level, levels=c(&quot;Low income&quot;, &quot;Lower middle income&quot;, &quot;Upper middle income&quot;, &quot;High income&quot;)))</code></pre>
<p>Now, we are going to use the <code>inner_join()</code> function to
make a version of the world bank population data that is only for actual
countries (not aggregates):</p>
<pre class="r"><code>inner_join(world_bank_pop, countries, by=c(&quot;country&quot; = &quot;iso3c&quot;))</code></pre>
<pre><code>## # A tibble: 868 × 24
##    country indicator      `2000`  `2001`  `2002`  `2003`  `2004`  `2005`  `2006`
##    &lt;chr&gt;   &lt;chr&gt;           &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
##  1 ABW     SP.URB.TOTL    4.16e4 4.20e+4 4.22e+4 4.23e+4 4.23e+4 4.24e+4 4.26e+4
##  2 ABW     SP.URB.GROW    1.66e0 9.56e-1 4.01e-1 1.97e-1 9.46e-2 1.94e-1 3.67e-1
##  3 ABW     SP.POP.TOTL    8.91e4 9.07e+4 9.18e+4 9.27e+4 9.35e+4 9.45e+4 9.56e+4
##  4 ABW     SP.POP.GROW    2.54e0 1.77e+0 1.19e+0 9.97e-1 9.01e-1 1.00e+0 1.18e+0
##  5 AFG     SP.URB.TOTL    4.31e6 4.36e+6 4.67e+6 5.06e+6 5.30e+6 5.54e+6 5.83e+6
##  6 AFG     SP.URB.GROW    1.86e0 1.15e+0 6.86e+0 7.95e+0 4.59e+0 4.47e+0 5.03e+0
##  7 AFG     SP.POP.TOTL    1.95e7 1.97e+7 2.10e+7 2.26e+7 2.36e+7 2.44e+7 2.54e+7
##  8 AFG     SP.POP.GROW    1.44e0 7.43e-1 6.45e+0 7.54e+0 3.93e+0 3.58e+0 4.14e+0
##  9 AGO     SP.URB.TOTL    8.21e6 8.69e+6 9.19e+6 9.72e+6 1.03e+7 1.09e+7 1.14e+7
## 10 AGO     SP.URB.GROW    5.65e0 5.63e+0 5.62e+0 5.65e+0 5.69e+0 5.67e+0 4.95e+0
## # ℹ 858 more rows
## # ℹ 15 more variables: `2007` &lt;dbl&gt;, `2008` &lt;dbl&gt;, `2009` &lt;dbl&gt;, `2010` &lt;dbl&gt;,
## #   `2011` &lt;dbl&gt;, `2012` &lt;dbl&gt;, `2013` &lt;dbl&gt;, `2014` &lt;dbl&gt;, `2015` &lt;dbl&gt;,
## #   `2016` &lt;dbl&gt;, `2017` &lt;dbl&gt;, iso2c &lt;chr&gt;, country.name &lt;chr&gt;, region &lt;chr&gt;,
## #   income_level &lt;fct&gt;</code></pre>
<p>You can see that the <code>inner_join()</code> function worked if you
scroll all the way to the right of the output table.</p>
<p>Let’s rearrange the order of the columns using
<code>relocate()</code> so that we can have all the useful metadata
appear first (left-most):</p>
<pre class="r"><code>inner_join(world_bank_pop, countries, by=c(&quot;country&quot; = &quot;iso3c&quot;)) %&gt;%
  relocate(country, iso2c, country.name, region, income_level)</code></pre>
<pre><code>## # A tibble: 868 × 24
##    country iso2c country.name region       income_level indicator `2000`  `2001`
##    &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;        &lt;chr&gt;        &lt;fct&gt;        &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt;
##  1 ABW     AW    Aruba        Latin Ameri… High income  SP.URB.T… 4.16e4 4.20e+4
##  2 ABW     AW    Aruba        Latin Ameri… High income  SP.URB.G… 1.66e0 9.56e-1
##  3 ABW     AW    Aruba        Latin Ameri… High income  SP.POP.T… 8.91e4 9.07e+4
##  4 ABW     AW    Aruba        Latin Ameri… High income  SP.POP.G… 2.54e0 1.77e+0
##  5 AFG     AF    Afghanistan  Middle East… Low income   SP.URB.T… 4.31e6 4.36e+6
##  6 AFG     AF    Afghanistan  Middle East… Low income   SP.URB.G… 1.86e0 1.15e+0
##  7 AFG     AF    Afghanistan  Middle East… Low income   SP.POP.T… 1.95e7 1.97e+7
##  8 AFG     AF    Afghanistan  Middle East… Low income   SP.POP.G… 1.44e0 7.43e-1
##  9 AGO     AO    Angola       Sub-Saharan… Lower middl… SP.URB.T… 8.21e6 8.69e+6
## 10 AGO     AO    Angola       Sub-Saharan… Lower middl… SP.URB.G… 5.65e0 5.63e+0
## # ℹ 858 more rows
## # ℹ 16 more variables: `2002` &lt;dbl&gt;, `2003` &lt;dbl&gt;, `2004` &lt;dbl&gt;, `2005` &lt;dbl&gt;,
## #   `2006` &lt;dbl&gt;, `2007` &lt;dbl&gt;, `2008` &lt;dbl&gt;, `2009` &lt;dbl&gt;, `2010` &lt;dbl&gt;,
## #   `2011` &lt;dbl&gt;, `2012` &lt;dbl&gt;, `2013` &lt;dbl&gt;, `2014` &lt;dbl&gt;, `2015` &lt;dbl&gt;,
## #   `2016` &lt;dbl&gt;, `2017` &lt;dbl&gt;</code></pre>
<p>This looks good. Let’s save it as an object we’ll call
<code>popdat_countries</code></p>
<pre class="r"><code>popdat_countries=inner_join(world_bank_pop, countries, by=c(&quot;country&quot; = &quot;iso3c&quot;)) %&gt;%
  relocate(country, iso2c, country.name, region, income_level)

popdat_countries</code></pre>
<pre><code>## # A tibble: 868 × 24
##    country iso2c country.name region       income_level indicator `2000`  `2001`
##    &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;        &lt;chr&gt;        &lt;fct&gt;        &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt;
##  1 ABW     AW    Aruba        Latin Ameri… High income  SP.URB.T… 4.16e4 4.20e+4
##  2 ABW     AW    Aruba        Latin Ameri… High income  SP.URB.G… 1.66e0 9.56e-1
##  3 ABW     AW    Aruba        Latin Ameri… High income  SP.POP.T… 8.91e4 9.07e+4
##  4 ABW     AW    Aruba        Latin Ameri… High income  SP.POP.G… 2.54e0 1.77e+0
##  5 AFG     AF    Afghanistan  Middle East… Low income   SP.URB.T… 4.31e6 4.36e+6
##  6 AFG     AF    Afghanistan  Middle East… Low income   SP.URB.G… 1.86e0 1.15e+0
##  7 AFG     AF    Afghanistan  Middle East… Low income   SP.POP.T… 1.95e7 1.97e+7
##  8 AFG     AF    Afghanistan  Middle East… Low income   SP.POP.G… 1.44e0 7.43e-1
##  9 AGO     AO    Angola       Sub-Saharan… Lower middl… SP.URB.T… 8.21e6 8.69e+6
## 10 AGO     AO    Angola       Sub-Saharan… Lower middl… SP.URB.G… 5.65e0 5.63e+0
## # ℹ 858 more rows
## # ℹ 16 more variables: `2002` &lt;dbl&gt;, `2003` &lt;dbl&gt;, `2004` &lt;dbl&gt;, `2005` &lt;dbl&gt;,
## #   `2006` &lt;dbl&gt;, `2007` &lt;dbl&gt;, `2008` &lt;dbl&gt;, `2009` &lt;dbl&gt;, `2010` &lt;dbl&gt;,
## #   `2011` &lt;dbl&gt;, `2012` &lt;dbl&gt;, `2013` &lt;dbl&gt;, `2014` &lt;dbl&gt;, `2015` &lt;dbl&gt;,
## #   `2016` &lt;dbl&gt;, `2017` &lt;dbl&gt;</code></pre>
<p><br></p>
<hr />
</div>
<div id="which-are-the-worlds-largest-countries-in-2017"
class="section level2">
<h2>3. Which are the world’s largest countries (in 2017)?</h2>
<p>As mentioned at the beginning, each row of data here is a country x
indicator combination, with 4 different indicators. The indicators
are:</p>
<ul>
<li><p>SP.POP.GROW = population growth</p></li>
<li><p>SP.POP.TOTL = total population</p></li>
<li><p>SP.URB.GROW = urban population growth</p></li>
<li><p>SP.URB.TOTL = total urban population</p></li>
</ul>
<p>So, we will create a data table called <code>pop_totals</code> that
is just the “total population” data.</p>
<pre class="r"><code>pop_totals=popdat_countries %&gt;% 
  dplyr::filter(indicator==&quot;SP.POP.TOTL&quot;) 

pop_totals</code></pre>
<pre><code>## # A tibble: 217 × 24
##    country iso2c country.name region income_level indicator `2000` `2001` `2002`
##    &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;        &lt;chr&gt;  &lt;fct&gt;        &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
##  1 ABW     AW    Aruba        Latin… High income  SP.POP.T… 8.91e4 9.07e4 9.18e4
##  2 AFG     AF    Afghanistan  Middl… Low income   SP.POP.T… 1.95e7 1.97e7 2.10e7
##  3 AGO     AO    Angola       Sub-S… Lower middl… SP.POP.T… 1.64e7 1.69e7 1.75e7
##  4 ALB     AL    Albania      Europ… Upper middl… SP.POP.T… 3.09e6 3.06e6 3.05e6
##  5 AND     AD    Andorra      Europ… High income  SP.POP.T… 6.61e4 6.78e4 7.08e4
##  6 ARE     AE    United Arab… Middl… High income  SP.POP.T… 3.28e6 3.45e6 3.63e6
##  7 ARG     AR    Argentina    Latin… Upper middl… SP.POP.T… 3.71e7 3.75e7 3.79e7
##  8 ARM     AM    Armenia      Europ… Upper middl… SP.POP.T… 3.17e6 3.13e6 3.11e6
##  9 ASM     AS    American Sa… East … High income  SP.POP.T… 5.82e4 5.83e4 5.82e4
## 10 ATG     AG    Antigua and… Latin… High income  SP.POP.T… 7.51e4 7.62e4 7.72e4
## # ℹ 207 more rows
## # ℹ 15 more variables: `2003` &lt;dbl&gt;, `2004` &lt;dbl&gt;, `2005` &lt;dbl&gt;, `2006` &lt;dbl&gt;,
## #   `2007` &lt;dbl&gt;, `2008` &lt;dbl&gt;, `2009` &lt;dbl&gt;, `2010` &lt;dbl&gt;, `2011` &lt;dbl&gt;,
## #   `2012` &lt;dbl&gt;, `2013` &lt;dbl&gt;, `2014` &lt;dbl&gt;, `2015` &lt;dbl&gt;, `2016` &lt;dbl&gt;,
## #   `2017` &lt;dbl&gt;</code></pre>
<p>From this population size data, let’s figure out what is the 90th
percentile in population size in 2017. We are going to get this number
by doing <code>pull()</code> to get the 2017 population sizes as a
vector, and use <code>quantile()</code> to get the 90th percentile. Save
that value as <code>upper_pop</code>.</p>
<pre class="r"><code>upper_pop=pop_totals %&gt;%
  pull(`2017`) %&gt;% 
  quantile(., probs=0.90, na.rm=T) # this allows us to find the value at Nth percentile

upper_pop</code></pre>
<pre><code>##      90% 
## 62745569</code></pre>
<p>So, the 90th percentile of population sizes in 2017 is 63,286,844</p>
<p>Now, we can use this 90th percentile value to filter the population
size data to just the largest (&gt;= 90th percentile) countries. We will
create a one-column tibble called <code>large_countries()</code> to save
this list of country codes.</p>
<pre class="r"><code>pop_totals %&gt;% 
  dplyr::filter(`2017` &gt; upper_pop) </code></pre>
<pre><code>## # A tibble: 22 × 24
##    country iso2c country.name region income_level indicator `2000` `2001` `2002`
##    &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;        &lt;chr&gt;  &lt;fct&gt;        &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
##  1 BGD     BD    Bangladesh   South… Lower middl… SP.POP.T… 1.29e8 1.32e8 1.34e8
##  2 BRA     BR    Brazil       Latin… Upper middl… SP.POP.T… 1.76e8 1.78e8 1.80e8
##  3 CHN     CN    China        East … Upper middl… SP.POP.T… 1.26e9 1.27e9 1.28e9
##  4 COD     CD    Congo, Dem.… Sub-S… Low income   SP.POP.T… 4.86e7 5.01e7 5.17e7
##  5 DEU     DE    Germany      Europ… High income  SP.POP.T… 8.22e7 8.23e7 8.25e7
##  6 EGY     EG    Egypt, Arab… Middl… Lower middl… SP.POP.T… 7.14e7 7.29e7 7.44e7
##  7 ETH     ET    Ethiopia     Sub-S… &lt;NA&gt;         SP.POP.T… 6.70e7 6.90e7 7.11e7
##  8 FRA     FR    France       Europ… High income  SP.POP.T… 6.09e7 6.14e7 6.18e7
##  9 GBR     GB    United King… Europ… High income  SP.POP.T… 5.89e7 5.91e7 5.94e7
## 10 IDN     ID    Indonesia    East … Upper middl… SP.POP.T… 2.14e8 2.17e8 2.20e8
## # ℹ 12 more rows
## # ℹ 15 more variables: `2003` &lt;dbl&gt;, `2004` &lt;dbl&gt;, `2005` &lt;dbl&gt;, `2006` &lt;dbl&gt;,
## #   `2007` &lt;dbl&gt;, `2008` &lt;dbl&gt;, `2009` &lt;dbl&gt;, `2010` &lt;dbl&gt;, `2011` &lt;dbl&gt;,
## #   `2012` &lt;dbl&gt;, `2013` &lt;dbl&gt;, `2014` &lt;dbl&gt;, `2015` &lt;dbl&gt;, `2016` &lt;dbl&gt;,
## #   `2017` &lt;dbl&gt;</code></pre>
<p>Ok, now let’s select just the country code, country name and
population size of the world’s largest countries (90th percentile) and
arrange it in descending order using <code>arrange()</code></p>
<pre class="r"><code>largest_countries=pop_totals %&gt;% 
  dplyr::filter(`2017` &gt; upper_pop) %&gt;% 
  select(country, country.name, `2017`) %&gt;%
  arrange(desc(`2017`))

print(largest_countries, n=22)</code></pre>
<pre><code>## # A tibble: 22 × 3
##    country country.name           `2017`
##    &lt;chr&gt;   &lt;chr&gt;                   &lt;dbl&gt;
##  1 CHN     China              1396215000
##  2 IND     India              1354195680
##  3 USA     United States       325122128
##  4 IDN     Indonesia           264498852
##  5 PAK     Pakistan            216379655
##  6 BRA     Brazil              208504960
##  7 NGA     Nigeria             193495907
##  8 BGD     Bangladesh          161793964
##  9 RUS     Russian Federation  144496739
## 10 JPN     Japan               126972000
## 11 MEX     Mexico              122839258
## 12 ETH     Ethiopia            108197950
## 13 PHL     Philippines         106738501
## 14 EGY     Egypt, Arab Rep.    101789386
## 15 VNM     Viet Nam             94033048
## 16 IRN     Iran, Islamic Rep.   84505076
## 17 COD     Congo, Dem. Rep.     84283273
## 18 DEU     Germany              82657002
## 19 TUR     Turkiye              82089826
## 20 THA     Thailand             70898202
## 21 FRA     France               66918020
## 22 GBR     United Kingdom       66058859</code></pre>
<p><br></p>
<hr />
</div>
<div
id="how-population-growth-rates-have-changed-across-years-by-income-level-of-countries"
class="section level2">
<h2>4. How population growth rates have changed across years, by income
level of countries</h2>
<p>Now, let’s create a tibble that contains the population growth data
as well as the income level designation for each country.</p>
<p>I’m also going to remove countries for which we are missing data
using <code>drop_na()</code>.</p>
<pre class="r"><code>popdat_countries %&gt;% 
  dplyr::filter(indicator==&quot;SP.POP.GROW&quot;)  %&gt;%
  drop_na()</code></pre>
<pre><code>## # A tibble: 215 × 24
##    country iso2c country.name region income_level indicator `2000` `2001` `2002`
##    &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;        &lt;chr&gt;  &lt;fct&gt;        &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
##  1 ABW     AW    Aruba        Latin… High income  SP.POP.G…  2.54   1.77   1.19 
##  2 AFG     AF    Afghanistan  Middl… Low income   SP.POP.G…  1.44   0.743  6.45 
##  3 AGO     AO    Angola       Sub-S… Lower middl… SP.POP.G…  3.24   3.29   3.34 
##  4 ALB     AL    Albania      Europ… Upper middl… SP.POP.G… -0.637 -0.938 -0.300
##  5 AND     AD    Andorra      Europ… High income  SP.POP.G…  0.671  2.57   4.37 
##  6 ARE     AE    United Arab… Middl… High income  SP.POP.G…  5.58   5.32   5.06 
##  7 ARG     AR    Argentina    Latin… Upper middl… SP.POP.G…  1.13   1.10   1.07 
##  8 ARM     AM    Armenia      Europ… Upper middl… SP.POP.G… -1.18  -1.12  -0.901
##  9 ASM     AS    American Sa… East … High income  SP.POP.G…  1.10   0.161 -0.252
## 10 ATG     AG    Antigua and… Latin… High income  SP.POP.G…  1.66   1.53   1.28 
## # ℹ 205 more rows
## # ℹ 15 more variables: `2003` &lt;dbl&gt;, `2004` &lt;dbl&gt;, `2005` &lt;dbl&gt;, `2006` &lt;dbl&gt;,
## #   `2007` &lt;dbl&gt;, `2008` &lt;dbl&gt;, `2009` &lt;dbl&gt;, `2010` &lt;dbl&gt;, `2011` &lt;dbl&gt;,
## #   `2012` &lt;dbl&gt;, `2013` &lt;dbl&gt;, `2014` &lt;dbl&gt;, `2015` &lt;dbl&gt;, `2016` &lt;dbl&gt;,
## #   `2017` &lt;dbl&gt;</code></pre>
<p>Now, we are going to <strong>reshape this data into
long-format</strong>.</p>
<p>To do this, I’m going to first pare down by removing columns we don’t
need. I’m going to keep “country” because I want the value for each
country for each year. I’m also going to keep “income_level” because I’m
going to use that to summarise the population growth data later. Then,
I’m going to use the <code>pivot_longer()</code> function to rearrange
all of the columns with years as the heading into two columns: one
column with the year, and one column with the population growth
rate.</p>
<pre class="r"><code>popdat_countries %&gt;% 
  dplyr::filter(indicator==&quot;SP.POP.GROW&quot;) %&gt;%
  drop_na() %&gt;%
  select(-indicator, -country.name, -iso2c, -region) %&gt;% #pare down the data a bit &amp; pivot longer
  pivot_longer(cols=-c(country, income_level), names_to=&quot;year&quot;, values_to=&quot;growth_rate&quot;)</code></pre>
<pre><code>## # A tibble: 3,870 × 4
##    country income_level year  growth_rate
##    &lt;chr&gt;   &lt;fct&gt;        &lt;chr&gt;       &lt;dbl&gt;
##  1 ABW     High income  2000        2.54 
##  2 ABW     High income  2001        1.77 
##  3 ABW     High income  2002        1.19 
##  4 ABW     High income  2003        0.997
##  5 ABW     High income  2004        0.901
##  6 ABW     High income  2005        1.00 
##  7 ABW     High income  2006        1.18 
##  8 ABW     High income  2007        1.23 
##  9 ABW     High income  2008        1.24 
## 10 ABW     High income  2009        1.23 
## # ℹ 3,860 more rows</code></pre>
<p>Ok, now that we have the data in long format, it is easier to
summarize the annual population growth rates across all years by income
level.</p>
<p>To do this, I’m going to <code>group_by()</code> income level, and
then summarize the data using a nifty <code>mean_se()</code> function,
which gives me the mean AND the mean +/- standard error. This is a nice
function to get the confidence band around the mean.</p>
<pre class="r"><code>popdat_countries %&gt;% 
  dplyr::filter(indicator==&quot;SP.POP.GROW&quot;) %&gt;%
  drop_na() %&gt;%
  select(-indicator, -country.name, -iso2c, -region) %&gt;% #pare down the data a bit &amp; pivot longer
  pivot_longer(cols=-c(country, income_level), names_to=&quot;year&quot;, values_to=&quot;growth_rate&quot;) %&gt;%
  group_by(income_level, year) %&gt;%
  summarise(mean_se(growth_rate)) #calculates mean + standard error of the mean.</code></pre>
<pre><code>## # A tibble: 72 × 5
## # Groups:   income_level [4]
##    income_level year      y  ymin  ymax
##    &lt;fct&gt;        &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 Low income   2000   2.66  2.49  2.83
##  2 Low income   2001   2.79  2.58  3.00
##  3 Low income   2002   3.04  2.81  3.28
##  4 Low income   2003   3.05  2.79  3.30
##  5 Low income   2004   2.95  2.78  3.13
##  6 Low income   2005   2.99  2.83  3.14
##  7 Low income   2006   3.06  2.86  3.26
##  8 Low income   2007   3.03  2.80  3.25
##  9 Low income   2008   2.96  2.80  3.12
## 10 Low income   2009   2.92  2.75  3.10
## # ℹ 62 more rows</code></pre>
<p>Ok, this looks good, so I’m going to save that data table as
<code>popgrowth_income</code>.</p>
<pre class="r"><code>popgrowth_income=popdat_countries %&gt;% 
  dplyr::filter(indicator==&quot;SP.POP.GROW&quot;) %&gt;%
  drop_na() %&gt;%
  select(-indicator, -country.name, -iso2c, -region) %&gt;% #pare down the data a bit &amp; pivot longer
  pivot_longer(cols=-c(country, income_level), names_to=&quot;year&quot;, values_to=&quot;growth_rate&quot;) %&gt;%
  group_by(income_level, year) %&gt;%
  summarise(mean_se(growth_rate)) #calculates mean + standard error of the mean.</code></pre>
<p>Now, we have the average (+/- standard error) population growth rate
for countries at each income level across each year for 2000 to 2017.
Here, the mean is “y” and lower and upper standard error is “ymin” and
“ymax”, respectively. Let’s plot this. Let’s start with a simple line
graph:</p>
<pre class="r"><code>ggplot(popgrowth_income, aes(x=as.numeric(year), y=y, group=income_level)) +
  geom_line(aes(color=income_level)) +
  theme_bw()</code></pre>
<p><img src="x_WorldBank_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<p>We can make this fancy by adding the confidence band using
<code>geom_ribbon()</code>, and cleaning up the axis labels:</p>
<pre class="r"><code>ggplot(popgrowth_income, aes(x=as.numeric(year), y=y, group=income_level)) +
  geom_line(aes(color=income_level)) +
  geom_ribbon(aes(ymin=ymin, ymax=ymax), alpha=0.3, fill=&quot;gray&quot;) +
  theme_bw() +
  ylab(&quot;Average Population Growth Rate&quot;) +
  xlab(&quot;Year&quot;)</code></pre>
<p><img src="x_WorldBank_files/figure-html/average_growth_by_income-1.png" width="672" /></p>
</div>
<div
id="how-does-the-relationship-between-population-growth-rate-and-income-level-differ-between-global-regions"
class="section level2">
<h2>5. How does the relationship between population growth rate and
income level differ between global regions?</h2>
<p>Now, let’s look at how income levels have different effects on
population growth rates depending on the region of the world. to do
this, we have to pick a year to analyze. Let’s go with the latest data,
2017.</p>
<p>We can do that simply by going from the original
<code>popdat_countries</code> (the raw data with the “aggregates”
removed), then filtering it to just the data on population growth, then
just looking at the 2017 data for each country. We’ll also keep the
region and income level data. We’ll remove rows that have NAs.</p>
<pre class="r"><code>popdat_countries %&gt;% 
  dplyr::filter(indicator==&quot;SP.POP.GROW&quot;) %&gt;%
  select(country, `2017`, region, income_level) %&gt;%
  drop_na()</code></pre>
<pre><code>## # A tibble: 215 × 4
##    country  `2017` region                                           income_level
##    &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;                                            &lt;fct&gt;       
##  1 ABW      0.537  Latin America &amp; Caribbean                        High income 
##  2 AFG      2.87   Middle East, North Africa, Afghanistan &amp; Pakist… Low income  
##  3 AGO      3.55   Sub-Saharan Africa                               Lower middl…
##  4 ALB     -0.0920 Europe &amp; Central Asia                            Upper middl…
##  5 AND      1.77   Europe &amp; Central Asia                            High income 
##  6 ARE      0.820  Middle East, North Africa, Afghanistan &amp; Pakist… High income 
##  7 ARG      1.04   Latin America &amp; Caribbean                        Upper middl…
##  8 ARM     -0.487  Europe &amp; Central Asia                            Upper middl…
##  9 ASM     -1.97   East Asia &amp; Pacific                              High income 
## 10 ATG      0.611  Latin America &amp; Caribbean                        High income 
## # ℹ 205 more rows</code></pre>
<p>Ok, that looks like what we want, so I’ll save it as
<code>popdat_2017</code>:</p>
<pre class="r"><code>popdat_2017=popdat_countries %&gt;% 
  dplyr::filter(indicator==&quot;SP.POP.GROW&quot;) %&gt;%
  select(country, `2017`, region, income_level) %&gt;%
  drop_na()</code></pre>
<p>Now we can plot population growth by income level, and use region to
create facets. Here, I’m going to use income_level as both the x axis
and color because the x-axis label is going to be hard to read.</p>
<pre class="r"><code>ggplot(popdat_2017, aes(x=income_level, y=`2017`)) +
  geom_boxplot(aes(color=income_level)) +
  facet_wrap(~region, nrow=3)</code></pre>
<p><img src="x_WorldBank_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<p>I can see that some regions don’t have enough variation in income
level to be useful (e.g., North America and South Asia). I can actually
filter the data within the ggplot function to remove those:</p>
<p>Lower income countries have higher population growth rate than those
with high income in some regions (sub-Saharan Africa), while in others
growth rate is bigger for high earners.</p>
<pre class="r"><code>ggplot(popdat_2017 %&gt;% dplyr::filter(region!=&quot;North America&quot; &amp; region!=&quot;South Asia&quot;), aes(x=income_level, y=`2017`)) +
  geom_boxplot(aes(color=income_level)) +
  facet_wrap(~region, nrow=2) +
  theme_bw() +
  theme(legend.position = &quot;bottom&quot;) +
  ylab(&quot;Population Growth Rate in 2017&quot;)</code></pre>
<p><img src="x_WorldBank_files/figure-html/growth_income_by_region-1.png" width="672" /></p>
<p>It looks like the relationship between income level and population
growth rate indeed changes between regions. For example, in
Europe/Central Asia, Latin America/Caribbean, and Sub-Saharan Africa,
countries with lower income have higher population growth rate. But the
relationship is opposite in the Middle East &amp; North Africa. There,
the countries with higher incomes have higher population growth
rate.</p>
<p>How would we test the idea that the relationship between income level
and population growth rate depends on the region? One way is to run a
linear model including the interaction effect of the two variables:</p>
<pre class="r"><code>lm.fit=lm(`2017`~region*income_level, data=popdat_2017)

anova(lm.fit)</code></pre>
<pre><code>## Analysis of Variance Table
## 
## Response: 2017
##                      Df  Sum Sq Mean Sq F value  Pr(&gt;F)    
## region                6 117.964 19.6606 17.8912 &lt; 2e-16 ***
## income_level          3   5.922  1.9740  1.7964 0.14921    
## region:income_level  11  32.932  2.9939  2.7244 0.00271 ** 
## Residuals           194 213.186  1.0989                    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
